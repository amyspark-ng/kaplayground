var kaplay=(()=>{var sn=Object.defineProperty;var di=Object.getOwnPropertyDescriptor;var hi=Object.getOwnPropertyNames;var pi=Object.prototype.hasOwnProperty;var i=(t,e)=>sn(t,"name",{value:e,configurable:!0});var fi=(t,e)=>{for(var r in e)sn(t,r,{get:e[r],enumerable:!0})},gi=(t,e,r,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let a of hi(e))!pi.call(t,a)&&a!==r&&sn(t,a,{get:()=>e[a],enumerable:!(o=di(e,a))||o.enumerable});return t};var bi=t=>gi(sn({},"__esModule",{value:!0}),t);var Fr=(()=>{for(var t=new Uint8Array(128),e=0;e<64;e++)t[e<26?e+65:e<52?e+71:e<62?e-4:e*4-205]=e;return r=>{for(var o=r.length,a=new Uint8Array((o-(r[o-1]=="=")-(r[o-2]=="="))*3/4|0),l=0,u=0;l<o;){var f=t[r.charCodeAt(l++)],y=t[r.charCodeAt(l++)],m=t[r.charCodeAt(l++)],V=t[r.charCodeAt(l++)];a[u++]=f<<2|y>>4,a[u++]=y<<4|m>>2,a[u++]=m<<6|V}return a}})();var ca={};fi(ca,{anchorPt:()=>ht,default:()=>aa,getInternalContext:()=>fe,getKaboomContext:()=>J,isKaboomCtx:()=>as});function ve(t){return t*Math.PI/180}i(ve,"deg2rad");function lt(t){return t*180/Math.PI}i(lt,"rad2deg");function Qe(t,e,r){return e>r?Qe(t,r,e):Math.min(Math.max(t,e),r)}i(Qe,"clamp");function Je(t,e,r){if(typeof t=="number"&&typeof e=="number")return t+(e-t)*r;if(t instanceof T&&e instanceof T)return t.lerp(e,r);if(t instanceof ee&&e instanceof ee)return t.lerp(e,r);throw new Error(`Bad value for lerp(): ${t}, ${e}. Only number, Vec2 and Color is supported.`)}i(Je,"lerp");function dt(t,e,r,o,a){return o+(t-e)/(r-e)*(a-o)}i(dt,"map");function Lr(t,e,r,o,a){return Qe(dt(t,e,r,o,a),o,a)}i(Lr,"mapc");var T=class t{static{i(this,"Vec2")}x=0;y=0;constructor(e=0,r=e){this.x=e,this.y=r}static fromAngle(e){let r=ve(e);return new t(Math.cos(r),Math.sin(r))}static LEFT=new t(-1,0);static RIGHT=new t(1,0);static UP=new t(0,-1);static DOWN=new t(0,1);clone(){return new t(this.x,this.y)}add(...e){let r=C(...e);return new t(this.x+r.x,this.y+r.y)}sub(...e){let r=C(...e);return new t(this.x-r.x,this.y-r.y)}scale(...e){let r=C(...e);return new t(this.x*r.x,this.y*r.y)}dist(...e){let r=C(...e);return this.sub(r).len()}sdist(...e){let r=C(...e);return this.sub(r).slen()}len(){return Math.sqrt(this.dot(this))}slen(){return this.dot(this)}unit(){let e=this.len();return e===0?new t(0):this.scale(1/e)}normal(){return new t(this.y,-this.x)}reflect(e){return this.sub(e.scale(2*this.dot(e)))}project(e){return e.scale(e.dot(this)/e.len())}reject(e){return this.sub(this.project(e))}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}angle(...e){let r=C(...e);return lt(Math.atan2(this.y-r.y,this.x-r.x))}angleBetween(...e){let r=C(...e);return lt(Math.atan2(this.cross(r),this.dot(r)))}lerp(e,r){return new t(Je(this.x,e.x,r),Je(this.y,e.y,r))}slerp(e,r){let o=this.dot(e),a=this.cross(e),l=Math.atan2(a,o);return this.scale(Math.sin((1-r)*l)).add(e.scale(Math.sin(r*l))).scale(1/a)}isZero(){return this.x===0&&this.y===0}toFixed(e){return new t(Number(this.x.toFixed(e)),Number(this.y.toFixed(e)))}transform(e){return e.multVec2(this)}eq(e){return this.x===e.x&&this.y===e.y}bbox(){return new ue(this,0,0)}toString(){return`vec2(${this.x.toFixed(2)}, ${this.y.toFixed(2)})`}};function C(...t){if(t.length===1){if(t[0]instanceof T)return new T(t[0].x,t[0].y);if(Array.isArray(t[0])&&t[0].length===2)return new T(...t[0])}return new T(...t)}i(C,"vec2");var ee=class t{static{i(this,"Color")}r=255;g=255;b=255;constructor(e,r,o){this.r=Qe(e,0,255),this.g=Qe(r,0,255),this.b=Qe(o,0,255)}static fromArray(e){return new t(e[0],e[1],e[2])}static fromHex(e){if(typeof e=="number")return new t(e>>16&255,e>>8&255,e>>0&255);if(typeof e=="string"){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return new t(parseInt(r[1],16),parseInt(r[2],16),parseInt(r[3],16))}else throw new Error("Invalid hex color format")}static fromHSL(e,r,o){if(r==0)return new t(255*o,255*o,255*o);let a=i((V,x,P)=>(P<0&&(P+=1),P>1&&(P-=1),P<1/6?V+(x-V)*6*P:P<1/2?x:P<2/3?V+(x-V)*(2/3-P)*6:V),"hue2rgb"),l=o<.5?o*(1+r):o+r-o*r,u=2*o-l,f=a(u,l,e+1/3),y=a(u,l,e),m=a(u,l,e-1/3);return new t(Math.round(f*255),Math.round(y*255),Math.round(m*255))}static RED=new t(255,0,0);static GREEN=new t(0,255,0);static BLUE=new t(0,0,255);static YELLOW=new t(255,255,0);static MAGENTA=new t(255,0,255);static CYAN=new t(0,255,255);static WHITE=new t(255,255,255);static BLACK=new t(0,0,0);clone(){return new t(this.r,this.g,this.b)}lighten(e){return new t(this.r+e,this.g+e,this.b+e)}darken(e){return this.lighten(-e)}invert(){return new t(255-this.r,255-this.g,255-this.b)}mult(e){return new t(this.r*e.r/255,this.g*e.g/255,this.b*e.b/255)}lerp(e,r){return new t(Je(this.r,e.r,r),Je(this.g,e.g,r),Je(this.b,e.b,r))}toHSL(){let e=this.r/255,r=this.g/255,o=this.b/255,a=Math.max(e,r,o),l=Math.min(e,r,o),u=(a+l)/2,f=u,y=u;if(a==l)u=f=0;else{let m=a-l;switch(f=y>.5?m/(2-a-l):m/(a+l),a){case e:u=(r-o)/m+(r<o?6:0);break;case r:u=(o-e)/m+2;break;case o:u=(e-r)/m+4;break}u/=6}return[u,f,y]}eq(e){return this.r===e.r&&this.g===e.g&&this.b===e.b}toString(){return`rgb(${this.r}, ${this.g}, ${this.b})`}toHex(){return"#"+((1<<24)+(this.r<<16)+(this.g<<8)+this.b).toString(16).slice(1)}toArray(){return[this.r,this.g,this.b]}};function oe(...t){if(t.length===0)return new ee(255,255,255);if(t.length===1){if(t[0]instanceof ee)return t[0].clone();if(typeof t[0]=="string")return ee.fromHex(t[0]);if(Array.isArray(t[0])&&t[0].length===3)return ee.fromArray(t[0])}return new ee(...t)}i(oe,"rgb");var jr=i((t,e,r)=>ee.fromHSL(t,e,r),"hsl2rgb"),me=class t{static{i(this,"Quad")}x=0;y=0;w=1;h=1;constructor(e,r,o,a){this.x=e,this.y=r,this.w=o,this.h=a}scale(e){return new t(this.x+this.w*e.x,this.y+this.h*e.y,this.w*e.w,this.h*e.h)}pos(){return new T(this.x,this.y)}clone(){return new t(this.x,this.y,this.w,this.h)}eq(e){return this.x===e.x&&this.y===e.y&&this.w===e.w&&this.h===e.h}toString(){return`quad(${this.x}, ${this.y}, ${this.w}, ${this.h})`}};function pe(t,e,r,o){return new me(t,e,r,o)}i(pe,"quad");var At=class t{static{i(this,"Mat2")}a;b;c;d;constructor(e,r,o,a){this.a=e,this.b=r,this.c=o,this.d=a}mul(e){return new t(this.a*e.a+this.b*e.c,this.a*e.b+this.b*e.d,this.c*e.a+this.d*e.c,this.c*e.b+this.d*e.d)}transform(e){return C(this.a*e.x+this.b*e.y,this.c*e.x+this.d*e.y)}get inverse(){let e=this.det;return new t(this.d/e,-this.b/e,-this.c/e,this.a/e)}get transpose(){return new t(this.a,this.c,this.b,this.d)}get eigenvalues(){let e=this.trace/2,r=this.det,o=e+Math.sqrt(e*e-r),a=e-Math.sqrt(e*e-r);return[o,a]}eigenvectors(e,r){return this.c!=0?[[e-this.d,this.c],[r-this.d,this.c]]:this.b!=0?[[this.b,e-this.a],[this.b,r-this.a]]:Math.abs(this.transform(C(1,0)).x-e)<Number.EPSILON?[[1,0],[0,1]]:[[0,1],[1,0]]}get det(){return this.a*this.d-this.b*this.c}get trace(){return this.a+this.d}static rotation(e){let r=Math.cos(e),o=Math.sin(e);return new t(r,o,-o,r)}static scale(e,r){return new t(e,0,0,r)}};var bt=class t{static{i(this,"Mat3")}m11;m12;m13;m21;m22;m23;m31;m32;m33;constructor(e,r,o,a,l,u,f,y,m){this.m11=e,this.m12=r,this.m13=o,this.m21=a,this.m22=l,this.m23=u,this.m31=f,this.m32=y,this.m33=m}static fromMat2(e){return new t(e.a,e.b,0,e.c,e.d,0,0,0,1)}toMat2(){return new At(this.m11,this.m12,this.m21,this.m22)}mul(e){return new t(this.m11*e.m11+this.m12*e.m21+this.m13*e.m31,this.m11*e.m12+this.m12*e.m22+this.m13*e.m32,this.m11*e.m13+this.m12*e.m23+this.m13*e.m33,this.m21*e.m11+this.m22*e.m21+this.m23*e.m31,this.m21*e.m12+this.m22*e.m22+this.m23*e.m32,this.m21*e.m13+this.m22*e.m23+this.m23*e.m33,this.m31*e.m11+this.m32*e.m21+this.m33*e.m31,this.m31*e.m12+this.m32*e.m22+this.m33*e.m32,this.m31*e.m13+this.m32*e.m23+this.m33*e.m33)}get det(){return this.m11*this.m22*this.m33+this.m12*this.m23*this.m31+this.m13*this.m21*this.m32-this.m13*this.m22*this.m31-this.m12*this.m21*this.m33-this.m11*this.m23*this.m32}rotate(e){let r=Math.cos(e),o=Math.sin(e),a=this.m11,l=this.m12;return this.m11=r*this.m11+o*this.m21,this.m12=r*this.m12+o*this.m22,this.m21=r*this.m21-o*a,this.m22=r*this.m22-o*l,this}scale(e,r){return this.m11*=e,this.m12*=e,this.m21*=r,this.m22*=r,this}get inverse(){let e=this.det;return new t((this.m22*this.m33-this.m23*this.m32)/e,(this.m13*this.m32-this.m12*this.m33)/e,(this.m12*this.m23-this.m13*this.m22)/e,(this.m23*this.m31-this.m21*this.m33)/e,(this.m11*this.m33-this.m13*this.m31)/e,(this.m13*this.m21-this.m11*this.m23)/e,(this.m21*this.m32-this.m22*this.m31)/e,(this.m12*this.m31-this.m11*this.m32)/e,(this.m11*this.m22-this.m12*this.m21)/e)}get transpose(){return new t(this.m11,this.m21,this.m31,this.m12,this.m22,this.m32,this.m13,this.m23,this.m33)}},Ge=class t{static{i(this,"Mat4")}m=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];constructor(e){e&&(this.m=e)}static translate(e){return new t([1,0,0,0,0,1,0,0,0,0,1,0,e.x,e.y,0,1])}static scale(e){return new t([e.x,0,0,0,0,e.y,0,0,0,0,1,0,0,0,0,1])}static rotateX(e){e=ve(-e);let r=Math.cos(e),o=Math.sin(e);return new t([1,0,0,0,0,r,-o,0,0,o,r,0,0,0,0,1])}static rotateY(e){e=ve(-e);let r=Math.cos(e),o=Math.sin(e);return new t([r,0,o,0,0,1,0,0,-o,0,r,0,0,0,0,1])}static rotateZ(e){e=ve(-e);let r=Math.cos(e),o=Math.sin(e);return new t([r,-o,0,0,o,r,0,0,0,0,1,0,0,0,0,1])}translate(e){return this.m[12]+=this.m[0]*e.x+this.m[4]*e.y,this.m[13]+=this.m[1]*e.x+this.m[5]*e.y,this.m[14]+=this.m[2]*e.x+this.m[6]*e.y,this.m[15]+=this.m[3]*e.x+this.m[7]*e.y,this}scale(e){return this.m[0]*=e.x,this.m[4]*=e.y,this.m[1]*=e.x,this.m[5]*=e.y,this.m[2]*=e.x,this.m[6]*=e.y,this.m[3]*=e.x,this.m[7]*=e.y,this}rotate(e){e=ve(-e);let r=Math.cos(e),o=Math.sin(e),a=this.m[0],l=this.m[1],u=this.m[4],f=this.m[5];return this.m[0]=a*r+l*o,this.m[1]=-a*o+l*r,this.m[4]=u*r+f*o,this.m[5]=-u*o+f*r,this}mult(e){let r=[];for(let o=0;o<4;o++)for(let a=0;a<4;a++)r[o*4+a]=this.m[0*4+a]*e.m[o*4+0]+this.m[1*4+a]*e.m[o*4+1]+this.m[2*4+a]*e.m[o*4+2]+this.m[3*4+a]*e.m[o*4+3];return new t(r)}multVec2(e){return new T(e.x*this.m[0]+e.y*this.m[4]+this.m[12],e.x*this.m[1]+e.y*this.m[5]+this.m[13])}getTranslation(){return new T(this.m[12],this.m[13])}getScale(){if(this.m[0]!=0||this.m[1]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new T(r,e/r)}else if(this.m[4]!=0||this.m[5]!=0){let e=this.m[0]*this.m[5]-this.m[1]*this.m[4],r=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new T(e/r,r)}else return new T(0,0)}getRotation(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return lt(this.m[1]>0?Math.acos(this.m[0]/e):-Math.acos(this.m[0]/e))}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return lt(Math.PI/2-(this.m[5]>0?Math.acos(-this.m[4]/e):-Math.acos(this.m[4]/e)))}else return 0}getSkew(){if(this.m[0]!=0||this.m[1]!=0){let e=Math.sqrt(this.m[0]*this.m[0]+this.m[1]*this.m[1]);return new T(Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e),0)}else if(this.m[4]!=0||this.m[5]!=0){let e=Math.sqrt(this.m[4]*this.m[4]+this.m[5]*this.m[5]);return new T(0,Math.atan(this.m[0]*this.m[4]+this.m[1]*this.m[5])/(e*e))}else return new T(0,0)}invert(){let e=[],r=this.m[10]*this.m[15]-this.m[14]*this.m[11],o=this.m[9]*this.m[15]-this.m[13]*this.m[11],a=this.m[9]*this.m[14]-this.m[13]*this.m[10],l=this.m[8]*this.m[15]-this.m[12]*this.m[11],u=this.m[8]*this.m[14]-this.m[12]*this.m[10],f=this.m[8]*this.m[13]-this.m[12]*this.m[9],y=this.m[6]*this.m[15]-this.m[14]*this.m[7],m=this.m[5]*this.m[15]-this.m[13]*this.m[7],V=this.m[5]*this.m[14]-this.m[13]*this.m[6],x=this.m[4]*this.m[15]-this.m[12]*this.m[7],P=this.m[4]*this.m[14]-this.m[12]*this.m[6],w=this.m[5]*this.m[15]-this.m[13]*this.m[7],K=this.m[4]*this.m[13]-this.m[12]*this.m[5],Y=this.m[6]*this.m[11]-this.m[10]*this.m[7],z=this.m[5]*this.m[11]-this.m[9]*this.m[7],N=this.m[5]*this.m[10]-this.m[9]*this.m[6],$=this.m[4]*this.m[11]-this.m[8]*this.m[7],O=this.m[4]*this.m[10]-this.m[8]*this.m[6],se=this.m[4]*this.m[9]-this.m[8]*this.m[5];e[0]=this.m[5]*r-this.m[6]*o+this.m[7]*a,e[4]=-(this.m[4]*r-this.m[6]*l+this.m[7]*u),e[8]=this.m[4]*o-this.m[5]*l+this.m[7]*f,e[12]=-(this.m[4]*a-this.m[5]*u+this.m[6]*f),e[1]=-(this.m[1]*r-this.m[2]*o+this.m[3]*a),e[5]=this.m[0]*r-this.m[2]*l+this.m[3]*u,e[9]=-(this.m[0]*o-this.m[1]*l+this.m[3]*f),e[13]=this.m[0]*a-this.m[1]*u+this.m[2]*f,e[2]=this.m[1]*y-this.m[2]*m+this.m[3]*V,e[6]=-(this.m[0]*y-this.m[2]*x+this.m[3]*P),e[10]=this.m[0]*w-this.m[1]*x+this.m[3]*K,e[14]=-(this.m[0]*V-this.m[1]*P+this.m[2]*K),e[3]=-(this.m[1]*Y-this.m[2]*z+this.m[3]*N),e[7]=this.m[0]*Y-this.m[2]*$+this.m[3]*O,e[11]=-(this.m[0]*z-this.m[1]*$+this.m[3]*se),e[15]=this.m[0]*N-this.m[1]*O+this.m[2]*se;let _=this.m[0]*e[0]+this.m[1]*e[4]+this.m[2]*e[8]+this.m[3]*e[12];for(let ae=0;ae<4;ae++)for(let re=0;re<4;re++)e[ae*4+re]*=1/_;return new t(e)}clone(){return new t([...this.m])}toString(){return this.m.toString()}};function Yn(t,e,r,o=a=>-Math.cos(a)){return t+(o(r)+1)/2*(e-t)}i(Yn,"wave");var vi=1103515245,xi=12345,Ir=2147483648,It=class{static{i(this,"RNG")}seed;constructor(e){this.seed=e}gen(){return this.seed=(vi*this.seed+xi)%Ir,this.seed/Ir}genNumber(e,r){return e+this.gen()*(r-e)}genVec2(e,r){return new T(this.genNumber(e.x,r.x),this.genNumber(e.y,r.y))}genColor(e,r){return new ee(this.genNumber(e.r,r.r),this.genNumber(e.g,r.g),this.genNumber(e.b,r.b))}genAny(...e){if(e.length===0)return this.gen();if(e.length===1){if(typeof e[0]=="number")return this.genNumber(0,e[0]);if(e[0]instanceof T)return this.genVec2(C(0,0),e[0]);if(e[0]instanceof ee)return this.genColor(oe(0,0,0),e[0])}else if(e.length===2){if(typeof e[0]=="number"&&typeof e[1]=="number")return this.genNumber(e[0],e[1]);if(e[0]instanceof T&&e[1]instanceof T)return this.genVec2(e[0],e[1]);if(e[0]instanceof ee&&e[1]instanceof ee)return this.genColor(e[0],e[1])}}},Wn=new It(Date.now());function kr(t){return t!=null&&(Wn.seed=t),Wn.seed}i(kr,"randSeed");function Lt(...t){return Wn.genAny(...t)}i(Lt,"rand");function Xn(...t){return Math.floor(Lt(...t))}i(Xn,"randi");function Nr(t){return Lt()<=t}i(Nr,"chance");function $n(t){for(let e=t.length-1;e>0;e--){let r=Math.floor(Math.random()*(e+1));[t[e],t[r]]=[t[r],t[e]]}return t}i($n,"shuffle");function _r(t,e){return t.length<=e?t.slice():$n(t.slice()).slice(0,e)}i(_r,"chooseMultiple");function Hr(t){return t[Xn(t.length)]}i(Hr,"choose");function Qn(t,e){return t.pos.x+t.width>e.pos.x&&t.pos.x<e.pos.x+e.width&&t.pos.y+t.height>e.pos.y&&t.pos.y<e.pos.y+e.height}i(Qn,"testRectRect");function yi(t,e){if(t.p1.x===t.p2.x&&t.p1.y===t.p2.y||e.p1.x===e.p2.x&&e.p1.y===e.p2.y)return null;let r=(e.p2.y-e.p1.y)*(t.p2.x-t.p1.x)-(e.p2.x-e.p1.x)*(t.p2.y-t.p1.y);if(r===0)return null;let o=((e.p2.x-e.p1.x)*(t.p1.y-e.p1.y)-(e.p2.y-e.p1.y)*(t.p1.x-e.p1.x))/r,a=((t.p2.x-t.p1.x)*(t.p1.y-e.p1.y)-(t.p2.y-t.p1.y)*(t.p1.x-e.p1.x))/r;return o<0||o>1||a<0||a>1?null:o}i(yi,"testLineLineT");function cn(t,e){let r=yi(t,e);return r?C(t.p1.x+r*(t.p2.x-t.p1.x),t.p1.y+r*(t.p2.y-t.p1.y)):null}i(cn,"testLineLine");function un(t,e){let r=e.p2.sub(e.p1),o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY;if(r.x!=0){let l=(t.pos.x-e.p1.x)/r.x,u=(t.pos.x+t.width-e.p1.x)/r.x;o=Math.max(o,Math.min(l,u)),a=Math.min(a,Math.max(l,u))}if(r.y!=0){let l=(t.pos.y-e.p1.y)/r.y,u=(t.pos.y+t.height-e.p1.y)/r.y;o=Math.max(o,Math.min(l,u)),a=Math.min(a,Math.max(l,u))}return a>=o&&a>=0&&o<=1}i(un,"testRectLine");function Jn(t,e){return e.x>t.pos.x&&e.x<t.pos.x+t.width&&e.y>t.pos.y&&e.y<t.pos.y+t.height}i(Jn,"testRectPoint");function Kr(t,e){let r=Math.max(t.pos.x,Math.min(e.center.x,t.pos.x+t.width)),o=Math.max(t.pos.y,Math.min(e.center.y,t.pos.y+t.height));return C(r,o).sdist(e.center)<=e.radius*e.radius}i(Kr,"testRectCircle");function qr(t,e){return zr(e,new Ae(t.points()))}i(qr,"testRectPolygon");function Zn(t,e){let r=e.sub(t.p1),o=t.p2.sub(t.p1);if(Math.abs(r.cross(o))>Number.EPSILON)return!1;let a=r.dot(o)/o.dot(o);return a>=0&&a<=1}i(Zn,"testLinePoint");function Rt(t,e){let r=t.p2.sub(t.p1),o=r.dot(r),a=t.p1.sub(e.center),l=2*r.dot(a),u=a.dot(a)-e.radius*e.radius,f=l*l-4*o*u;if(o<=Number.EPSILON||f<0)return!1;if(f==0){let y=-l/(2*o);if(y>=0&&y<=1)return!0}else{let y=(-l+Math.sqrt(f))/(2*o),m=(-l-Math.sqrt(f))/(2*o);if(y>=0&&y<=1||m>=0&&m<=1)return!0}return tr(e,t.p1)}i(Rt,"testLineCircle");function er(t,e){if(mt(e,t.p1)||mt(e,t.p2))return!0;for(let r=0;r<e.pts.length;r++){let o=e.pts[r],a=e.pts[(r+1)%e.pts.length];if(cn(t,new Be(o,a)))return!0}return!1}i(er,"testLinePolygon");function tr(t,e){return t.center.sdist(e)<t.radius*t.radius}i(tr,"testCirclePoint");function wi(t,e){return t.center.sdist(e.center)<(t.radius+e.radius)*(t.radius+e.radius)}i(wi,"testCircleCircle");function jt(t,e){let r=e.pts[e.pts.length-1];for(let o of e.pts){if(Rt(new Be(r,o),t))return!0;r=o}return tr(t,e.pts[0])?!0:mt(e,t.center)}i(jt,"testCirclePolygon");function zr(t,e){for(let r=0;r<t.pts.length;r++)if(er(new Be(t.pts[r],t.pts[(r+1)%t.pts.length]),e))return!0;return!!(t.pts.some(r=>mt(e,r))||e.pts.some(r=>mt(t,r)))}i(zr,"testPolygonPolygon");function mt(t,e){let r=!1,o=t.pts;for(let a=0,l=o.length-1;a<o.length;l=a++)o[a].y>e.y!=o[l].y>e.y&&e.x<(o[l].x-o[a].x)*(e.y-o[a].y)/(o[l].y-o[a].y)+o[a].x&&(r=!r);return r}i(mt,"testPolygonPoint");function Wr(t,e){e=e.sub(t.center);let r=ve(t.angle),o=Math.cos(r),a=Math.sin(r),l=e.x*o+e.y*a,u=-e.x*a+e.y*o;return l*l/(t.radiusX*t.radiusX)+u*u/(t.radiusY*t.radiusY)<1}i(Wr,"testEllipsePoint");function an(t,e){let r=e.center.sub(t.center),o=ve(t.angle),a=Math.cos(o),l=Math.sin(o),u=r.x*a+r.y*l,f=-r.x*l+r.y*a;return Wr(new Xe(C(),t.radiusX+e.radius,t.radiusY+e.radius,0),C(u,f))}i(an,"testEllipseCircle");function Yr(t,e){let r=t.toMat2().inverse;return e=new Be(r.transform(e.p1.sub(t.center)),r.transform(e.p2.sub(t.center))),Rt(e,new Fe(C(),1))}i(Yr,"testEllipseLine");function Ci(t,e){if(t.radiusX===t.radiusY)return an(e,new Fe(t.center,t.radiusX));if(e.radiusX===e.radiusY)return an(t,new Fe(e.center,e.radiusX));let r=new bt(1/t.radiusX**2,0,0,0,1/t.radiusY**2,0,0,0,-1),o=new bt(1/e.radiusX**2,0,0,0,1/e.radiusY**2,0,0,0,-1),a=t.center.x,l=t.center.y,u=e.center.x,f=e.center.y,y=ve(t.angle),m=ve(e.angle),V=new bt(Math.cos(y),-Math.sin(y),a,Math.sin(y),Math.cos(y),l,0,0,1),x=new bt(Math.cos(m),-Math.sin(m),u,Math.sin(m),Math.cos(m),f,0,0,1),P=V.inverse,w=x.inverse,K=P.transpose.mul(r).mul(P),Y=w.transpose.mul(o).mul(w),z=K.m11,N=K.m12,$=K.m13,O=K.m21,se=K.m22,_=K.m23,ae=K.m31,re=K.m32,ce=K.m33,ge=Y.m11,Ue=Y.m12,Ce=Y.m13,Le=Y.m21,je=Y.m22,Ee=Y.m23,Ne=Y.m31,_e=Y.m32,He=Y.m33,pt=z*se*ce-z*_*re-N*O*ce+N*_*ae+$*O*re-$*se*ae,Se=(z*se*He-z*_*_e-z*re*Ee+z*ce*je-N*O*He+N*_*Ne+N*ae*Ee-N*ce*Le+$*O*_e-$*se*Ne-$*ae*je+$*re*Le+O*re*Ce-O*ce*Ue-se*ae*Ce+se*ce*ge+_*ae*Ue-_*re*ge)/pt,Ve=(z*je*He-z*Ee*_e-N*Le*He+N*Ee*Ne+$*Le*_e-$*je*Ne-O*Ue*He+O*Ce*_e+se*ge*He-se*Ce*Ne-_*ge*_e+_*Ue*Ne+ae*Ue*Ee-ae*Ce*je-re*ge*Ee+re*Ce*Le+ce*ge*je-ce*Ue*Le)/pt,ze=(ge*je*He-ge*Ee*_e-Ue*Le*He+Ue*Ee*Ne+Ce*Le*_e-Ce*je*Ne)/pt;if(Se>=0){let rt=-3*Ve+Se**2,ot=3*Se*ze+Ve*Se**2-4*Ve**2,wt=-27*ze**2+18*ze*Se*Ve+Se**2*Ve**2-4*Se**3*ze-4*Ve**3;return!(rt>0&&ot<0&&wt>0)}else{let rt=-3*Ve+Se**2,ot=-27*ze**2+18*ze*Se*Ve+Se**2*Ve**2-4*Se**3*ze-4*Ve**3;return!(rt>0&&ot>0)}}i(Ci,"testEllipseEllipse");function Xr(t,e){return nr(t,new Ae(e.points()))}i(Xr,"testEllipseRect");function nr(t,e){let r=t.toMat2().inverse;return e=new Ae(e.pts.map(o=>r.transform(o.sub(t.center)))),jt(new Fe(C(),1),e)}i(nr,"testEllipsePolygon");function Ti(t,e){return e instanceof T?Zn(t,e):e instanceof Fe?Rt(t,e):e instanceof Be?cn(t,e)!=null:e instanceof ue?un(e,t):e instanceof Ae?er(t,e):e instanceof Xe?Yr(e,t):!1}i(Ti,"testLineShape");function Ei(t,e){return e instanceof T?tr(t,e):e instanceof Fe?wi(t,e):e instanceof Be?Rt(e,t):e instanceof ue?Kr(e,t):e instanceof Ae?jt(t,e):e instanceof Xe?an(e,t):!1}i(Ei,"testCircleShape");function Si(t,e){return e instanceof T?Jn(t,e):e instanceof Fe?Kr(t,e):e instanceof Be?un(t,e):e instanceof ue?Qn(t,e):e instanceof Ae?qr(t,e):e instanceof Xe?Xr(e,t):!1}i(Si,"testRectShape");function Oi(t,e){return e instanceof T?mt(t,e):e instanceof Fe?jt(e,t):e instanceof Be?er(e,t):e instanceof ue?qr(e,t):e instanceof Ae?zr(e,t):e instanceof Xe?nr(e,t):!1}i(Oi,"testPolygonShape");function Ai(t,e){return e instanceof T?Wr(t,e):e instanceof Fe?an(t,e):e instanceof Be?Yr(t,e):e instanceof ue?Xr(t,e):e instanceof Ae?nr(t,e):e instanceof Xe?Ci(e,t):!1}i(Ai,"testEllipseShape");function $r(t,e,r){let o=t,a=r.p1,l=r.p2,u=e,f=l.sub(a),y=u.cross(f);if(Math.abs(y)<Number.EPSILON)return null;let m=a.sub(o),V=m.cross(f)/y;if(V<=0||V>=1)return null;let x=m.cross(u)/y;if(x<=0||x>=1)return null;let P=f.normal().unit();return e.dot(P)>0&&(P.x*=-1,P.y*=-1),{point:o.add(u.scale(V)),normal:P,fraction:V}}i($r,"raycastLine");function Ri(t,e,r){let o=Number.NEGATIVE_INFINITY,a=Number.POSITIVE_INFINITY,l;if(t.x!=0){let u=(r.pos.x-t.x)/e.x,f=(r.pos.x+r.width-t.x)/e.x;l=C(-Math.sign(e.x),0),o=Math.max(o,Math.min(u,f)),a=Math.min(a,Math.max(u,f))}if(t.y!=0){let u=(r.pos.y-t.y)/e.y,f=(r.pos.y+r.height-t.y)/e.y;Math.min(u,f)>o&&(l=C(0,-Math.sign(e.y))),o=Math.max(o,Math.min(u,f)),a=Math.min(a,Math.max(u,f))}return a>=o&&o>=0&&o<=1?{point:t.add(e.scale(o)),normal:l,fraction:o}:null}i(Ri,"raycastRect");function Qr(t,e,r){let o=t,a=r.center,l=e,u=l.dot(l),f=o.sub(a),y=2*l.dot(f),m=f.dot(f)-r.radius*r.radius,V=y*y-4*u*m;if(u<=Number.EPSILON||V<0)return null;if(V==0){let x=-y/(2*u);if(x>=0&&x<=1){let P=o.add(l.scale(x));return{point:P,normal:P.sub(a),fraction:x}}}else{let x=(-y+Math.sqrt(V))/(2*u),P=(-y-Math.sqrt(V))/(2*u),w=null;if(x>=0&&x<=1&&(w=x),P>=0&&P<=1&&(w=Math.min(P,w??P)),w!=null){let K=o.add(l.scale(w));return{point:K,normal:K.sub(a).unit(),fraction:w}}}return null}i(Qr,"raycastCircle");function Ui(t,e,r){let o=r.pts,a=null,l=o[o.length-1];for(let u=0;u<o.length;u++){let f=o[u],y=$r(t,e,new Be(l,f));y&&(!a||a.fraction>y.fraction)&&(a=y),l=f}return a}i(Ui,"raycastPolygon");function Vi(t,e,r){let o=r.toMat2(),a=o.inverse,l=a.transform(t.sub(r.center)),u=a.transform(e),f=Qr(l,u,new Fe(C(),1));if(f){let y=At.rotation(ve(-r.angle)),V=At.scale(r.radiusX,r.radiusY).transform(f.point),x=o.transform(f.point).add(r.center),P=x.dist(t)/e.len();return{point:x,normal:y.transform(C(r.radiusY**2*V.x,r.radiusX**2*V.y)),fraction:P}}return f}i(Vi,"raycastEllipse");function Jr(t,e,r,o=64){let a=t,l=e.len(),u=e.scale(1/l),f=0,y=C(Math.floor(t.x),Math.floor(t.y)),m=C(u.x>0?1:-1,u.y>0?1:-1),V=C(Math.abs(1/u.x),Math.abs(1/u.y)),x=C(m.x>0?y.x+1-t.x:t.x-y.x,m.y>0?y.y+1-t.y:t.y-y.y),P=C(V.x<1/0?V.x*x.x:1/0,V.y<1/0?V.y*x.y:1/0),w=-1;for(;f<=o;){let K=r(y);if(K===!0)return{point:a.add(u.scale(f)),normal:C(w===0?-m.x:0,w===1?-m.y:0),fraction:f/l,gridPos:y};if(K)return K;P.x<P.y?(y.x+=m.x,f=P.x,P.x+=V.x,w=0):(y.y+=m.y,f=P.y,P.y+=V.y,w=1)}return null}i(Jr,"raycastGrid");var Be=class t{static{i(this,"Line")}p1;p2;constructor(e,r){this.p1=e.clone(),this.p2=r.clone()}transform(e){return new t(e.multVec2(this.p1),e.multVec2(this.p2))}bbox(){return ue.fromPoints(this.p1,this.p2)}area(){return this.p1.dist(this.p2)}clone(){return new t(this.p1,this.p2)}collides(e){return Ti(this,e)}contains(e){return this.collides(e)}raycast(e,r){return $r(e,r,this)}},ue=class t{static{i(this,"Rect")}pos;width;height;constructor(e,r,o){this.pos=e.clone(),this.width=r,this.height=o}static fromPoints(e,r){return new t(e.clone(),r.x-e.x,r.y-e.y)}center(){return new T(this.pos.x+this.width/2,this.pos.y+this.height/2)}points(){return[this.pos,this.pos.add(this.width,0),this.pos.add(this.width,this.height),this.pos.add(0,this.height)]}transform(e){return new Ae(this.points().map(r=>e.multVec2(r)))}bbox(){return this.clone()}area(){return this.width*this.height}clone(){return new t(this.pos.clone(),this.width,this.height)}distToPoint(e){return Math.sqrt(this.sdistToPoint(e))}sdistToPoint(e){let r=this.pos,o=this.pos.add(this.width,this.height),a=Math.max(r.x-e.x,0,e.x-o.x),l=Math.max(r.y-e.y,0,e.y-o.y);return a*a+l*l}collides(e){return Si(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Ri(e,r,this)}},Fe=class t{static{i(this,"Circle")}center;radius;constructor(e,r){this.center=e.clone(),this.radius=r}transform(e){return new Xe(this.center,this.radius,this.radius).transform(e)}bbox(){return ue.fromPoints(this.center.sub(C(this.radius)),this.center.add(C(this.radius)))}area(){return this.radius*this.radius*Math.PI}clone(){return new t(this.center,this.radius)}collides(e){return Ei(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Qr(e,r,this)}},Xe=class t{static{i(this,"Ellipse")}center;radiusX;radiusY;angle;constructor(e,r,o,a=0){this.center=e.clone(),this.radiusX=r,this.radiusY=o,this.angle=a}static fromMat2(e){let r=e.inverse,o=r.transpose.mul(r),[a,l]=o.eigenvalues,[u,f]=o.eigenvectors(a,l),[y,m]=[1/Math.sqrt(a),1/Math.sqrt(l)];return y>m?new t(C(),y,m,lt(Math.atan2(-u[1],u[0]))):new t(C(),m,y,lt(Math.atan2(-f[1],f[0])))}toMat2(){let e=ve(this.angle),r=Math.cos(e),o=Math.sin(e);return new At(r*this.radiusX,o*this.radiusY,-o*this.radiusX,r*this.radiusY)}transform(e){if(this.angle==0&&e.getRotation()==0)return new t(e.multVec2(this.center),e.m[0]*this.radiusX,e.m[5]*this.radiusY);{let r=this.toMat2(),o=e.getRotation(),a=e.getScale();r=bt.fromMat2(r).scale(a.x,a.y).rotate(o).toMat2();let u=t.fromMat2(r);return u.center=e.multVec2(this.center),u}}bbox(){if(this.angle==0)return ue.fromPoints(this.center.sub(C(this.radiusX,this.radiusY)),this.center.add(C(this.radiusX,this.radiusY)));{let e=ve(this.angle),r=Math.cos(e),o=Math.sin(e),a=this.radiusX*r,l=this.radiusX*o,u=this.radiusY*o,f=this.radiusY*r,y=Math.sqrt(a*a+u*u),m=Math.sqrt(l*l+f*f);return ue.fromPoints(this.center.sub(C(y,m)),this.center.add(C(y,m)))}}area(){return this.radiusX*this.radiusY*Math.PI}clone(){return new t(this.center,this.radiusX,this.radiusY,this.angle)}collides(e){return Ai(this,e)}contains(e){e=e.sub(this.center);let r=ve(this.angle),o=Math.cos(r),a=Math.sin(r),l=e.x*o+e.y*a,u=-e.x*a+e.y*o;return l*l/(this.radiusX*this.radiusX)+u*u/(this.radiusY*this.radiusY)<1}raycast(e,r){return Vi(e,r,this)}},Ae=class t{static{i(this,"Polygon")}pts;constructor(e){if(e.length<3)throw new Error("Polygons should have at least 3 vertices");this.pts=e}transform(e){return new t(this.pts.map(r=>e.multVec2(r)))}bbox(){let e=C(Number.MAX_VALUE),r=C(-Number.MAX_VALUE);for(let o of this.pts)e.x=Math.min(e.x,o.x),r.x=Math.max(r.x,o.x),e.y=Math.min(e.y,o.y),r.y=Math.max(r.y,o.y);return ue.fromPoints(e,r)}area(){let e=0,r=this.pts.length;for(let o=0;o<r;o++){let a=this.pts[o],l=this.pts[(o+1)%r];e+=a.x*l.y*.5,e-=l.x*a.y*.5}return Math.abs(e)}clone(){return new t(this.pts.map(e=>e.clone()))}collides(e){return Oi(this,e)}contains(e){return this.collides(e)}raycast(e,r){return Ui(e,r,this)}};function rr(t,e,r,o,a){let l=a*a,u=l*a,f=1-a,y=f*f,m=y*f;return t.scale(m).add(e.scale(3*y*a)).add(r.scale(3*f*l)).add(o.scale(u))}i(rr,"evaluateBezier");function Zr(t,e){let r=Number.MAX_VALUE,o=C(0);for(let a of[t,e])for(let l=0;l<a.pts.length;l++){let u=a.pts[l],y=a.pts[(l+1)%a.pts.length].sub(u).normal().unit(),m=Number.MAX_VALUE,V=-Number.MAX_VALUE;for(let K=0;K<t.pts.length;K++){let Y=t.pts[K].dot(y);m=Math.min(m,Y),V=Math.max(V,Y)}let x=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let K=0;K<e.pts.length;K++){let Y=e.pts[K].dot(y);x=Math.min(x,Y),P=Math.max(P,Y)}let w=Math.min(V,P)-Math.max(m,x);if(w<0)return null;if(w<Math.abs(r)){let K=P-m,Y=x-V;r=Math.abs(K)<Math.abs(Y)?K:Y,o=y.scale(r)}}return o}i(Zr,"sat");function eo(t,e,r){return(e.x-t.x)*(r.y-t.y)-(e.y-t.y)*(r.x-t.x)>=0}i(eo,"isOrientedCcw");function Pi(t){let e=0,r=t[t.length-1];for(let o=0;o<t.length;o++)e+=(t[o].x-r.x)*(t[o].y+r.y),r=t[o];return e<0}i(Pi,"isOrientedCcwPolygon");function zn(t,e,r,o){let a=o.x-r.x,l=o.y-r.y,u=a*(t.y-r.y)-l*(t.x-r.x),f=a*(e.y-r.y)-l*(e.x-r.x);return u*f>=0}i(zn,"onSameSide");function Di(t,e,r,o){return zn(t,e,r,o)&&zn(t,r,e,o)&&zn(t,o,e,r)}i(Di,"pointInTriangle");function Mi(t,e,r,o){for(let a of t)if(a!==e&&a!==r&&a!==o&&Di(a,e,r,o))return!0;return!1}i(Mi,"someInTriangle");function Gi(t,e,r,o){return eo(t,e,r)&&!Mi(o,t,e,r)}i(Gi,"isEar");function or(t){if(t.length<3)return[];if(t.length==3)return[t];let e=[],r=[],o=0;for(let x=0;x<t.length;x++){let P=t[o],w=t[x];(w.x<P.x||w.x==P.x&&w.y<P.y)&&(o=o),e[x]=x+1,r[x]=x-1}e[e.length-1]=0,r[0]=r.length-1,Pi(t)||([e,r]=[r,e]);let a=[];for(let x=0;x<t.length;++x)eo(t[r[x]],t[x],t[e[x]])||a.push(t[x]);let l=[],u=t.length,f=1,y=0,m,V;for(;u>3;){m=e[f],V=r[f];let x=t[V],P=t[f],w=t[m];if(Gi(x,P,w,a))l.push([x,P,w]),e[V]=m,r[m]=V,a.splice(a.indexOf(P),1),--u,y=0;else if(++y>u)return[];f=m}return m=e[f],V=r[f],l.push([t[V],t[f],t[m]]),l}i(or,"triangulate");function sr(t){if(t.length<3)return!1;let e=t.length-2,r=t.length-1,o=0,a=t[r].sub(t[e]),l=t[o].sub(t[r]),u=a.cross(l);for(;o+1<t.length;)if(e=r,r=o,o++,a=t[r].sub(t[e]),l=t[o].sub(t[r]),a.cross(l)*u<0)return!1;return!0}i(sr,"isConvex");var kt=class extends Map{static{i(this,"Registry")}lastID=0;push(e){let r=this.lastID;return this.set(r,e),this.lastID++,r}pushd(e){let r=this.push(e);return()=>this.delete(r)}},et=class t{static{i(this,"EventController")}paused=!1;cancel;constructor(e){this.cancel=e}static join(e){let r=new t(()=>e.forEach(o=>o.cancel()));return Object.defineProperty(r,"paused",{get:()=>e[0].paused,set:o=>e.forEach(a=>a.paused=o)}),r.paused=!1,r}},we=class{static{i(this,"Event")}handlers=new kt;add(e){let r=this.handlers.pushd((...a)=>{o.paused||e(...a)}),o=new et(r);return o}addOnce(e){let r=this.add((...o)=>{r.cancel(),e(...o)});return r}next(){return new Promise(e=>this.addOnce(e))}trigger(...e){this.handlers.forEach(r=>r(...e))}numListeners(){return this.handlers.size}clear(){this.handlers.clear()}},tt=class{static{i(this,"EventHandler")}handlers={};on(e,r){return this.handlers[e]||(this.handlers[e]=new we),this.handlers[e].add(r)}onOnce(e,r){let o=this.on(e,(...a)=>{o.cancel(),r(...a)});return o}next(e){return new Promise(r=>{this.onOnce(e,(...o)=>r(o[0]))})}trigger(e,...r){this.handlers[e]&&this.handlers[e].trigger(...r)}remove(e){delete this.handlers[e]}clear(){this.handlers={}}numListeners(e){return this.handlers[e]?.numListeners()??0}};function mn(t,e){if(t===e)return!0;let r=typeof t,o=typeof e;if(r!==o)return!1;if(r==="object"&&o==="object"&&t!==null&&e!==null){if(Array.isArray(t)!==Array.isArray(e))return!1;let a=Object.keys(t),l=Object.keys(e);if(a.length!==l.length)return!1;for(let u of a){let f=t[u],y=e[u];if(!mn(f,y))return!1}return!0}return!1}i(mn,"deepEq");function Bi(t){let e=window.atob(t),r=e.length,o=new Uint8Array(r);for(let a=0;a<r;a++)o[a]=e.charCodeAt(a);return o.buffer}i(Bi,"base64ToArrayBuffer");function no(t){return Bi(t.split(",")[1])}i(no,"dataURLToArrayBuffer");function dn(t,e){let r=document.createElement("a");r.href=e,r.download=t,r.click()}i(dn,"download");function ir(t,e){dn(t,"data:text/plain;charset=utf-8,"+e)}i(ir,"downloadText");function ro(t,e){ir(t,JSON.stringify(e))}i(ro,"downloadJSON");function ar(t,e){let r=URL.createObjectURL(e);dn(t,r),URL.revokeObjectURL(r)}i(ar,"downloadBlob");var cr=i(t=>t.match(/^data:\w+\/\w+;base64,.+/),"isDataURL");var oo=i(t=>t.split(".").slice(0,-1).join("."),"getFileName");function Ie(t,e){return(...r)=>{let o=r.length;if(o===t.length)return t(...r);if(o===e.length)return e(...r)}}i(Ie,"overload2");var so=(()=>{let t=0;return()=>t++})(),io=i(t=>t instanceof Error?t.message:String(t),"getErrorMessage");var ln=class{static{i(this,"BinaryHeap")}_items;_compareFn;constructor(e=(r,o)=>r<o){this._compareFn=e,this._items=[]}insert(e){this._items.push(e),this.moveUp(this._items.length-1)}remove(){if(this._items.length===0)return null;let e=this._items[0],r=this._items.pop();return this._items.length!==0&&(this._items[0]=r,this.moveDown(0)),e}clear(){this._items.splice(0,this._items.length)}moveUp(e){for(;e>0;){let r=Math.floor((e-1)/2);if(!this._compareFn(this._items[e],this._items[r])&&this._items[e]>=this._items[r])break;this.swap(e,r),e=r}}moveDown(e){for(;e<Math.floor(this._items.length/2);){let r=2*e+1;if(r<this._items.length-1&&!this._compareFn(this._items[r],this._items[r+1])&&++r,this._compareFn(this._items[e],this._items[r]))break;this.swap(e,r),e=r}}swap(e,r){[this._items[e],this._items[r]]=[this._items[r],this._items[e]]}get length(){return this._items.length}};var Fi=Object.freeze([776,2359,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520]);function ao(t){if(typeof t!="string")throw new TypeError("string cannot be undefined or null");let e=[],r=0,o=0;for(;r<t.length;){if(o+=Ii(r+o,t),Ki(t[r+o])&&o++,Ni(t[r+o])&&o++,_i(t[r+o])&&o++,qi(t[r+o])){o++;continue}e.push(t.substring(r,r+o)),r+=o,o=0}return e}i(ao,"runes");function Ii(t,e){let r=e[t];if(!Li(r)||t===e.length-1)return 1;let o=r+e[t+1],a=e.substring(t+2,t+5);return to(o)&&to(a)?4:ji(o)&&Hi(a)?e.slice(t).indexOf(String.fromCodePoint(917631))+2:ki(a)?4:2}i(Ii,"nextUnits");function Li(t){return t&&vt(t[0].charCodeAt(0),55296,56319)}i(Li,"isFirstOfSurrogatePair");function to(t){return vt(ur(t),127462,127487)}i(to,"isRegionalIndicator");function ji(t){return vt(ur(t),127988,127988)}i(ji,"isSubdivisionFlag");function ki(t){return vt(ur(t),127995,127999)}i(ki,"isFitzpatrickModifier");function Ni(t){return typeof t=="string"&&vt(t.charCodeAt(0),65024,65039)}i(Ni,"isVariationSelector");function _i(t){return typeof t=="string"&&vt(t.charCodeAt(0),8400,8447)}i(_i,"isDiacriticalMark");function Hi(t){let e=t.codePointAt(0);return typeof t=="string"&&typeof e=="number"&&vt(e,917504,917631)}i(Hi,"isSupplementarySpecialpurposePlane");function Ki(t){return typeof t=="string"&&Fi.includes(t.charCodeAt(0))}i(Ki,"isGrapheme");function qi(t){return typeof t=="string"&&t.charCodeAt(0)===8205}i(qi,"isZeroWidthJoiner");function ur(t){let e=t.charCodeAt(0)-55296,r=t.charCodeAt(1)-56320;return(e<<10)+r+65536}i(ur,"codePointFromSurrogatePair");function vt(t,e,r){return t>=e&&t<=r}i(vt,"betweenInclusive");var lr={"Joy-Con L+R (STANDARD GAMEPAD Vendor: 057e Product: 200e)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},"Joy-Con (L) (STANDARD GAMEPAD Vendor: 057e Product: 2006)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"select","10":"lstick","16":"start"},sticks:{left:{x:0,y:1}}},"Joy-Con (R) (STANDARD GAMEPAD Vendor: 057e Product: 2007)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","9":"start","10":"lstick","16":"select"},sticks:{left:{x:0,y:1}}},"Pro Controller (STANDARD GAMEPAD Vendor: 057e Product: 2009)":{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home","17":"capture"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}},default:{buttons:{"0":"south","1":"east","2":"west","3":"north","4":"lshoulder","5":"rshoulder","6":"ltrigger","7":"rtrigger","8":"select","9":"start","10":"lstick","11":"rstick","12":"dpad-up","13":"dpad-down","14":"dpad-left","15":"dpad-right","16":"home"},sticks:{left:{x:0,y:1},right:{x:2,y:3}}}};var Ut=class{static{i(this,"ButtonState")}pressed=new Set([]);pressedRepeat=new Set([]);released=new Set([]);down=new Set([]);update(){this.pressed.clear(),this.released.clear(),this.pressedRepeat.clear()}press(e){this.pressed.add(e),this.pressedRepeat.add(e),this.down.add(e)}pressRepeat(e){this.pressedRepeat.add(e)}release(e){this.down.delete(e),this.pressed.delete(e),this.released.add(e)}},mr=class{static{i(this,"GamepadState")}buttonState=new Ut;stickState=new Map},dr=class{static{i(this,"FPSCounter")}dts=[];timer=0;fps=0;tick(e){this.dts.push(e),this.timer+=e,this.timer>=1&&(this.timer=0,this.fps=Math.round(1/(this.dts.reduce((r,o)=>r+o)/this.dts.length)),this.dts=[])}},co=i(t=>{if(!t.canvas)throw new Error("Please provide a canvas");let e={canvas:t.canvas,loopID:null,stopped:!1,dt:0,time:0,realTime:0,fpsCounter:new dr,timeScale:1,skipTime:!1,isHidden:!1,numFrames:0,mousePos:new T(0),mouseDeltaPos:new T(0),keyState:new Ut,mouseState:new Ut,mergedGamepadState:new mr,gamepadStates:new Map,gamepads:[],charInputted:[],isMouseMoved:!1,lastWidth:t.canvas.offsetWidth,lastHeight:t.canvas.offsetHeight,events:new tt};function r(){return e.dt*e.timeScale}i(r,"dt");function o(){return e.isHidden}i(o,"isHidden");function a(){return e.time}i(a,"time");function l(){return e.fpsCounter.fps}i(l,"fps");function u(){return e.numFrames}i(u,"numFrames");function f(){return e.canvas.toDataURL()}i(f,"screenshot");function y(p){e.canvas.style.cursor=p}i(y,"setCursor");function m(){return e.canvas.style.cursor}i(m,"getCursor");function V(p){if(p)try{let S=e.canvas.requestPointerLock();S.catch&&S.catch(L=>console.error(L))}catch(S){console.error(S)}else document.exitPointerLock()}i(V,"setCursorLocked");function x(){return!!document.pointerLockElement}i(x,"isCursorLocked");function P(p){p.requestFullscreen?p.requestFullscreen():p.webkitRequestFullscreen&&p.webkitRequestFullscreen()}i(P,"enterFullscreen");function w(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullScreen&&document.webkitExitFullScreen()}i(w,"exitFullscreen");function K(){return document.fullscreenElement||document.webkitFullscreenElement}i(K,"getFullscreenElement");function Y(p=!0){p?P(e.canvas):w()}i(Y,"setFullscreen");function z(){return!!K()}i(z,"isFullscreen");function N(){e.stopped=!0;for(let p in he)e.canvas.removeEventListener(p,he[p]);for(let p in Ke)document.removeEventListener(p,Ke[p]);for(let p in xe)window.removeEventListener(p,xe[p]);at.disconnect()}i(N,"quit");function $(p){e.loopID!==null&&cancelAnimationFrame(e.loopID);let S=0,L=i(W=>{if(e.stopped)return;if(document.visibilityState!=="visible"){e.loopID=requestAnimationFrame(L);return}let ye=W/1e3,ie=ye-e.realTime,We=t.maxFPS?1/t.maxFPS:0;e.realTime=ye,S+=ie,S>We&&(e.skipTime||(e.dt=S,e.time+=r(),e.fpsCounter.tick(e.dt)),S=0,e.skipTime=!1,e.numFrames++,Gn(),p(),Mt()),e.loopID=requestAnimationFrame(L)},"frame");L(0)}i($,"run");function O(){return"ontouchstart"in window||navigator.maxTouchPoints>0}i(O,"isTouchscreen");function se(){return e.mousePos.clone()}i(se,"mousePos");function _(){return e.mouseDeltaPos.clone()}i(_,"mouseDeltaPos");function ae(p="left"){return e.mouseState.pressed.has(p)}i(ae,"isMousePressed");function re(p="left"){return e.mouseState.down.has(p)}i(re,"isMouseDown");function ce(p="left"){return e.mouseState.released.has(p)}i(ce,"isMouseReleased");function ge(){return e.isMouseMoved}i(ge,"isMouseMoved");function Ue(p){return p===void 0?e.keyState.pressed.size>0:e.keyState.pressed.has(p)}i(Ue,"isKeyPressed");function Ce(p){return p===void 0?e.keyState.pressedRepeat.size>0:e.keyState.pressedRepeat.has(p)}i(Ce,"isKeyPressedRepeat");function Le(p){return p===void 0?e.keyState.down.size>0:e.keyState.down.has(p)}i(Le,"isKeyDown");function je(p){return p===void 0?e.keyState.released.size>0:e.keyState.released.has(p)}i(je,"isKeyReleased");function Ee(p){return p===void 0?e.mergedGamepadState.buttonState.pressed.size>0:e.mergedGamepadState.buttonState.pressed.has(p)}i(Ee,"isGamepadButtonPressed");function Ne(p){return p===void 0?e.mergedGamepadState.buttonState.down.size>0:e.mergedGamepadState.buttonState.down.has(p)}i(Ne,"isGamepadButtonDown");function _e(p){return p===void 0?e.mergedGamepadState.buttonState.released.size>0:e.mergedGamepadState.buttonState.released.has(p)}i(_e,"isGamepadButtonReleased");function He(p){return e.events.on("resize",p)}i(He,"onResize");let pt=Ie(p=>e.events.on("keyDown",p),(p,S)=>e.events.on("keyDown",L=>L===p&&S(p))),Se=Ie(p=>e.events.on("keyPress",p),(p,S)=>e.events.on("keyPress",L=>L===p&&S(p))),Ve=Ie(p=>e.events.on("keyPressRepeat",p),(p,S)=>e.events.on("keyPressRepeat",L=>L===p&&S(p))),ze=Ie(p=>e.events.on("keyRelease",p),(p,S)=>e.events.on("keyRelease",L=>L===p&&S(p))),rt=Ie(p=>e.events.on("mouseDown",S=>p(S)),(p,S)=>e.events.on("mouseDown",L=>L===p&&S(L))),ot=Ie(p=>e.events.on("mousePress",S=>p(S)),(p,S)=>e.events.on("mousePress",L=>L===p&&S(L))),wt=Ie(p=>e.events.on("mouseRelease",S=>p(S)),(p,S)=>e.events.on("mouseRelease",L=>L===p&&S(L)));function Wt(p){return e.events.on("mouseMove",()=>p(se(),_()))}i(Wt,"onMouseMove");function Yt(p){return e.events.on("charInput",p)}i(Yt,"onCharInput");function An(p){return e.events.on("touchStart",p)}i(An,"onTouchStart");function Xt(p){return e.events.on("touchMove",p)}i(Xt,"onTouchMove");function Rn(p){return e.events.on("touchEnd",p)}i(Rn,"onTouchEnd");function Un(p){return e.events.on("scroll",p)}i(Un,"onScroll");function $t(p){return e.events.on("hide",p)}i($t,"onHide");function Vn(p){return e.events.on("show",p)}i(Vn,"onShow");function Pn(p,S){if(typeof p=="function")return e.events.on("gamepadButtonDown",p);if(typeof p=="string"&&typeof S=="function")return e.events.on("gamepadButtonDown",L=>L===p&&S(p))}i(Pn,"onGamepadButtonDown");function Qt(p,S){if(typeof p=="function")return e.events.on("gamepadButtonPress",p);if(typeof p=="string"&&typeof S=="function")return e.events.on("gamepadButtonPress",L=>L===p&&S(p))}i(Qt,"onGamepadButtonPress");function Jt(p,S){if(typeof p=="function")return e.events.on("gamepadButtonRelease",p);if(typeof p=="string"&&typeof S=="function")return e.events.on("gamepadButtonRelease",L=>L===p&&S(p))}i(Jt,"onGamepadButtonRelease");function Dn(p,S){return e.events.on("gamepadStick",(L,W)=>L===p&&S(W))}i(Dn,"onGamepadStick");function Dt(p){e.events.on("gamepadConnect",p)}i(Dt,"onGamepadConnect");function Mn(p){e.events.on("gamepadDisconnect",p)}i(Mn,"onGamepadDisconnect");function st(p){return e.mergedGamepadState.stickState.get(p)||new T(0)}i(st,"getGamepadStick");function Pe(){return[...e.charInputted]}i(Pe,"charInputted");function Ct(){return[...e.gamepads]}i(Ct,"getGamepads");function Gn(){e.events.trigger("input"),e.keyState.down.forEach(p=>e.events.trigger("keyDown",p)),e.mouseState.down.forEach(p=>e.events.trigger("mouseDown",p)),de()}i(Gn,"processInput");function Mt(){e.keyState.update(),e.mouseState.update(),e.mergedGamepadState.buttonState.update(),e.mergedGamepadState.stickState.forEach((p,S)=>{e.mergedGamepadState.stickState.set(S,new T(0))}),e.charInputted=[],e.isMouseMoved=!1,e.gamepadStates.forEach(p=>{p.buttonState.update(),p.stickState.forEach((S,L)=>{p.stickState.set(L,new T(0))})})}i(Mt,"resetInput");function Zt(p){let S={index:p.index,isPressed:L=>e.gamepadStates.get(p.index).buttonState.pressed.has(L),isDown:L=>e.gamepadStates.get(p.index).buttonState.down.has(L),isReleased:L=>e.gamepadStates.get(p.index).buttonState.released.has(L),getStick:L=>e.gamepadStates.get(p.index).stickState.get(L)};return e.gamepads.push(S),e.gamepadStates.set(p.index,{buttonState:new Ut,stickState:new Map([["left",new T(0)],["right",new T(0)]])}),S}i(Zt,"registerGamepad");function Bn(p){e.gamepads=e.gamepads.filter(S=>S.index!==p.index),e.gamepadStates.delete(p.index)}i(Bn,"removeGamepad");function de(){for(let p of navigator.getGamepads())p&&!e.gamepadStates.has(p.index)&&Zt(p);for(let p of e.gamepads){let S=navigator.getGamepads()[p.index],W=(t.gamepads??{})[S.id]??lr[S.id]??lr.default,ye=e.gamepadStates.get(p.index);for(let ie=0;ie<S.buttons.length;ie++)S.buttons[ie].pressed?(ye.buttonState.down.has(W.buttons[ie])||(e.mergedGamepadState.buttonState.press(W.buttons[ie]),ye.buttonState.press(W.buttons[ie]),e.events.trigger("gamepadButtonPress",W.buttons[ie])),e.events.trigger("gamepadButtonDown",W.buttons[ie])):ye.buttonState.down.has(W.buttons[ie])&&(e.mergedGamepadState.buttonState.release(W.buttons[ie]),ye.buttonState.release(W.buttons[ie]),e.events.trigger("gamepadButtonRelease",W.buttons[ie]));for(let ie in W.sticks){let We=W.sticks[ie],ft=new T(S.axes[We.x],S.axes[We.y]);ye.stickState.set(ie,ft),e.mergedGamepadState.stickState.set(ie,ft),e.events.trigger("gamepadStick",ie,ft)}}}i(de,"processGamepad");let he={},Ke={},xe={},Oe=t.pixelDensity||window.devicePixelRatio||1;he.mousemove=p=>{let S=new T(p.offsetX,p.offsetY),L=new T(p.movementX,p.movementY);if(z()){let W=e.canvas.width/Oe,ye=e.canvas.height/Oe,ie=window.innerWidth,We=window.innerHeight,ft=ie/We,tn=W/ye;if(ft>tn){let Ye=We/ye,Tt=(ie-W*Ye)/2;S.x=dt(p.offsetX-Tt,0,W*Ye,0,W),S.y=dt(p.offsetY,0,ye*Ye,0,ye)}else{let Ye=ie/W,Tt=(We-ye*Ye)/2;S.x=dt(p.offsetX,0,W*Ye,0,W),S.y=dt(p.offsetY-Tt,0,ye*Ye,0,ye)}}e.events.onOnce("input",()=>{e.isMouseMoved=!0,e.mousePos=S,e.mouseDeltaPos=L,e.events.trigger("mouseMove")})};let it=["left","middle","right","back","forward"];he.mousedown=p=>{e.events.onOnce("input",()=>{let S=it[p.button];S&&(e.mouseState.press(S),e.events.trigger("mousePress",S))})},he.mouseup=p=>{e.events.onOnce("input",()=>{let S=it[p.button];S&&(e.mouseState.release(S),e.events.trigger("mouseRelease",S))})};let Gt=new Set([" ","ArrowLeft","ArrowRight","ArrowUp","ArrowDown","Tab"]),en={ArrowLeft:"left",ArrowRight:"right",ArrowUp:"up",ArrowDown:"down"," ":"space"};he.keydown=p=>{Gt.has(p.key)&&p.preventDefault(),e.events.onOnce("input",()=>{let S=en[p.key]||p.key.toLowerCase();S.length===1?(e.events.trigger("charInput",S),e.charInputted.push(S)):S==="space"&&(e.events.trigger("charInput"," "),e.charInputted.push(" ")),p.repeat?(e.keyState.pressRepeat(S),e.events.trigger("keyPressRepeat",S)):(e.keyState.press(S),e.events.trigger("keyPressRepeat",S),e.events.trigger("keyPress",S))})},he.keyup=p=>{e.events.onOnce("input",()=>{let S=en[p.key]||p.key.toLowerCase();e.keyState.release(S),e.events.trigger("keyRelease",S)})},he.touchstart=p=>{p.preventDefault(),e.events.onOnce("input",()=>{let S=[...p.changedTouches],L=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new T(S[0].clientX-L.x,S[0].clientY-L.y),e.mouseState.press("left"),e.events.trigger("mousePress","left")),S.forEach(W=>{e.events.trigger("touchStart",new T(W.clientX-L.x,W.clientY-L.y),W)})})},he.touchmove=p=>{p.preventDefault(),e.events.onOnce("input",()=>{let S=[...p.changedTouches],L=e.canvas.getBoundingClientRect();if(t.touchToMouse!==!1){let W=e.mousePos;e.mousePos=new T(S[0].clientX-L.x,S[0].clientY-L.y),e.mouseDeltaPos=e.mousePos.sub(W),e.events.trigger("mouseMove")}S.forEach(W=>{e.events.trigger("touchMove",new T(W.clientX-L.x,W.clientY-L.y),W)})})},he.touchend=p=>{e.events.onOnce("input",()=>{let S=[...p.changedTouches],L=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new T(S[0].clientX-L.x,S[0].clientY-L.y),e.mouseDeltaPos=new T(0,0),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),S.forEach(W=>{e.events.trigger("touchEnd",new T(W.clientX-L.x,W.clientY-L.y),W)})})},he.touchcancel=p=>{e.events.onOnce("input",()=>{let S=[...p.changedTouches],L=e.canvas.getBoundingClientRect();t.touchToMouse!==!1&&(e.mousePos=new T(S[0].clientX-L.x,S[0].clientY-L.y),e.mouseState.release("left"),e.events.trigger("mouseRelease","left")),S.forEach(W=>{e.events.trigger("touchEnd",new T(W.clientX-L.x,W.clientY-L.y),W)})})},he.wheel=p=>{p.preventDefault(),e.events.onOnce("input",()=>{e.events.trigger("scroll",new T(p.deltaX,p.deltaY))})},he.contextmenu=p=>p.preventDefault(),Ke.visibilitychange=()=>{document.visibilityState==="visible"?(e.skipTime=!0,e.isHidden=!1,e.events.trigger("show")):(e.isHidden=!0,e.events.trigger("hide"))},xe.gamepadconnected=p=>{let S=Zt(p.gamepad);e.events.onOnce("input",()=>{e.events.trigger("gamepadConnect",S)})},xe.gamepaddisconnected=p=>{let S=Ct().filter(L=>L.index===p.gamepad.index)[0];Bn(p.gamepad),e.events.onOnce("input",()=>{e.events.trigger("gamepadDisconnect",S)})};for(let p in he)e.canvas.addEventListener(p,he[p]);for(let p in Ke)document.addEventListener(p,Ke[p]);for(let p in xe)window.addEventListener(p,xe[p]);let at=new ResizeObserver(p=>{for(let S of p)if(S.target===e.canvas){if(e.lastWidth===e.canvas.offsetWidth&&e.lastHeight===e.canvas.offsetHeight)return;e.lastWidth=e.canvas.offsetWidth,e.lastHeight=e.canvas.offsetHeight,e.events.onOnce("input",()=>{e.events.trigger("resize")})}});return at.observe(e.canvas),{dt:r,time:a,run:$,canvas:e.canvas,fps:l,numFrames:u,quit:N,isHidden:o,setFullscreen:Y,isFullscreen:z,setCursor:y,screenshot:f,getGamepads:Ct,getCursor:m,setCursorLocked:V,isCursorLocked:x,isTouchscreen:O,mousePos:se,mouseDeltaPos:_,isKeyDown:Le,isKeyPressed:Ue,isKeyPressedRepeat:Ce,isKeyReleased:je,isMouseDown:re,isMousePressed:ae,isMouseReleased:ce,isMouseMoved:ge,isGamepadButtonPressed:Ee,isGamepadButtonDown:Ne,isGamepadButtonReleased:_e,getGamepadStick:st,charInputted:Pe,onResize:He,onKeyDown:pt,onKeyPress:Se,onKeyPressRepeat:Ve,onKeyRelease:ze,onMouseDown:rt,onMousePress:ot,onMouseRelease:wt,onMouseMove:Wt,onCharInput:Yt,onTouchStart:An,onTouchMove:Xt,onTouchEnd:Rn,onScroll:Un,onHide:$t,onShow:Vn,onGamepadButtonDown:Pn,onGamepadButtonPress:Qt,onGamepadButtonRelease:Jt,onGamepadStick:Dn,onGamepadConnect:Dt,onGamepadDisconnect:Mn,events:e.events}},"default");var qe=class t{static{i(this,"Texture")}ctx;src=null;glTex;width;height;constructor(e,r,o,a={}){this.ctx=e;let l=e.gl;this.glTex=e.gl.createTexture(),e.onDestroy(()=>this.free()),this.width=r,this.height=o;let u={linear:l.LINEAR,nearest:l.NEAREST}[a.filter??e.opts.texFilter]??l.NEAREST,f={repeat:l.REPEAT,clampToEadge:l.CLAMP_TO_EDGE}[a.wrap]??l.CLAMP_TO_EDGE;this.bind(),r&&o&&l.texImage2D(l.TEXTURE_2D,0,l.RGBA,r,o,0,l.RGBA,l.UNSIGNED_BYTE,null),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,u),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,f),l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,f),this.unbind()}static fromImage(e,r,o={}){let a=new t(e,r.width,r.height,o);return a.update(r),a.src=r,a}update(e,r=0,o=0){let a=this.ctx.gl;this.bind(),a.texSubImage2D(a.TEXTURE_2D,0,r,o,a.RGBA,a.UNSIGNED_BYTE,e),this.unbind()}bind(){this.ctx.pushTexture2D(this.glTex)}unbind(){this.ctx.popTexture2D()}free(){this.ctx.gl.deleteTexture(this.glTex)}},yt=class{static{i(this,"FrameBuffer")}ctx;tex;glFramebuffer;glRenderbuffer;constructor(e,r,o,a={}){this.ctx=e;let l=e.gl;e.onDestroy(()=>this.free()),this.tex=new qe(e,r,o,a),this.glFramebuffer=l.createFramebuffer(),this.glRenderbuffer=l.createRenderbuffer(),this.bind(),l.renderbufferStorage(l.RENDERBUFFER,l.DEPTH_STENCIL,r,o),l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,this.tex.glTex,0),l.framebufferRenderbuffer(l.FRAMEBUFFER,l.DEPTH_STENCIL_ATTACHMENT,l.RENDERBUFFER,this.glRenderbuffer),this.unbind()}get width(){return this.tex.width}get height(){return this.tex.height}toImageData(){let e=this.ctx.gl,r=new Uint8ClampedArray(this.width*this.height*4);this.bind(),e.readPixels(0,0,this.width,this.height,e.RGBA,e.UNSIGNED_BYTE,r),this.unbind();let o=this.width*4,a=new Uint8Array(o);for(let l=0;l<(this.height/2|0);l++){let u=l*o,f=(this.height-l-1)*o;a.set(r.subarray(u,u+o)),r.copyWithin(u,f,f+o),r.set(a,f)}return new ImageData(r,this.width,this.height)}toDataURL(){let e=document.createElement("canvas"),r=e.getContext("2d");return e.width=this.width,e.height=this.height,r.putImageData(this.toImageData(),0,0),e.toDataURL()}clear(){let e=this.ctx.gl;e.clear(e.COLOR_BUFFER_BIT)}draw(e){this.bind(),e(),this.unbind()}bind(){this.ctx.pushFramebuffer(this.glFramebuffer),this.ctx.pushRenderbuffer(this.glRenderbuffer),this.ctx.pushViewport({x:0,y:0,w:this.width,h:this.height})}unbind(){this.ctx.popFramebuffer(),this.ctx.popRenderbuffer(),this.ctx.popViewport()}free(){let e=this.ctx.gl;e.deleteFramebuffer(this.glFramebuffer),e.deleteRenderbuffer(this.glRenderbuffer),this.tex.free()}},hn=class{static{i(this,"Shader")}ctx;glProgram;constructor(e,r,o,a){this.ctx=e,e.onDestroy(()=>this.free());let l=e.gl,u=l.createShader(l.VERTEX_SHADER),f=l.createShader(l.FRAGMENT_SHADER);l.shaderSource(u,r),l.shaderSource(f,o),l.compileShader(u),l.compileShader(f);let y=l.createProgram();if(this.glProgram=y,l.attachShader(y,u),l.attachShader(y,f),a.forEach((m,V)=>l.bindAttribLocation(y,V,m)),l.linkProgram(y),!l.getProgramParameter(y,l.LINK_STATUS)){let m=l.getShaderInfoLog(u);if(m)throw new Error("VERTEX SHADER "+m);let V=l.getShaderInfoLog(f);if(V)throw new Error("FRAGMENT SHADER "+V)}l.deleteShader(u),l.deleteShader(f)}bind(){this.ctx.pushProgram(this.glProgram)}unbind(){this.ctx.popProgram()}send(e){let r=this.ctx.gl;for(let o in e){let a=e[o],l=r.getUniformLocation(this.glProgram,o);if(typeof a=="number")r.uniform1f(l,a);else if(a instanceof Ge)r.uniformMatrix4fv(l,!1,new Float32Array(a.m));else if(a instanceof ee)r.uniform3f(l,a.r,a.g,a.b);else if(a instanceof T)r.uniform2f(l,a.x,a.y);else if(Array.isArray(a)){let u=a[0];typeof u=="number"?r.uniform1fv(l,a):u instanceof T?r.uniform2fv(l,a.map(f=>[f.x,f.y]).flat()):u instanceof ee&&r.uniform3fv(l,a.map(f=>[f.r,f.g,f.b]).flat())}else throw new Error("Unsupported uniform data type")}}free(){this.ctx.gl.deleteProgram(this.glProgram)}},pn=class{static{i(this,"BatchRenderer")}ctx;glVBuf;glIBuf;vqueue=[];iqueue=[];stride;maxVertices;maxIndices;vertexFormat;numDraws=0;curPrimitive=null;curTex=null;curShader=null;curUniform={};constructor(e,r,o,a){let l=e.gl;this.vertexFormat=r,this.ctx=e,this.stride=r.reduce((u,f)=>u+f.size,0),this.maxVertices=o,this.maxIndices=a,this.glVBuf=l.createBuffer(),e.pushArrayBuffer(this.glVBuf),l.bufferData(l.ARRAY_BUFFER,o*4,l.DYNAMIC_DRAW),e.popArrayBuffer(),this.glIBuf=l.createBuffer(),e.pushElementArrayBuffer(this.glIBuf),l.bufferData(l.ELEMENT_ARRAY_BUFFER,a*4,l.DYNAMIC_DRAW),e.popElementArrayBuffer()}push(e,r,o,a,l=null,u={}){(e!==this.curPrimitive||l!==this.curTex||a!==this.curShader||!mn(this.curUniform,u)||this.vqueue.length+r.length*this.stride>this.maxVertices||this.iqueue.length+o.length>this.maxIndices)&&this.flush();let f=this.vqueue.length/this.stride;for(let y of r)this.vqueue.push(y);for(let y of o)this.iqueue.push(y+f);this.curPrimitive=e,this.curShader=a,this.curTex=l,this.curUniform=u}flush(){if(!this.curPrimitive||!this.curShader||this.vqueue.length===0||this.iqueue.length===0)return;let e=this.ctx.gl;this.ctx.pushArrayBuffer(this.glVBuf),e.bufferSubData(e.ARRAY_BUFFER,0,new Float32Array(this.vqueue)),this.ctx.pushElementArrayBuffer(this.glIBuf),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,new Uint16Array(this.iqueue)),this.ctx.setVertexFormat(this.vertexFormat),this.curShader.bind(),this.curShader.send(this.curUniform),this.curTex?.bind(),e.drawElements(this.curPrimitive,this.iqueue.length,e.UNSIGNED_SHORT,0),this.curTex?.unbind(),this.curShader.unbind(),this.ctx.popArrayBuffer(),this.ctx.popElementArrayBuffer(),this.vqueue=[],this.iqueue=[],this.numDraws++}free(){let e=this.ctx.gl;e.deleteBuffer(this.glVBuf),e.deleteBuffer(this.glIBuf)}};function xt(t){let e=[],r=i(l=>{e.push(l),t(l)},"push"),o=i(()=>{e.pop(),t(a()??null)},"pop"),a=i(()=>e[e.length-1],"cur");return[r,o,a]}i(xt,"genStack");function hr(t,e={}){let r=[];function o(_){r.push(_)}i(o,"onDestroy");function a(){r.forEach(_=>_()),t.getExtension("WEBGL_lose_context").loseContext()}i(a,"destroy");let l=null;function u(_){if(mn(_,l))return;l=_;let ae=_.reduce((re,ce)=>re+ce.size,0);_.reduce((re,ce,ge)=>(t.vertexAttribPointer(ge,ce.size,t.FLOAT,!1,ae*4,re),t.enableVertexAttribArray(ge),re+ce.size*4),0)}i(u,"setVertexFormat");let[f,y]=xt(_=>t.bindTexture(t.TEXTURE_2D,_)),[m,V]=xt(_=>t.bindBuffer(t.ARRAY_BUFFER,_)),[x,P]=xt(_=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_)),[w,K]=xt(_=>t.bindFramebuffer(t.FRAMEBUFFER,_)),[Y,z]=xt(_=>t.bindRenderbuffer(t.RENDERBUFFER,_)),[N,$]=xt(({x:_,y:ae,w:re,h:ce})=>{t.viewport(_,ae,re,ce)}),[O,se]=xt(_=>t.useProgram(_));return N({x:0,y:0,w:t.drawingBufferWidth,h:t.drawingBufferHeight}),{gl:t,opts:e,onDestroy:o,destroy:a,pushTexture2D:f,popTexture2D:y,pushArrayBuffer:m,popArrayBuffer:V,pushElementArrayBuffer:x,popElementArrayBuffer:P,pushFramebuffer:w,popFramebuffer:K,pushRenderbuffer:Y,popRenderbuffer:z,pushViewport:N,popViewport:$,pushProgram:O,popProgram:se,setVertexFormat:u}}i(hr,"initGfx");var Re=class t{static{i(this,"Asset")}loaded=!1;data=null;error=null;onLoadEvents=new we;onErrorEvents=new we;onFinishEvents=new we;constructor(e){e.then(r=>{this.loaded=!0,this.data=r,this.onLoadEvents.trigger(r)}).catch(r=>{if(this.error=r,this.onErrorEvents.numListeners()>0)this.onErrorEvents.trigger(r);else throw r}).finally(()=>{this.onFinishEvents.trigger(),this.loaded=!0})}static loaded(e){let r=new t(Promise.resolve(e));return r.data=e,r.loaded=!0,r}onLoad(e){return this.loaded&&this.data?e(this.data):this.onLoadEvents.add(e),this}onError(e){return this.loaded&&this.error?e(this.error):this.onErrorEvents.add(e),this}onFinish(e){return this.loaded?e():this.onFinishEvents.add(e),this}then(e){return this.onLoad(e)}catch(e){return this.onError(e)}finally(e){return this.onFinish(e)}},nt=class{static{i(this,"AssetBucket")}assets=new Map;lastUID=0;add(e,r){let o=e??this.lastUID+++"",a=new Re(r);return this.assets.set(o,a),a}addLoaded(e,r){let o=e??this.lastUID+++"",a=Re.loaded(r);return this.assets.set(o,a),a}get(e){return this.assets.get(e)}progress(){if(this.assets.size===0)return 1;let e=0;return this.assets.forEach(r=>{r.loaded&&e++}),e/this.assets.size}};function pr(t){return fetch(t).then(e=>{if(!e.ok)throw new Error(`Failed to fetch "${t}"`);return e})}i(pr,"fetchURL");function Nt(t){return pr(t).then(e=>e.json())}i(Nt,"fetchJSON");function uo(t){return pr(t).then(e=>e.text())}i(uo,"fetchText");function lo(t){return pr(t).then(e=>e.arrayBuffer())}i(lo,"fetchArrayBuffer");function _t(t){let e=new Image;return e.crossOrigin="anonymous",e.src=t,new Promise((r,o)=>{e.onload=()=>r(e),e.onerror=()=>o(new Error(`Failed to load image from "${t}"`))})}i(_t,"loadImg");var fr=" !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~",Vt="topleft";var mo="monospace",Ht="monospace";var fn="linear";var gn=[{name:"a_pos",size:2},{name:"a_uv",size:2},{name:"a_color",size:4}],Wi=gn.reduce((t,e)=>t+e.size,0),ho=2048,po=ho*4*Wi,fo=ho*6,go=`
attribute vec2 a_pos;
attribute vec2 a_uv;
attribute vec4 a_color;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

vec4 def_vert() {
	return vec4(a_pos, 0.0, 1.0);
}

{{user}}

void main() {
	vec4 pos = vert(a_pos, a_uv, a_color);
	v_pos = a_pos;
	v_uv = a_uv;
	v_color = a_color;
	gl_Position = pos;
}
`,bo=`
precision mediump float;

varying vec2 v_pos;
varying vec2 v_uv;
varying vec4 v_color;

uniform sampler2D u_tex;

vec4 def_frag() {
	return v_color * texture2D(u_tex, v_uv);
}

{{user}}

void main() {
	gl_FragColor = frag(v_pos, v_uv, v_color, u_tex);
	if (gl_FragColor.a == 0.0) {
		discard;
	}
}
`,bn=`
vec4 vert(vec2 pos, vec2 uv, vec4 color) {
	return def_vert();
}
`,vn=`
vec4 frag(vec2 pos, vec2 uv, vec4 color, sampler2D tex) {
	return def_frag();
}
`,vo=new Set(["id","require"]),xo=new Set(["add","update","draw","destroy","inspect","drawInspect"]),gr=/\[(?<style>\w+)\](?<text>.*?)\[\/\k<style>\]/g,yo=200,wo=640,Co=65536;var xn=2.5949095,To=1.70158+1,Eo=2*Math.PI/3,So=2*Math.PI/4.5,yn={linear:t=>t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInQuad:t=>t*t,easeOutQuad:t=>1-(1-t)*(1-t),easeInOutQuad:t=>t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2,easeInCubic:t=>t*t*t,easeOutCubic:t=>1-Math.pow(1-t,3),easeInOutCubic:t=>t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1-Math.pow(1-t,4),easeInOutQuart:t=>t<.5?8*t*t*t*t:1-Math.pow(-2*t+2,4)/2,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1-Math.pow(1-t,5),easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1-Math.pow(-2*t+2,5)/2,easeInExpo:t=>t===0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t===1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t===0?0:t===1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2,easeInCirc:t=>1-Math.sqrt(1-Math.pow(t,2)),easeOutCirc:t=>Math.sqrt(1-Math.pow(t-1,2)),easeInOutCirc:t=>t<.5?(1-Math.sqrt(1-Math.pow(2*t,2)))/2:(Math.sqrt(1-Math.pow(-2*t+2,2))+1)/2,easeInBack:t=>To*t*t*t-1.70158*t*t,easeOutBack:t=>1+To*Math.pow(t-1,3)+1.70158*Math.pow(t-1,2),easeInOutBack:t=>t<.5?Math.pow(2*t,2)*((xn+1)*2*t-xn)/2:(Math.pow(2*t-2,2)*((xn+1)*(t*2-2)+xn)+2)/2,easeInElastic:t=>t===0?0:t===1?1:-Math.pow(2,10*t-10)*Math.sin((t*10-10.75)*Eo),easeOutElastic:t=>t===0?0:t===1?1:Math.pow(2,-10*t)*Math.sin((t*10-.75)*Eo)+1,easeInOutElastic:t=>t===0?0:t===1?1:t<.5?-(Math.pow(2,20*t-10)*Math.sin((20*t-11.125)*So))/2:Math.pow(2,-20*t+10)*Math.sin((20*t-11.125)*So)/2+1,easeInBounce:t=>1-yn.easeOutBounce(1-t),easeOutBounce:t=>t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375,easeInOutBounce:t=>t<.5?(1-yn.easeOutBounce(1-2*t))/2:(1+yn.easeOutBounce(2*t-1))/2},Pt=yn;var Kt=class{static{i(this,"TexPacker")}textures=[];bigTextures=[];canvas;c2d;x=0;y=0;curHeight=0;gfx;constructor(e,r,o){this.gfx=e,this.canvas=document.createElement("canvas"),this.canvas.width=r,this.canvas.height=o,this.textures=[qe.fromImage(e,this.canvas)],this.bigTextures=[],this.c2d=this.canvas.getContext("2d")}add(e){if(e.width>this.canvas.width||e.height>this.canvas.height){let a=qe.fromImage(this.gfx,e);return this.bigTextures.push(a),[a,new me(0,0,1,1)]}this.x+e.width>this.canvas.width&&(this.x=0,this.y+=this.curHeight,this.curHeight=0),this.y+e.height>this.canvas.height&&(this.c2d.clearRect(0,0,this.canvas.width,this.canvas.height),this.textures.push(qe.fromImage(this.gfx,this.canvas)),this.x=0,this.y=0,this.curHeight=0);let r=this.textures[this.textures.length-1],o=new T(this.x,this.y);return this.x+=e.width,e.height>this.curHeight&&(this.curHeight=e.height),e instanceof ImageData?this.c2d.putImageData(e,o.x,o.y):this.c2d.drawImage(e,o.x,o.y),r.update(this.canvas),[r,new me(o.x/this.canvas.width,o.y/this.canvas.height,e.width/this.canvas.width,e.height/this.canvas.height)]}free(){for(let e of this.textures)e.free();for(let e of this.bigTextures)e.free()}};function Yi(t){return{color:t.color,opacity:t.opacity,anchor:t.anchor,outline:t.outline,shader:t.shader,uniform:t.uniform}}i(Yi,"getRenderProps");function Oo(t,e={}){let r=J(this);return{id:"circle",radius:t,draw(){r.drawCircle(Object.assign(Yi(this),{radius:this.radius,fill:e.fill}))},renderArea(){return new ue(new T(this.anchor?0:-this.radius),this.radius*2,this.radius*2)},inspect(){return`${Math.ceil(this.radius)}`}}}i(Oo,"circle");function Ao(t){return{add(){this.canvas=t}}}i(Ao,"drawon");function Ro(t=1){let e=J(this),r,o=0,a=!1;return{require:["opacity"],add(){r=this.opacity,this.opacity=0},update(){a||(o+=e.dt(),this.opacity=e.map(o,0,t,0,r),o>=t&&(this.opacity=r,a=!0))}}}i(Ro,"fadeIn");function Uo(t="intersect"){return{id:"mask",mask:t}}i(Uo,"mask");function Vo(t){let e=J(this),r=fe(e);return{id:"opacity",opacity:t??1,inspect(){return`${r.toFixed(this.opacity,1)}`},fadeIn(o=1,a=e.easings.linear){return e.tween(0,this.opacity,o,l=>this.opacity=l,a)},fadeOut(o=1,a=e.easings.linear){return e.tween(this.opacity,0,o,l=>this.opacity=l,a)}}}i(Vo,"opacity");function Po(t=1,e=oe(0,0,0),r=1,o="miter",a=10,l="butt"){return{id:"outline",outline:{width:t,color:e,opacity:r,join:o,miterLimit:a,cap:l}}}i(Po,"outline");function Do(t,e={}){let r=J(this),o=fe(r);if(t.length<3)throw new Error(`Polygon's need more than two points, ${t.length} points provided`);return{id:"polygon",pts:t,colors:e.colors,uv:e.uv,tex:e.tex,radius:e.radius,draw(){r.drawPolygon(Object.assign(o.getRenderProps(this),{pts:this.pts,colors:this.colors,uv:this.uv,tex:this.tex,radius:this.radius,fill:e.fill}))},renderArea(){return new Ae(this.pts)},inspect(){return this.pts.map(a=>`[${a.x},${a.y}]`).join(",")}}}i(Do,"polygon");function Mo(t,e,r){let o=J(this),a;return o.get("area").forEach(u=>{if(r&&r.some(m=>u.is(m)))return;let y=u.worldArea().raycast(t,e);y&&(a?y.fraction<a.fraction&&(a=y,a.object=u):(a=y,a.object=u))}),a}i(Mo,"raycast");function Go(t,e,r={}){let o=J(this),a=fe(o);return{id:"rect",width:t,height:e,radius:r.radius||0,draw(){o.drawRect(Object.assign(a.getRenderProps(this),{width:this.width,height:this.height,radius:this.radius,fill:r.fill}))},renderArea(){return new ue(C(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}i(Go,"rect");function Bo(t,e){return{id:"shader",shader:t,...typeof e=="function"?{uniform:e(),update(){this.uniform=e()}}:{uniform:e},inspect(){return`shader: ${t}`}}}i(Bo,"shader");function wn(t,e={}){let r=J(this),o=fe(this),a=null,l=null,u=null,f=new we;if(!t)throw new Error("Please pass the resource name or data to sprite()");let y=i((m,V,x,P)=>{let w=C(1,1);return x&&P?(w.x=x/(m.width*V.w),w.y=P/(m.height*V.h)):x?(w.x=x/(m.width*V.w),w.y=w.x):P&&(w.y=P/(m.height*V.h),w.x=w.y),w},"calcTexScale");return{id:"sprite",width:0,height:0,frame:e.frame||0,quad:e.quad||new me(0,0,1,1),animSpeed:e.animSpeed??1,flipX:e.flipX??!1,flipY:e.flipY??!1,draw(){if(!a)return;let m=a.frames[this.frame??0];if(!m)throw new Error(`Frame not found: ${this.frame??0}`);if(a.slice9){let{left:V,right:x,top:P,bottom:w}=a.slice9,K=a.tex.width*m.w,Y=a.tex.height*m.h,z=this.width-V-x,N=this.height-P-w,$=V/K,O=x/K,se=1-$-O,_=P/Y,ae=w/Y,re=1-_-ae,ce=[pe(0,0,$,_),pe($,0,se,_),pe($+se,0,O,_),pe(0,_,$,re),pe($,_,se,re),pe($+se,_,O,re),pe(0,_+re,$,ae),pe($,_+re,se,ae),pe($+se,_+re,O,ae),pe(0,0,V,P),pe(V,0,z,P),pe(V+z,0,x,P),pe(0,P,V,N),pe(V,P,z,N),pe(V+z,P,x,N),pe(0,P+N,V,w),pe(V,P+N,z,w),pe(V+z,P+N,x,w)];for(let ge=0;ge<9;ge++){let Ue=ce[ge],Ce=ce[ge+9];o.drawTexture(Object.assign(o.getRenderProps(this),{pos:Ce.pos(),tex:a.tex,quad:m.scale(Ue),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:Ce.w,height:Ce.h}))}}else o.drawTexture(Object.assign(o.getRenderProps(this),{tex:a.tex,quad:m.scale(this.quad??new me(0,0,1,1)),flipX:this.flipX,flipY:this.flipY,tiled:e.tiled,width:this.width,height:this.height}))},add(){let m=i(x=>{let P=x.frames[0].clone();e.quad&&(P=P.scale(e.quad));let w=y(x.tex,P,e.width,e.height);this.width=x.tex.width*P.w*w.x,this.height=x.tex.height*P.h*w.y,e.anim&&this.play(e.anim),a=x,f.trigger(a)},"setSpriteData"),V=o.resolveSprite(t);V?V.onLoad(m):r.onLoad(()=>m(o.resolveSprite(t).data))},update(){if(!l)return;let m=a.anims[l.name];if(typeof m=="number"){this.frame=m;return}if(m.speed===0)throw new Error("Sprite anim speed cannot be 0");l.timer+=r.dt()*this.animSpeed,l.timer>=1/l.speed&&(l.timer=0,this.frame+=u,(this.frame<Math.min(m.from,m.to)||this.frame>Math.max(m.from,m.to))&&(l.loop?l.pingpong?(this.frame-=u,u*=-1,this.frame+=u):this.frame=m.from:l.pingpong?u===Math.sign(m.to-m.from)?(this.frame=m.to,u*=-1,this.frame+=u):(this.frame=m.from,l.onEnd(),this.stop()):(this.frame=m.to,l.onEnd(),this.stop())))},play(m,V={}){if(!a){f.add(()=>this.play(m,V));return}let x=a.anims[m];if(x===void 0)throw new Error(`Anim not found: ${m}`);l&&this.stop(),l=typeof x=="number"?{name:m,timer:0,loop:!1,pingpong:!1,speed:0,onEnd:()=>{}}:{name:m,timer:0,loop:V.loop??x.loop??!1,pingpong:V.pingpong??x.pingpong??!1,speed:V.speed??x.speed??10,onEnd:V.onEnd??(()=>{})},u=typeof x=="number"?null:x.from<x.to?1:-1,this.frame=typeof x=="number"?x:x.from,this.trigger("animStart",m)},stop(){if(!l)return;let m=l.name;l=null,this.trigger("animEnd",m)},numFrames(){return a?.frames.length??0},curAnim(){return l?.name},onAnimEnd(m){return this.on("animEnd",m)},onAnimStart(m){return this.on("animStart",m)},renderArea(){return new r.Rect(C(0),this.width,this.height)},inspect(){if(typeof t=="string")return`"${t}"`}}}i(wn,"sprite");function Fo(t,e={}){let r=J(this),o=fe(r);function a(u){let f=r.formatText(Object.assign(o.getRenderProps(u),{text:u.text+"",size:u.textSize,font:u.font,width:e.width&&u.width,align:u.align,letterSpacing:u.letterSpacing,lineSpacing:u.lineSpacing,transform:u.textTransform,styles:u.textStyles}));return e.width||(u.width=f.width/(u.scale?.x||1)),u.height=f.height/(u.scale?.y||1),f}i(a,"update");let l={id:"text",set text(u){t=u,a(this)},get text(){return t},textSize:e.size??36,font:e.font,width:e.width??0,height:0,align:e.align,lineSpacing:e.lineSpacing,letterSpacing:e.letterSpacing,textTransform:e.transform,textStyles:e.styles,add(){r.onLoad(()=>a(this))},draw(){r.drawFormattedText(a(this))},renderArea(){return new ue(C(0),this.width,this.height)}};return a(l),l}i(Fo,"text");function Io(t,e){let r=J(this),o=fe(r);return{id:"rect",width:t,height:e,draw(){r.drawUVQuad(Object.assign(o.getRenderProps(this),{width:this.width,height:this.height}))},renderArea(){return new ue(C(0),this.width,this.height)},inspect(){return`${Math.ceil(this.width)}, ${Math.ceil(this.height)}`}}}i(Io,"uvquad");function Lo(t={}){let e=null,r=null,o=null,a=null;return{id:"agent",require:["pos","tile"],agentSpeed:t.speed??100,allowDiagonals:t.allowDiagonals??!0,getDistanceToTarget(){return e?this.pos.dist(e):0},getNextLocation(){return r&&o?r[o]:null},getPath(){return r?r.slice():null},getTarget(){return e},isNavigationFinished(){return r?o===null:!0},isTargetReachable(){return r!==null},isTargetReached(){return e?this.pos.eq(e):!0},setTarget(l){e=l,r=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),o=r?0:null,r?(a||(a=this.getLevel().onNavigationMapChanged(()=>{r&&o!==null&&(r=this.getLevel().getPath(this.pos,e,{allowDiagonals:this.allowDiagonals}),o=r?0:null,r?this.trigger("navigation-next",this,r[o]):this.trigger("navigation-ended",this))}),this.onDestroy(()=>a.cancel())),this.trigger("navigation-started",this),this.trigger("navigation-next",this,r[o])):this.trigger("navigation-ended",this)},update(){if(r&&o!==null){if(this.pos.sdist(r[o])<2)if(o===r.length-1){this.pos=e.clone(),o=null,this.trigger("navigation-ended",this),this.trigger("target-reached",this);return}else o++,this.trigger("navigation-next",this,r[o]);this.moveTo(r[o],this.agentSpeed)}},onNavigationStarted(l){return this.on("navigation-started",l)},onNavigationNext(l){return this.on("navigation-next",l)},onNavigationEnded(l){return this.on("navigation-ended",l)},onTargetReached(l){return this.on("target-reached",l)},inspect(){return JSON.stringify({target:JSON.stringify(e),path:JSON.stringify(r)})}}}i(Lo,"agent");function br(t={}){let e=C(0),r=t.isObstacle??!1,o=t.cost??0,a=t.edges??[],l=i(()=>{let f={left:1,top:2,right:4,bottom:8};return a.map(y=>f[y]||0).reduce((y,m)=>y|m,0)},"getEdgeMask"),u=l();return{id:"tile",tilePosOffset:t.offset??C(0),set tilePos(f){let y=this.getLevel();e=f.clone(),this.pos=C(this.tilePos.x*y.tileWidth(),this.tilePos.y*y.tileHeight()).add(this.tilePosOffset)},get tilePos(){return e},set isObstacle(f){r!==f&&(r=f,this.getLevel().invalidateNavigationMap())},get isObstacle(){return r},set cost(f){o!==f&&(o=f,this.getLevel().invalidateNavigationMap())},get cost(){return o},set edges(f){a=f,u=l(),this.getLevel().invalidateNavigationMap()},get edges(){return a},get edgeMask(){return u},getLevel(){return this.parent},moveLeft(){this.tilePos=this.tilePos.add(C(-1,0))},moveRight(){this.tilePos=this.tilePos.add(C(1,0))},moveUp(){this.tilePos=this.tilePos.add(C(0,-1))},moveDown(){this.tilePos=this.tilePos.add(C(0,1))}}}i(br,"tile");function jo(t,e){if(t==null)throw new Error("health() requires the initial amount of hp");return{id:"health",hurt(r=1){this.setHP(t-r),this.trigger("hurt",r)},heal(r=1){let o=t;this.setHP(t+r),this.trigger("heal",t-o)},hp(){return t},maxHP(){return e??null},setMaxHP(r){e=r},setHP(r){t=e?Math.min(e,r):r,t<=0&&this.trigger("death")},onHurt(r){return this.on("hurt",r)},onHeal(r){return this.on("heal",r)},onDeath(r){return this.on("death",r)},inspect(){return`${t}`}}}i(jo,"health");function ko(t,e={}){let r=J(this);if(t==null)throw new Error("lifespan() requires time");let o=e.fade??0;return{id:"lifespan",require:["opacity"],async add(){await r.wait(t),this.opacity=this.opacity??1,o>0&&await r.tween(this.opacity,0,o,a=>this.opacity=a,Pt.linear),this.destroy()}}}i(ko,"lifespan");function No(t,e,r){if(!t)throw new Error("state() requires an initial state");let o={};function a(y){o[y]||(o[y]={enter:new we,end:new we,update:new we,draw:new we})}i(a,"initStateEvents");function l(y,m,V){return a(m),o[m][y].add(V)}i(l,"on");function u(y,m,...V){a(m),o[m][y].trigger(...V)}i(u,"trigger");let f=!1;return{id:"state",state:t,enterState(y,...m){if(f=!0,e&&!e.includes(y))throw new Error(`State not found: ${y}`);let V=this.state;if(r){if(!r?.[V])return;let x=typeof r[V]=="string"?[r[V]]:r[V];if(!x.includes(y))throw new Error(`Cannot transition state from "${V}" to "${y}". Available transitions: ${x.map(P=>`"${P}"`).join(", ")}`)}u("end",V,...m),this.state=y,u("enter",y,...m),u("enter",`${V} -> ${y}`,...m)},onStateTransition(y,m,V){return l("enter",`${y} -> ${m}`,V)},onStateEnter(y,m){return l("enter",y,m)},onStateUpdate(y,m){return l("update",y,m)},onStateDraw(y,m){return l("draw",y,m)},onStateEnd(y,m){return l("end",y,m)},update(){f||(u("enter",t),f=!0),u("update",this.state)},draw(){u("draw",this.state)},inspect(){return this.state}}}i(No,"state");function vr(t){return{id:"stay",stay:!0,scenesToStay:t}}i(vr,"stay");function Cn(){return{id:"timer",wait(t,e){let r=J(this),o=[];e&&o.push(e);let a=0,l=this.onUpdate(()=>{a+=r.dt(),a>=t&&(o.forEach(u=>u()),l.cancel())});return{get paused(){return l.paused},set paused(u){l.paused=u},cancel:l.cancel,onEnd(u){o.push(u)},then(u){return this.onEnd(u),this}}},loop(t,e){let r=null,o=i(()=>{r=this.wait(t,o),e()},"newAction");return r=this.wait(0,o),{get paused(){return r.paused},set paused(a){r.paused=a},cancel:()=>r.cancel()}},tween(t,e,r,o,a=Pt.linear){let l=J(this),u=0,f=[],y=this.onUpdate(()=>{u+=l.dt();let m=Math.min(u/r,1);o(Je(t,e,a(m))),m===1&&(y.cancel(),o(e),f.forEach(V=>V()))});return{get paused(){return y.paused},set paused(m){y.paused=m},onEnd(m){f.push(m)},then(m){return this.onEnd(m),this},cancel(){y.cancel()},finish(){y.cancel(),o(e),f.forEach(m=>m())}}}}}i(Cn,"timer");function _o(t={}){let e=J(this),r=fe(e),{app:o}=r,a={},l=new Set;return{id:"area",collisionIgnore:t.collisionIgnore??[],add(){this.area.cursor&&this.onHover(()=>o.setCursor(this.area.cursor)),this.onCollideUpdate((u,f)=>{a[u.id]||this.trigger("collide",u,f),a[u.id]=f,l.add(u.id)})},update(){for(let u in a)l.has(Number(u))||(this.trigger("collideEnd",a[u].target),delete a[u]);l.clear()},drawInspect(){let u=this.localArea();e.pushTransform(),e.pushScale(this.area.scale),e.pushTranslate(this.area.offset);let f={outline:{width:4/r.getViewportScale(),color:oe(0,0,255)},anchor:this.anchor,fill:!1,fixed:r.isFixed(this)};u instanceof e.Rect?e.drawRect({...f,pos:u.pos,width:u.width,height:u.height}):u instanceof e.Polygon?e.drawPolygon({...f,pts:u.pts}):u instanceof e.Circle&&e.drawCircle({...f,pos:u.center,radius:u.radius}),e.popTransform()},area:{shape:t.shape??null,scale:t.scale?C(t.scale):C(1),offset:t.offset??C(0),cursor:t.cursor??null},isClicked(){return o.isMousePressed()&&this.isHovering()},isHovering(){let u=r.isFixed(this)?e.mousePos():e.toWorld(e.mousePos());return this.hasPoint(u)},checkCollision(u){return a[u.id]??null},getCollisions(){return Object.values(a)},isColliding(u){return!!a[u.id]},isOverlapping(u){let f=a[u.id];return f&&f.hasOverlap()},onClick(u,f="left"){let y=o.onMousePress(f,()=>{this.isHovering()&&u()});return this.onDestroy(()=>y.cancel()),y},onHover(u){let f=!1;return this.onUpdate(()=>{f?f=this.isHovering():this.isHovering()&&(f=!0,u())})},onHoverUpdate(u){return this.onUpdate(()=>{this.isHovering()&&u()})},onHoverEnd(u){let f=!1;return this.onUpdate(()=>{f?this.isHovering()||(f=!1,u()):f=this.isHovering()})},onCollide(u,f){if(typeof u=="function"&&f===void 0)return this.on("collide",u);if(typeof u=="string")return this.onCollide((y,m)=>{y.is(u)&&f(y,m)})},onCollideUpdate(u,f){if(typeof u=="function"&&f===void 0)return this.on("collideUpdate",u);if(typeof u=="string")return this.on("collideUpdate",(y,m)=>y.is(u)&&f(y,m))},onCollideEnd(u,f){if(typeof u=="function"&&f===void 0)return this.on("collideEnd",u);if(typeof u=="string")return this.on("collideEnd",y=>y.is(u)&&f(y))},hasPoint(u){return mt(this.worldArea(),u)},resolveCollision(u){let f=this.checkCollision(u);f&&!f.resolved&&(this.pos=this.pos.add(f.displacement),f.resolved=!0)},localArea(){return this.area.shape?this.area.shape:this.renderArea()},worldArea(){let u=this.localArea();if(!(u instanceof e.Polygon||u instanceof e.Rect))throw new Error("Only support polygon and rect shapes for now");let f=this.transform.clone().scale(C(this.area.scale??1)).translate(this.area.offset);if(u instanceof e.Rect){let y=ht(this.anchor||Vt).add(1,1).scale(-.5).scale(u.width,u.height);f.translate(y)}return u.transform(f)},screenArea(){let u=this.worldArea();return r.isFixed(this)?u:u.transform(r.game.cam.transform)},inspect(){return`(${this.area.scale.x.toFixed(1)}, ${this.area.scale.y.toFixed(1)})`}}}i(_o,"area");function Ho(t={}){let e=J(this),r=fe(e),o=null,a=null,l=!1;return{id:"body",require:["pos"],vel:C(0),drag:t.drag??0,jumpForce:t.jumpForce??wo,gravityScale:t.gravityScale??1,isStatic:t.isStatic??!1,mass:t.mass??1,add(){if(this.mass===0)throw new Error("Can't set body mass to 0");this.is("area")&&(this.onCollideUpdate((u,f)=>{if(!u.is("body")||f.resolved)return;this.trigger("beforePhysicsResolve",f);let y=f.reverse();if(u.trigger("beforePhysicsResolve",y),!(f.resolved||y.resolved)&&!(this.isStatic&&u.isStatic)){if(!this.isStatic&&!u.isStatic){let m=this.mass+u.mass;this.pos=this.pos.add(f.displacement.scale(u.mass/m)),u.pos=u.pos.add(f.displacement.scale(-this.mass/m)),this.transform=r.calcTransform(this),u.transform=r.calcTransform(u)}else{let m=!this.isStatic&&u.isStatic?f:f.reverse();m.source.pos=m.source.pos.add(m.displacement),m.source.transform=r.calcTransform(m.source)}f.resolved=!0,this.trigger("physicsResolve",f),u.trigger("physicsResolve",f.reverse())}}),this.onPhysicsResolve(u=>{r.game.gravity&&(u.isBottom()&&this.isFalling()?(this.vel=this.vel.reject(r.game.gravity.unit()),o=u.target,a=u.target.pos,l?l=!1:this.trigger("ground",o)):u.isTop()&&this.isJumping()&&(this.vel=this.vel.reject(r.game.gravity.unit()),this.trigger("headbutt",u.target)))}))},update(){if(r.game.gravity&&!this.isStatic){l&&(o=null,a=null,this.trigger("fallOff"),l=!1);let u=!0;if(o&&(!this.isColliding(o)||!o.exists()||!o.is("body")?l=!0:(!o.pos.eq(a)&&t.stickToPlatform!==!1&&this.moveBy(o.pos.sub(a)),a=o.pos,u=!1)),u){let f=this.vel.clone();this.vel=this.vel.add(r.game.gravity.scale(this.gravityScale*e.dt()));let y=t.maxVelocity??Co;this.vel.slen()>y*y&&(this.vel=this.vel.unit().scale(y)),f.dot(r.game.gravity)<0&&this.vel.dot(r.game.gravity)>=0&&this.trigger("fall")}}this.vel.x*=1-this.drag,this.vel.y*=1-this.drag,this.move(this.vel)},onPhysicsResolve(u){return this.on("physicsResolve",u)},onBeforePhysicsResolve(u){return this.on("beforePhysicsResolve",u)},curPlatform(){return o},isGrounded(){return o!==null},isFalling(){return this.vel.dot(e.getGravityDirection())>0},isJumping(){return this.vel.dot(e.getGravityDirection())<0},jump(u){o=null,a=null,this.vel=e.getGravityDirection().scale(-u||-this.jumpForce)},onGround(u){return this.on("ground",u)},onFall(u){return this.on("fall",u)},onFallOff(u){return this.on("fallOff",u)},onHeadbutt(u){return this.on("headbutt",u)}}}i(Ho,"body");function Ko(t=2){let e=t;return{id:"doubleJump",require:["body"],numJumps:t,add(){this.onGround(()=>{e=this.numJumps})},doubleJump(r){e<=0||(e<this.numJumps&&this.trigger("doubleJump"),e--,this.jump(r))},onDoubleJump(r){return this.on("doubleJump",r)},inspect(){return`${e}`}}}i(Ko,"doubleJump");function Tn(t){if(!t)throw new Error("Please define an anchor");return{id:"anchor",anchor:t,inspect(){return typeof this.anchor=="string"?this.anchor:this.anchor.toString()}}}i(Tn,"anchor");function qo(){return{id:"fixed",fixed:!0}}i(qo,"fixed");function zo(t,e){return{id:"follow",require:["pos"],follow:{obj:t,offset:e??C(0)},add(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))},update(){t.exists()&&(this.pos=this.follow.obj.pos.add(this.follow.offset))}}}i(zo,"follow");function Wo(t,e){let r=typeof t=="number"?T.fromAngle(t):t.unit();return{id:"move",require:["pos"],update(){this.move(r.scale(e))}}}i(Wo,"move");function Yo(t={}){let e=J(this),r=t.distance??yo,o=!1;return{id:"offscreen",require:["pos"],isOffScreen(){let a=this.screenPos(),l=new ue(C(0),e.width(),e.height());return!e.testRectPoint(l,a)&&l.sdistToPoint(a)>r*r},onExitScreen(a){return this.on("exitView",a)},onEnterScreen(a){return this.on("enterView",a)},update(){this.isOffScreen()?(o||(this.trigger("exitView"),o=!0),t.hide&&(this.hidden=!0),t.pause&&(this.paused=!0),t.destroy&&this.destroy()):(o&&(this.trigger("enterView"),o=!1),t.hide&&(this.hidden=!1),t.pause&&(this.paused=!1))}}}i(Yo,"offscreen");function En(t){return t.fixed?!0:t.parent?En(t.parent):!1}i(En,"isFixed");function qt(...t){let e=J(this),r=fe(e);return{id:"pos",pos:C(...t),moveBy(...o){this.pos=this.pos.add(C(...o))},move(...o){this.moveBy(C(...o).scale(e.dt()))},moveTo(...o){if(typeof o[0]=="number"&&typeof o[1]=="number")return this.moveTo(C(o[0],o[1]),o[2]);let a=o[0],l=o[1];if(l===void 0){this.pos=C(a);return}let u=a.sub(this.pos);if(u.len()<=l*e.dt()){this.pos=C(a);return}this.move(u.unit().scale(l))},worldPos(){return this.parent?this.parent.transform.multVec2(this.pos):this.pos},toWorld(o){return this.parent?this.parent.transform.multVec2(this.pos.add(o)):this.pos.add(o)},fromWorld(o){return this.parent?this.parent.transform.invert().multVec2(o).sub(this.pos):o.sub(this.pos)},screenPos(){let o=this.worldPos();return En(this)?o:e.toScreen(o)},toScreen(o){let a=this.toWorld(o);return En(this)?a:e.toScreen(a)},fromScreen(o){return En(this)?this.fromWorld(o):this.fromWorld(e.toWorld(o))},toOther(o,a){return o.fromWorld(this.toWorld(a))},fromOther(o,a){return o.toOther(this,a)},inspect(){return`(${Math.round(this.pos.x)}, ${Math.round(this.pos.y)})`},drawInspect(){e.drawCircle({color:e.rgb(255,0,0),radius:4/r.getViewportScale()})}}}i(qt,"pos");function Xo(t){return{id:"rotate",angle:t??0,rotateBy(e){this.angle+=e},rotateTo(e){this.angle=e},inspect(){return`${Math.round(this.angle)}`}}}i(Xo,"rotate");function zt(...t){let e=J(this),r=fe(e);return t.length===0?zt(1):{id:"scale",scale:C(...t),scaleTo(...o){this.scale=C(...o)},scaleBy(...o){this.scale.scale(C(...o))},inspect(){return`(${r.toFixed(this.scale.x,2)}, ${r.toFixed(this.scale.y,2)})`}}}i(zt,"scale");function $o(t){return{id:"z",z:t,inspect(){return`${this.z}`}}}i($o,"z");var Qo="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAD0AAAA1CAYAAADyMeOEAAAAAXNSR0IArs4c6QAAAoVJREFUaIHdm7txwkAQhheGAqACiCHzOKQDQrqgILpwSAeEDBnEUAF0gCMxZ7G72qce/mec2Lpf9+3unaS78wgSNZ8uX5729+d1FNWXUuGmXlBOUUEIMckEpeQJgBu6C+BSFngztBR2vd+ovY+7g+p6LbgaWgJrAeUkDYIUXgXdBBwNi6kpABJwMTQH3AZsXRR8GHTfgEth8E3gjdAUcNewpbTgY85sCMCUuOokozE0YM0YRzM9NGAAXd8+omAF5h4lnmBRvpSnZHyLoLEbaN+aKB9KWv/KWw0tAbbANnlG+UvB2dm77NxxdwgBpjrF/d7rW9cbmpvio2A5z8iAYpVU8pGZlo6/2+MSco2lHfd3rv9jAP038e1xef9o2mjvYb2OqpqKE81028/jeietlSEVO5FRWsxWsJit1G3aFpW8iWe5RwpiCZAk25QvV6nz6fIlynRGuTd5WqpJ4guAlDfVKBK87hXljflgv1ON6fV+4+5gVlA17SfeG0heKqQd4l4jI/wrmaA9N9R4ar+wpHJDZyrrfcH0nB66PqAzPi76pn+faSyJk/vzOorYhGurQrzj/P68jtBMawHaHBIR9xoD5O34dy0qQOSYHvqExq2TpT2nf76+w7y251OYF0CRaU+J920TwLUa6inx6OxE6g80lu2ux7Y2eJLF/rCXE6zEPdnenk9o+4ih9AEdnW2q81HXl5LuU6OTl2fXUhqganbXAGq3g6jJOWV/OnoesO6YqqEB/GdNsjf7uHtwj2DzmRNpp7iOZfm6D9oAxB6Yi1gC4oIYeo4MIPdopEQRB+cAko5J1tW386HpB2Kz1eop4Epdwls/kgZ1sh8gZsEjdcWkr//D8Qu3Z3l5Nl1NtAAAAABJRU5ErkJggg==";var Jo="data:image/png;base64,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";var Zo=Fr("SUQzBAAAAAAAI1RTU0UAAAAPAAADTGF2ZjU4Ljc2LjEwMAAAAAAAAAAAAAAA//tQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAASW5mbwAAAA8AAAASAAAeMwAUFBQUFCIiIiIiIjAwMDAwPj4+Pj4+TExMTExZWVlZWVlnZ2dnZ3V1dXV1dYODg4ODkZGRkZGRn5+fn5+frKysrKy6urq6urrIyMjIyNbW1tbW1uTk5OTk8vLy8vLy//////8AAAAATGF2YzU4LjEzAAAAAAAAAAAAAAAAJAQKAAAAAAAAHjOZTf9/AAAAAAAAAAAAAAAAAAAAAP/7kGQAAANUMEoFPeACNQV40KEYABEY41g5vAAA9RjpZxRwAImU+W8eshaFpAQgALAAYALATx/nYDYCMJ0HITQYYA7AH4c7MoGsnCMU5pnW+OQnBcDrQ9Xx7w37/D+PimYavV8elKUpT5fqx5VjV6vZ38eJR48eRKa9KUp7v396UgPHkQwMAAAAAA//8MAOp39CECAAhlIEEIIECBAgTT1oj///tEQYT0wgEIYxgDC09aIiE7u7u7uIiIz+LtoIQGE/+XAGYLjpTAIOGYYy0ZACgDgSNFxC7YYiINocwERjAEDhIy0mRoGwAE7lOTBsGhj1qrXNCU9GrgwSPr80jj0dIpT9DRUNHKJbRxiWSiifVHuD2b0EbjLkOUzSXztP3uE1JpHzV6NPq+f3P5T0/f/lNH7lWTavQ5Xz1yLVe653///qf93B7f/vMdaKJAAJAMAIwIMAHMpzDkoYwD8CR717zVb8/p54P3MikXGCEWhQOEAOAdP6v8b8oNL/EzdnROC8Zo+z+71O8VVAGIKFEglKbidkoLam0mAFiwo0ZoVExf/7kmQLgAQyZFxvPWAENcVKXeK0ABAk2WFMaSNIzBMptBYfArbkZgpWjEQpcmjxQoG2qREWQcvpzuuIm29THt3ElhDNlrXV///XTGbm7Kbx0ymcRX///x7GVvquf5vk/dPs0Wi5Td1vggDxqbNII4bAPTU3Ix5h9FJTe7zv1LHG/uPsPrvth0ejchVzVT3giirs6sQAACgQAAIAdaXbRAYra/2t0//3HwqLKIlBOJhOg4BzAOkt+MOL6H8nlNvKyi3rOnqP//zf6AATwBAKIcHKixxwjl1TjDVIrvTqdmKQOFQBUBDwZ1EhHlDEGEVyGQWBAHrcJgRSXYbkvHK/8/6rbYjs4Qj0C8mRy2hwRv/82opGT55fROgRoBTjanaiQiMRHUu1/P3V9yGFffaVv78U1/6l/kpo0cz73vuSv/9GeaqDVRA5bWdHRKQKIEAAAAoIktKeEmdQFKN5sguv/ZSC0oxCAR7CzcJgEsd8cA0M/x0tzv15E7//5L5KCqoIAAmBFIKM1UxYtMMFjLKESTE8lhaelUyCBYeA2IN4rK1iDt//+5JkEgAkZzlVq29D8DJDWo0YLLARwPFZrL0PyLsUazTAlpI+hKSx01VSOfbjXg0iW9/jVPDleLJ15QQA4Okdc5ByMDFIeuCCE5CvevwBGH8YibiX9FtaIIgUikF42wrZw6ZJ6WlHrA+Ki5++NNMeYH1lEkwwJAIJB4ugVFguXFc20Vd/FLlvq1GSiSwAFABABABA47k6BFeNvxEQZO9v3L1IE4iEVElfrXmEmlyWIyGslFA55gH/sW7////o9AAFIBIIAAIUMzYTTNkgsAmYObfwQyzplrOmYvq0BKCKNN+nUTbvD7cJzvHxrEWG5QqvP8U1vFx6CwE8NoRc2ADBeEb/HoXh60N7ST8nw9QiiGoYvf/r6GtC9+vLwXHjaSkIp3iupC5+Nii81Zhu85pNYbFvrf+UFThDOYYY26off+W6b//73GTiN9xDfl0AAwBAiMBO8qsDBPOZtuT/dTbjVVbY/KSGH6ppHwKv/6X+s8gUCN/lODzv////GQAGAMQAADlXAUCBJiY0wFQZusYQOaQzaTwDBTcx0IvVp8m7uxKp//uSZBMCBHRI1eNPLHAyxNqWGeoYUIEnWYyxD8DUFSn0l6iojcd+oEOkzV6uWqyHNzjqmv+7V5xGUfY9yEmbziTzjRscm9OqFQp1PKFrqu3PX/7YuGtDU6bt0OUTpv38rdc+37dVDQLKUchaJ853E9edNDGqWwsYz1VoiSStEJtZvw6+sNqFWqaIXJjQCGAAGWAYVwmag/x3BRJw1wYF7IzVqDcNzn85d//FzK7IgwbQwccLoB4AsF8Nj/1ESRUAAVJwAFh0YOFEhmSJEHKQRDyhszgLUpHIgFrb5cySFg5jv10ImlYuvaaGBItfXqnNPmic+XNkmb5fW49vdhq97nQMQyGIlM2v8oQSrxKSxE4F1WqrduqvuJCRof1R7Gsre9KszUVF1/t3PzH2tnp+iSUG3rDwGNcDzxCGA8atuQF0paZAAkAhAQAEAC240yJV+nJgUrqq8axAYtVpYjZyFGb13/17jwiClQDaCdytZpyHHf1R/EG/+lUAgAAAChhmJvioVGGBCFgqdpsGAkUUrbTstwTCJgLQpFIsELW7t/68Iv/7kmQUgAQ9NFO9aeAAPAU6RKwUABClY2e5hoARGpDvPydCAsY8WO10fSvUOnfT98+n/l/6/+hxslhQ1DEOaevNKGocvIYba8WJpaP/15pX0NQ1DUNn/////k6lPp/N61rBi8RJFfERV3IgrqDsJA64sjCoKxDDQ9xEcWDpMBDwVFDIAEIAAzryxsjGi4q/oWpixKjhklAF4pUrDPjFhFVupDFZ/t/t0YPAygUBhADPR/KLCKJ8h2Oxhpxz/zNRAAFl0MAZLAYEAiVbEiz36LSgZ5QoQVat69KNy8FyM5Z80ACHAzgnISEkxUSJIDyBSwi5KF4mjBl4xJdbrG9ComLrL8YATiodhQKCkj6ROdyg1y5XmZlvMVmpJzYppJDwLi/Lp9vT3TfmimOGpuezi2U/9FNav0zX9Oja2r//8+hvuihuQAAMAVmqFgAgCcuboAEAAAUcqy8ca0BHBmwbFkED0CNA1YYDPkhcQrRJxcY3BzfxxltAz9vX62Xl3plAzWmRO+FkZyH///1qAAEjQBAACUpgU5o2AIBmFBGMamrGg0b/+5JkC4ADxyLWb2ngAEEkGofsoACP7U1JLaxTkOqFaKhspGgnW3SGC56ZgUJGCRnLOmIJAkuNBgvwU4Ocf8CJK9UsafH9/Frj///365XSoME+DZMw5UNjrMbVoeIj9EL91IuQ5KHyl5V2LCpdIdESgafOHxVGkAlkHuakmix/gN8+BP/sKguLAAoAtUjtvaoeEADwr3OK11E4KBlojgeQNQBJ4MvCAd/4t/xMMzeLhQGQ1//6tQu5BaBOGCT6U4aafvXZ//4iAPAAAAbLkgIlQmMSLA2H1CVNAlWwyVvKIQIxOSK1NWxs4MBUATlKrAkIMPAjCAdS6MVFzuURWa/+/qQWEGsA6EEpiBEJb9Q21lAHoBoD0B6aAPhyt+bG3muoXIN3RLadXxUfr/ohjGFF/p97eqNI5noKAqYLNPpUTDSI9/TmA6B+YAAADgA0Y4lxTW1SQfOQuDDDI0KTTuIrF5qoJrUFhUFAsg+AT2hbkaRZYGIjBKVDIa5VgNN/9P/rCDsBJbYJRKpCA1ArAkigIeYY61AjE+jubyiZFZ3+L789//uSZBCABHVj2entNmw1JXokLycYEFTFVa0wz4DYjKs08J2Q+r4n3lgbWaaMwMLEjFW88F39brqPF83cv1mCSJeY3Q2uiQxhBJxCBeR1D2LQRsYQcZUTzdNll8+OwZBsIwSgl45ymaHX603Mz7JmZuvt71GDTN66zev/+cLn/b5imV8pAHkg61FIJchBSG+zycgAZgADD6F1iQQRXRWmWS6bDIIgyBCZEcdl/KgXGmVKFv/vl8ry/5bLypf//U5jhYDhL9X/pAA0AKBIAAKgGtGXGGWJgEoF2JNsHlKfSKLRhGBAgIuWZKIJCFpF1VBhkB+EfzEyMUJdWuMrEZoPZ5BfF3/Nu62riIdjoO4AAKD2sTrDmpZZaYysf/810TitAVvn9xtFucieiaEy54YqiIO6RqkGAm5wVO0bFB0sDTdNxYGekKktR4KAAfAwUIgI8Ci6aXgtwbhPWAC+CKExAFydNtYGXNZoQjUsXv/9vKjgmdwieb+h7kHvPoc//0FaCACAATKFC4Y9ammklidbaiJNPBhGWTNhFSgdtalK12lpl//7kmQRAFN2NFI7TBvwNKNaTRsFGBWdfV2tPNcYvBHpgPKJsc8IUcTCxY3HSvUVNTWe/Z3YWlrJ0yrNRUiT19aprA7E+mPP+ZmC3/CsheOJXhc/9VJb3UZnphUBcqZUZQth1i3XqtPYu2Sy1s8DV9ZYACAAASAAHgFkQcOqgB5utFHFh3kSi4USs0yk4iOClREmjvdG+upaiLcRA6/9QGbOfxF/8sEAQAVG0G07YFMihKR4EXJCkRdX9isueLqUMRAQdhDZmv3KeR0nPqRVrZmSIXDt+BBSR7qqbKQcB98W9qiMb55preHIStxFWPE4lAyI+BKz2iSxonpvMR5DgKxTH6vGGXAbYCaAnJUW4W07EesQqbfqdbo4qNnPxSpn1H8eahszc/y9//dn1V7D/OYpn1szQKAPXTMlO/rO//u7JriJXbld7aP33v6RXYg/COIDzTWkTspg6Ay1YaDSwKxrP/LfIikHjmO871POf/kEAseAgoPEi9/0ZziNwfxVKy9qAEGEEAAq1EcOamDEGHAA0iao8k31rz2MiLNEik6VQ37/+5JkEAgEYU5WU0M3MDjDe0o9IjiOzSVM7aCzEM2GqXD8pFB0zxMcHCQNHtZD+R+pMWZxOJ/otEZTvVN/MeU12xTVcL+f2YaiNJTVoPd6SvzEnKel5GXOzEaazgdChnP2jOAwpfyRpVlQwoJBwpN1L1DL////6TVWcoepf7CVWrpEWiym5lR5U0BSMlxQC4qByOyQIAEuJfIriWixDqRgMfVZWuvRowjR9BzP5lZlT/+YG50CsSBG////////liXDQVMxEaBkbzKAAACnDIAstY7iK7gGSF7SIDexaTtPOHABk9YcmJEACmo50pgWal22etroBpYoVqtU6OPqvlf0c4QCAfLk9P/FJs4KCQMf6ECZyA6BwqqyJ0rMYj56k1/UlTIx1V3Rt5NF71D4qlptDC8VMgQVHFDlQnDFi06qQgKQAAIK4TxxJGFGYJuZNGXRdpq7IW/DYpPIQRFJLAc+qn1E0XYdOkQVJT+z8Lvff//8vbKAWTIBBUUdM6cOhlDry7x4dAkJXIBhbO3HSMMMGBQ9K9/JNfu09PjTO64wYEcR//uSZBeABP5g11NPRVwzQ4r8PMJVj7j9UU2wUwDPjeq0Z5w675D9+uDdL2QsuIry2lZtwn/pJYyRRjANEOQxNWw8mU7Tq+vueV7JrX/Pg7VIkEuZT5dwd85MVoq5lpStNICkBAcFR88//58KO8Zjt2PIGxWl1cVfXeNGH18SReNT//hYliWtQuNluxyxONbm4U+lpkAgpyE7yAIYUjIaqHmARJ0GQTtmH60xdwFp/u253XBCxD0f/lBcguCALn//Y5nqEv//1h4BAAwgAA5gcHmpIplgeW9fAOM6RFZUywrsGAiRmKkanQnCFBjYoPDS7bjwtPTkVI8D/P8VVLcTUz65n7PW2s3tNYHgEul4tBaIz0A9RgJAyAMI4/i0fpQKjhX9S+qIa0vmc4CZit/0/3UTDGeKNpkk0nu2rUE2ag8WErhE/kgAiQCJKQEYBA5Wn6CxHoIUh6dQ46nLIuwFk4S/LaDQxXu7Yf/pf//lwJB0S/Ff/4C///EiBEiAAAIAMnpngiIABAdMpKigkXaUwhLEGvpiofmXW57h2XAZO3CMRv/7kmQUAEOHQlHraRTQMkQp6GWFZBTVU1lNPTPYyIyocYeUoNgLBWAs1jPkTv/tXBaeZ/tbD/nAGP8/xT0SNEi5zof0KIVEzVe9r5lZOol7kyaXMYS4J/ZS3djp//UaeVyR0mUMlTgfz8XqMzIEgAQQ6UNQ1DSE0/C16OvyaocF4ijAGFci0FSYqCUSaWs6t9F6/699DKvMgMoK1//kSbvxtyBN27I7mdXgNMAW75sRU1UwUHYG5axI2tFIFpkgx7nnK+1JmRKjqeAd5Ph0QAL4QAnirmiPlg0yBDlrb/d3ngtA65rb999+8vdDCfnJuJAYIl285zklpVbrKpk1PEzrOY9NZUgyz6OiOsKt5qG/g2ibxSZ+/eTI/NB8n4ev//n2nIw85GAdwuJL7kYnnAbpcf1RBKH6b2U4RWP8dmWH5snsAFYwADBgAopKdzFJq4Jlmotloh/m4QpTSvJRE3nYZHephoqBhVf+P7vQ9BPlwZCP+3//+hdy5uUwS3LDEgQx4cdIgvDEBR1YqymCsSbKzRy2aQmSv+AAcAgAkvzPfuX/+5JkFQAj6VFX00Zr5DllOhhgpn4MmSs+zSRRiO8U5tWklYgSLKfs+Xheb/+6WaAQCKTztNeJ382MUltZNnjSJoFrCqB6C4mFcwJpJD4Oc8dLDXMTh9k1/rmTopfzqv9AvHWfOuZJlEvHSVMjyjpkVucKSzxJVQBgAAIo8DGqRdYCXPckFYg+dH9A/qUyljrtpxH9RJX/Z3Vv6uFkPg4M2jf3CL09QrwOrMt69n//8UFEAAMHWdhg1CcjyVBwiArOYlDL5NPY6x8ZLFBCGi6SVTKX5nqdSEFjebnv2zHdt0dj6xvORsSFzwqRNTJSZIrrlpXcURNL9WW7krBgr5jPMaGcvJ5v0N1s19CV7+7fvQfjySX2QECWUgKgeJCIif4WRBZ/6archpDkzE7oWctK3zEHP9Smeai8oeHkM6AK7pGjtOgeFv40ugqNd+Iv///uAZAMgAAAUeSWhLPpdwk3iXpBw43hOVIp1gliUOSaeZcZeZhLAH9TtD56wUpBduzLF5v5qViTH6o+I0+8Z1asaLgKVAohlpB72DgAQBQxEd3g//uSZCiAA6k0UdMPQfA+xcnBYON8E3WDVU0w1ZjPDSmo8IniHAFDNnkXF3B94gicH5d8MFw+IHZwufxOf/8gsHw+XrD4Jn8T4RAyQiABNBQg/3giEWuZ42mVFB3kkXNjhqBg1CghEUbN3/7/KBhyqNueef/MIDBClP3YRnKLiIlEFzf//0g+4zKpRIKTpqQgUtnHGFw6RSLN421iGcYapqFxny/capK9r9v+2BSy/RU1yZxa2eGaWK07ijfcxeiO3iuHJvjbXzts+Ny+XyFnsne1h0qG4mAaN6xRGaLVxKPlrri0Bg9oXGyxcw8JRBPkUzC8v451vVd9liSX85JMrmkVNwxOCwUg298////7ks//L409/hwMRIozKiIckXtjzDaAMTBcAACAwLGargPSEgEJZN/EFjfF/VKgaMYKMbwtf/T0UCGGfjfOAZ2frCigYdwh/+sGlQBxhCAAAUHkDPqOdmmUdAVYl3IhrEfR8qZFjLYEPOyzVGvm6lNUJCk2PNazwFxaijk+ZEaiTehoJGuDh6zN/EVP8BCLD/88BoY7Xv/7kmQlgBNmMtNTL0FwOGZJ/WHiKAyhJU+soE3A3JnmAa2oaCIru/+RrEHMTphxQ0X/LzoVy4gKhYl6ZUlklW7CLRVoYmgABwCRMAAMA/poCiEEYLsBVodWcVZ18+CcAfH165U4Xgh7/X1/BAQF6GN/BwQ/+D9S9P6wII//CoANYFYCBAKlGQDKhVjjylKARw2mPAtp8JjcQHggQswVsOEKsF6AIBWvmpIFdSZvRVv/LHWEy0+txMxu+VK9gEqG5pWf6GNGU4UBVkfd+bsj/6lZE0fkOpAqAOvyUO9oo+IiEtcLKOGzhhSGa4MYINHWoQsFr8zzmow0tRILkqz5/+vFxl/oZX/+qGW//xiLjR3xcGn//0QLkTQJh1UA8MAQAEXC/YxODKTDUEhrASs1512GRp+dRFFdTWIRaOXrve1eNjTNpreqQYrC9NBlQc1f8YO2po8bnH6qffuRvU7taiNF3baokE0YpmjRCHRclWBb9NCHKHpERwHRG3pqgXklq4sBpLjGvmekg8Y7SjM1FZopIM8IhB6dtMr8aKsdovh4FW//+5JkQ4CjTDdSU0gtIDiE+YBrKgwNbSVJTCBPwN8N5ZW8NKDnhRB8AXCm//KAsBUCwKU//oJQnET+UP3/zpYRocAAABJkVzzIuoLGEaDoxfsNva12EUdxhJMGFQioSg8GxKsLm8kWEmExJuNidarkk+OTXc0i2OZEq2v+tZr/MDZRS0I7LfRpHdlsiF6m/mEjk+XlK10UqtKYUwNgMx24hUtCJLfpM3ExUeKDYjClgZAzAjQ0qlNQBTsGpk9zSRkCiKkRGp572VXsPYChGvxhAuYkDYZK//jSRgto2mTf6+PJqgAAgIAAAACYZE6aZOHhYkYlcbpeYQq1RgLO4U8TIlL1sGw+iKZi5Kzc/bKT0yXrIUMES89RCWy8oWlxqIQlKANLFpT/KjUrK+UCYbZqGnjVj29aO5dzofWAskRX5eJWPi4kf/aRVjy3Wlyg2AnMYIDSTLwZUTASIzflPWUwwlUnIFMnGiyABeaXJcN91PmQJCLzmvUJkFOHCrX/+6O///IHnT4tT9YYBoNMQ09GfKIErwdwChNz1Qy5+5S/wWeY//uSZF+C03UyT2tMO0A3RRkhY20KzQjDMszhA8DjlGOBp5y4ZCS3ica52GIGiryv7FAaSDVZSXKFTiir+GvGiuK4rjgwPVTddso+W/42a4ueJJHDYtfj6YoKknnjzRgKA0fBIRZOSsprJqnoNN73ps/Z9DVgbKNbMGmRzrYBMAZCPUANkAZQ0syAC2ubK1NF90+WoesBpnhY8qwVDkNb/5Uof6//418TgElCSgAIgyAAQBHEmiaQFPIRmfAMELffpo0IflyEuAAQnSnKvwTlVlnIgOAAGS3P3IydjXPSh/CaVRqpSNCjQqDvPM+fLcuN+WgqNix6CoHomUWTT86JjziRSZ3yjnq+dIldKPU11KUuf6wAASMAAJxE+MlyktgE9UGSxjEx6RR0v1s9bWZ+EJSrGtjqUIhklG3J8eLRn/2U/nv7f///+7/6gBQgEAMUijVMwweWWMyYM/PLXuc7DptIQmBARMRCxXjEIcTNDQgSSeHpUNXO7dRSOllJPvnY7yzaO1hmUjsKvHe99fOxrabMX7mGTi5tsNkZVZLndzxse//7kmR7ABM2O0pbKTvQN4NI+WGFPA2ZESs1pYAAvA0jVrJwAHfbr/c6//vW790dzX36QNBRlDv/6QQAU3V64yUgBEAYc/lI8e5bm+Z9+j+4aaj4tFrb//iker/4a12b/V//q//9v+7vAEAAAAMqZTGd5gL4f54o6ZebKNrR/zWVYUEVYVVv8BuAV2OUT+DUQgkJ8J1Ey4ZbFCiAwgwzMSdHV4jQR+OoPWEASaPkyYq+PsQFFJCsEEJtOiUjI/+GRhtC2DnizTMXATJig9Ey/kAJMrkHGYJ8gpLjmJOYoskpav+ShRJInyGGZVJMihDi6pIxRZJJel/8iZPkYiREnyKE0akTL5QNSqT5iiySS9Ja2SV//5ME0ak//+4KgAAABgQBAADAMDgYCAEgCteQ0fZH6+ICXA357+MPfhR/+ywRf/U///LVTEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5JknQAFoWhGLm5gBClBmT3GiAAAAAGkHAAAIAAANIOAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV");var es="data:image/png;base64,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";var ra="3001.0.0";function ht(t){switch(t){case"topleft":return new T(-1,-1);case"top":return new T(0,-1);case"topright":return new T(1,-1);case"left":return new T(-1,0);case"center":return new T(0,0);case"right":return new T(1,0);case"botleft":return new T(-1,1);case"bot":return new T(0,1);case"botright":return new T(1,1);default:return t}}i(ht,"anchorPt");function oa(t){switch(t){case"left":return 0;case"center":return .5;case"right":return 1;default:return 0}}i(oa,"alignPt");function sa(t){return t.createBuffer(1,1,44100)}i(sa,"createEmptyAudioBuffer");var $e,as=i(t=>t&&t.loadAseprite,"isKaboomCtx"),J=i(t=>{if(!$e)throw new Error("You are trying to access to Kaboom Context before their initialization.");return as(t)?t:$e},"getKaboomContext"),fe=i(t=>t._k,"getInternalContext"),ia=i((t={})=>{let e=t.root??document.body;e===document.body&&(document.body.style.width="100%",document.body.style.height="100%",document.body.style.margin="0px",document.documentElement.style.width="100%",document.documentElement.style.height="100%");let r=t.canvas??e.appendChild(document.createElement("canvas")),o=t.scale??1,a=t.width&&t.height&&!t.stretch&&!t.letterbox;a?(r.width=t.width*o,r.height=t.height*o):(r.width=r.parentElement.offsetWidth,r.height=r.parentElement.offsetHeight);let l=["outline: none","cursor: default"];if(a){let n=r.width,s=r.height;l.push(`width: ${n}px`),l.push(`height: ${s}px`)}else l.push("width: 100%"),l.push("height: 100%");t.crisp&&(l.push("image-rendering: pixelated"),l.push("image-rendering: crisp-edges")),r.style.cssText=l.join(";");let u=t.pixelDensity||window.devicePixelRatio;r.width*=u,r.height*=u,r.tabIndex=0;let f=document.createElement("canvas");f.width=256,f.height=256;let y=f.getContext("2d",{willReadFrequently:!0}),m=co({canvas:r,touchToMouse:t.touchToMouse,gamepads:t.gamepads,pixelDensity:t.pixelDensity,maxFPS:t.maxFPS}),V=[],x=m.canvas.getContext("webgl",{antialias:!0,depth:!0,stencil:!0,alpha:!0,preserveDrawingBuffer:!0}),P=hr(x,{texFilter:t.texFilter}),w=(()=>{let n=Dt(bn,vn),s=qe.fromImage(P,new ImageData(new Uint8ClampedArray([255,255,255,255]),1,1)),c=t.width&&t.height?new yt(P,t.width*u*o,t.height*u*o):new yt(P,x.drawingBufferWidth,x.drawingBufferHeight),h=null,d=1;t.background&&(h=oe(t.background),d=Array.isArray(t.background)?t.background[3]:1,x.clearColor(h.r/255,h.g/255,h.b/255,d??1)),x.enable(x.BLEND),x.blendFuncSeparate(x.SRC_ALPHA,x.ONE_MINUS_SRC_ALPHA,x.ONE,x.ONE_MINUS_SRC_ALPHA);let v=new pn(P,gn,po,fo),b=qe.fromImage(P,new ImageData(new Uint8ClampedArray([128,128,128,255,190,190,190,255,190,190,190,255,128,128,128,255]),2,2),{wrap:"repeat",filter:"nearest"});return{lastDrawCalls:0,defShader:n,defTex:s,frameBuffer:c,postShader:null,postShaderUniform:null,renderer:v,transform:new Ge,transformStack:[],bgTex:b,bgColor:h,bgAlpha:d,width:t.width??x.drawingBufferWidth/u/o,height:t.height??x.drawingBufferHeight/u/o,viewport:{x:0,y:0,width:x.drawingBufferWidth,height:x.drawingBufferHeight},fixed:!1}})();class K{static{i(this,"SpriteData")}tex;frames=[new me(0,0,1,1)];anims={};slice9=null;constructor(s,c,h={},d=null){this.tex=s,c&&(this.frames=c),this.anims=h,this.slice9=d}get width(){return this.tex.width*this.frames[0].w}get height(){return this.tex.height*this.frames[0].h}static from(s,c={}){return typeof s=="string"?K.fromURL(s,c):Promise.resolve(K.fromImage(s,c))}static fromImage(s,c={}){let[h,d]=N.packer.add(s),v=c.frames?c.frames.map(b=>new me(d.x+b.x*d.w,d.y+b.y*d.h,b.w*d.w,b.h*d.h)):Ce(c.sliceX||1,c.sliceY||1,d.x,d.y,d.w,d.h);return new K(h,v,c.anims,c.slice9)}static fromURL(s,c={}){return _t(s).then(h=>K.fromImage(h,c))}}class Y{static{i(this,"SoundData")}buf;constructor(s){this.buf=s}static fromArrayBuffer(s){return new Promise((c,h)=>z.ctx.decodeAudioData(s,c,h)).then(c=>new Y(c))}static fromURL(s){return cr(s)?Y.fromArrayBuffer(no(s)):lo(s).then(c=>Y.fromArrayBuffer(c))}}let z=(()=>{let n=new(window.AudioContext||window.webkitAudioContext),s=n.createGain();s.connect(n.destination);let c=new Y(sa(n));return n.decodeAudioData(Zo.buffer.slice(0)).then(h=>{c.buf=h}).catch(h=>{console.error("Failed to load burp: ",h)}),{ctx:n,masterNode:s,burpSnd:c}})(),N={urlPrefix:"",sprites:new nt,fonts:new nt,bitmapFonts:new nt,sounds:new nt,shaders:new nt,custom:new nt,music:{},packer:new Kt(P,2048,2048),loaded:!1};function $(n){return typeof n!="string"||cr(n)?n:N.urlPrefix+n}i($,"fixURL");let O={events:new tt,objEvents:new tt,root:Ln([]),gravity:null,scenes:{},currentScene:null,logs:[],cam:{pos:null,scale:new T(1),angle:0,shake:0,transform:new Ge}};O.root.use(Cn());function se(n){return N.custom.add(null,n)}i(se,"load");function _(){let n=[N.sprites,N.sounds,N.shaders,N.fonts,N.bitmapFonts,N.custom];return n.reduce((s,c)=>s+c.progress(),0)/n.length}i(_,"loadProgress");function ae(n){return n!==void 0&&(N.urlPrefix=n),N.urlPrefix}i(ae,"loadRoot");function re(n,s){return N.custom.add(n,Nt(s))}i(re,"loadJSON");class ce{static{i(this,"FontData")}fontface;filter=fn;outline=null;size=64;constructor(s,c={}){if(this.fontface=s,this.filter=c.filter??fn,this.size=c.size??64,this.size>256)throw new Error(`Max font size: ${256}`);c.outline&&(this.outline={width:1,color:oe(0,0,0)},typeof c.outline=="number"?this.outline.width=c.outline:typeof c.outline=="object"&&(c.outline.width&&(this.outline.width=c.outline.width),c.outline.color&&(this.outline.color=c.outline.color)))}}function ge(n,s,c={}){let h=new FontFace(n,typeof s=="string"?`url(${s})`:s);return document.fonts.add(h),N.fonts.add(n,h.load().catch(d=>{throw new Error(`Failed to load font from "${s}": ${d}`)}).then(d=>new ce(d,c)))}i(ge,"loadFont");function Ue(n,s,c,h,d={}){return N.bitmapFonts.add(n,_t(s).then(v=>Mn(qe.fromImage(P,v,d),c,h,d.chars??fr)))}i(Ue,"loadBitmapFont");function Ce(n=1,s=1,c=0,h=0,d=1,v=1){let b=[],D=d/n,R=v/s;for(let g=0;g<s;g++)for(let A=0;A<n;A++)b.push(new me(c+A*D,h+g*R,D,R));return b}i(Ce,"slice");function Le(n,s){return n=$(n),se(typeof s=="string"?new Promise((c,h)=>{Nt(s).then(d=>{Le(n,d).then(c).catch(h)})}):K.from(n).then(c=>{let h={};for(let d in s){let v=s[d],b=c.frames[0],D=2048*b.w,R=2048*b.h,g=v.frames?v.frames.map(k=>new me(b.x+(v.x+k.x)/D*b.w,b.y+(v.y+k.y)/R*b.h,k.w/D*b.w,k.h/R*b.h)):Ce(v.sliceX||1,v.sliceY||1,b.x+v.x/D*b.w,b.y+v.y/R*b.h,v.width/D*b.w,v.height/R*b.h),A=new K(c.tex,g,v.anims);N.sprites.addLoaded(d,A),h[d]=A}return h}))}i(Le,"loadSpriteAtlas");function je(n,s={}){let c=document.createElement("canvas"),h=n[0].width,d=n[0].height;c.width=h*n.length,c.height=d;let v=c.getContext("2d");n.forEach((D,R)=>{D instanceof ImageData?v.putImageData(D,R*h,0):v.drawImage(D,R*h,0)});let b=v.getImageData(0,0,n.length*h,d);return K.fromImage(b,{...s,sliceX:n.length,sliceY:1})}i(je,"createSpriteSheet");function Ee(n,s,c={sliceX:1,sliceY:1,anims:{}}){return s=$(s),Array.isArray(s)?s.some(h=>typeof h=="string")?N.sprites.add(n,Promise.all(s.map(h=>typeof h=="string"?_t(h):Promise.resolve(h))).then(h=>je(h,c))):N.sprites.addLoaded(n,je(s,c)):typeof s=="string"?N.sprites.add(n,K.from(s,c)):N.sprites.addLoaded(n,K.fromImage(s,c))}i(Ee,"loadSprite");function Ne(n,s){return s=$(s),N.sprites.add(n,new Promise(async c=>{let h=typeof s=="string"?await Nt(s):s,d=await Promise.all(h.frames.map(_t)),v=document.createElement("canvas");v.width=h.width,v.height=h.height*h.frames.length;let b=v.getContext("2d");d.forEach((R,g)=>{b.drawImage(R,0,g*h.height)});let D=await Ee(null,v,{sliceY:h.frames.length,anims:h.anims});c(D)}))}i(Ne,"loadPedit");function _e(n,s,c){s=$(s),c=$(c),typeof s=="string"&&!c&&(c=oo(s)+".json");let h=typeof c=="string"?Nt(c):Promise.resolve(c);return N.sprites.add(n,h.then(d=>{let v=d.meta.size,b=d.frames.map(R=>new me(R.frame.x/v.w,R.frame.y/v.h,R.frame.w/v.w,R.frame.h/v.h)),D={};for(let R of d.meta.frameTags)R.from===R.to?D[R.name]=R.from:D[R.name]={from:R.from,to:R.to,speed:10,loop:!0,pingpong:R.direction==="pingpong"};return K.from(s,{frames:b,anims:D})}))}i(_e,"loadAseprite");function He(n,s,c){return N.shaders.addLoaded(n,Dt(s,c))}i(He,"loadShader");function pt(n,s,c){s=$(s),c=$(c);let h=i(v=>v?uo(v):Promise.resolve(null),"resolveUrl"),d=Promise.all([h(s),h(c)]).then(([v,b])=>Dt(v,b));return N.shaders.add(n,d)}i(pt,"loadShaderURL");function Se(n,s){return s=$(s),N.sounds.add(n,typeof s=="string"?Y.fromURL(s):Y.fromArrayBuffer(s))}i(Se,"loadSound");function Ve(n,s){let c=new Audio(s);return c.preload="auto",N.music[n]=$(s)}i(Ve,"loadMusic");function ze(n="bean"){return Ee(n,Qo)}i(ze,"loadBean");function rt(n){return N.sprites.get(n)}i(rt,"getSprite");function ot(n){return N.sounds.get(n)}i(ot,"getSound");function wt(n){return N.fonts.get(n)}i(wt,"getFont");function Wt(n){return N.bitmapFonts.get(n)}i(Wt,"getBitmapFont");function Yt(n){return N.shaders.get(n)}i(Yt,"getShader");function An(n){return N.custom.get(n)}i(An,"getAsset");function Xt(n){if(typeof n=="string"){let s=rt(n);if(s)return s;if(_()<1)return null;throw new Error(`Sprite not found: ${n}`)}else{if(n instanceof K)return Re.loaded(n);if(n instanceof Re)return n;throw new Error(`Invalid sprite: ${n}`)}}i(Xt,"resolveSprite");function Rn(n){if(typeof n=="string"){let s=ot(n);if(s)return s;if(_()<1)return null;throw new Error(`Sound not found: ${n}`)}else{if(n instanceof Y)return Re.loaded(n);if(n instanceof Re)return n;throw new Error(`Invalid sound: ${n}`)}}i(Rn,"resolveSound");function Un(n){if(!n)return w.defShader;if(typeof n=="string"){let s=Yt(n);if(s)return s.data??s;if(_()<1)return null;throw new Error(`Shader not found: ${n}`)}else if(n instanceof Re)return n.data?n.data:n;return n}i(Un,"resolveShader");function $t(n){if(!n)return $t(t.font??mo);if(typeof n=="string"){let s=Wt(n),c=wt(n);if(s)return s.data??s;if(c)return c.data??c;if(document.fonts.check(`${64}px ${n}`))return n;if(_()<1)return null;throw new Error(`Font not found: ${n}`)}else if(n instanceof Re)return n.data?n.data:n;return n}i($t,"resolveFont");function Vn(n){return n!==void 0&&(z.masterNode.gain.value=n),z.masterNode.gain.value}i(Vn,"volume");function Pn(n,s={}){let c=new we,h=new Audio(n);z.ctx.createMediaElementSource(h).connect(z.masterNode);function v(){le.paused||m.isHidden()&&!t.backgroundAudio||z.ctx.resume()}i(v,"resumeAudioCtx");function b(){v(),h.play()}return i(b,"play"),s.paused||b(),h.onended=()=>c.trigger(),{play(){b()},seek(D){h.currentTime=D},stop(){h.pause(),this.seek(0)},set loop(D){h.loop=D},get loop(){return h.loop},set paused(D){D?h.pause():b()},get paused(){return h.paused},time(){return h.currentTime},duration(){return h.duration},set volume(D){h.volume=Qe(D,0,1)},get volume(){return h.volume},set speed(D){h.playbackRate=Math.max(D,0)},get speed(){return h.playbackRate},set detune(D){},get detune(){return 0},onEnd(D){return c.add(D)},then(D){return this.onEnd(D)}}}i(Pn,"playMusic");function Qt(n,s={}){if(typeof n=="string"&&N.music[n])return Pn(N.music[n],s);let c=z.ctx,h=s.paused??!1,d=c.createBufferSource(),v=new we,b=c.createGain(),D=s.seek??0,R=0,g=0,A=!1;d.loop=!!s.loop,d.detune.value=s.detune??0,d.playbackRate.value=s.speed??1,d.connect(b),d.onended=()=>{B()>=(d.buffer?.duration??Number.POSITIVE_INFINITY)&&v.trigger()},b.connect(z.masterNode),b.gain.value=s.volume??1;let k=i(G=>{d.buffer=G.buf,h||(R=c.currentTime,d.start(0,D),A=!0)},"start"),U=Rn(n);U instanceof Re&&U.onLoad(k);let B=i(()=>{if(!d.buffer)return 0;let G=h?g-R:c.currentTime-R,I=d.buffer.duration;return d.loop?G%I:Math.min(G,I)},"getTime"),M=i(G=>{let I=c.createBufferSource();return I.buffer=G.buffer,I.loop=G.loop,I.playbackRate.value=G.playbackRate.value,I.detune.value=G.detune.value,I.onended=G.onended,I.connect(b),I},"cloneNode");return{stop(){this.paused=!0,this.seek(0)},set paused(G){if(h!==G)if(h=G,G)A&&(d.stop(),A=!1),g=c.currentTime;else{d=M(d);let I=g-R;d.start(0,I),A=!0,R=c.currentTime-I,g=0}},get paused(){return h},play(G=0){this.seek(G),this.paused=!1},seek(G){d.buffer?.duration&&(G>d.buffer.duration||(h?(d=M(d),R=g-G):(d.stop(),d=M(d),R=c.currentTime-G,d.start(0,G),A=!0,g=0)))},set speed(G){d.playbackRate.value=G},get speed(){return d.playbackRate.value},set detune(G){d.detune.value=G},get detune(){return d.detune.value},set volume(G){b.gain.value=Math.max(G,0)},get volume(){return b.gain.value},set loop(G){d.loop=G},get loop(){return d.loop},duration(){return d.buffer?.duration??0},time(){return B()%this.duration()},onEnd(G){return v.add(G)},then(G){return this.onEnd(G)}}}i(Qt,"play");function Jt(n){return Qt(z.burpSnd,n)}i(Jt,"burp");function Dn(n,s){let c=new yt(P,n,s);return{clear:()=>c.clear(),free:()=>c.free(),toDataURL:()=>c.toDataURL(),toImageData:()=>c.toImageData(),width:c.width,height:c.height,draw:h=>{Pe(),c.bind(),h(),Pe(),c.unbind()}}}i(Dn,"makeCanvas");function Dt(n=bn,s=vn){let c=go.replace("{{user}}",n??bn),h=bo.replace("{{user}}",s??vn);try{return new hn(P,c,h,gn.map(d=>d.name))}catch(d){let b=/(?<type>^\w+) SHADER ERROR: 0:(?<line>\d+): (?<msg>.+)/,D=io(d).match(b),R=Number(D.groups.line)-14,g=D.groups.msg.trim(),A=D.groups.type.toLowerCase();throw new Error(`${A} shader line ${R}: ${g}`)}}i(Dt,"makeShader");function Mn(n,s,c,h){let d=n.width/s,v={},b=h.split("").entries();for(let[D,R]of b)v[R]=new me(D%d*s,Math.floor(D/d)*c,s,c);return{tex:n,map:v,size:c}}i(Mn,"makeFont");function st(n,s,c,h=w.defTex,d=w.defShader,v={}){let b=Un(d);if(!b||b instanceof Re)return;let D=w.fixed||c?w.transform:O.cam.transform.mult(w.transform),R=[];for(let g of n){let A=Zt(D.multVec2(g.pos));R.push(A.x,A.y,g.uv.x,g.uv.y,g.color.r/255,g.color.g/255,g.color.b/255,g.opacity)}w.renderer.push(x.TRIANGLES,R,s,b,h,v)}i(st,"drawRaw");function Pe(){w.renderer.flush()}i(Pe,"flush");function Ct(){x.clear(x.COLOR_BUFFER_BIT),w.frameBuffer.bind(),x.clear(x.COLOR_BUFFER_BIT),w.bgColor||ct(()=>{it({width:De(),height:ke(),quad:new me(0,0,De()/64,ke()/64),tex:w.bgTex,fixed:!0})}),w.renderer.numDraws=0,w.fixed=!1,w.transformStack.length=0,w.transform=new Ge}i(Ct,"frameStart");function Gn(n,s){w.postShader=n,w.postShaderUniform=s??null}i(Gn,"usePostEffect");function Mt(){Pe(),w.lastDrawCalls=w.renderer.numDraws,w.frameBuffer.unbind(),x.viewport(0,0,x.drawingBufferWidth,x.drawingBufferHeight);let n=w.width,s=w.height;w.width=x.drawingBufferWidth/u,w.height=x.drawingBufferHeight/u,Gt({flipY:!0,tex:w.frameBuffer.tex,pos:new T(w.viewport.x,w.viewport.y),width:w.viewport.width,height:w.viewport.height,shader:w.postShader,uniform:typeof w.postShaderUniform=="function"?w.postShaderUniform():w.postShaderUniform,fixed:!0}),Pe(),w.width=n,w.height=s}i(Mt,"frameEnd");function Zt(n){return new T(n.x/De()*2-1,-n.y/ke()*2+1)}i(Zt,"screen2ndc");function Bn(n){w.transform=n.clone()}i(Bn,"pushMatrix");function de(...n){if(n[0]===void 0)return;let s=C(...n);s.x===0&&s.y===0||w.transform.translate(s)}i(de,"pushTranslate");function he(...n){if(n[0]===void 0)return;let s=C(...n);s.x===1&&s.y===1||w.transform.scale(s)}i(he,"pushScale");function Ke(n){n&&w.transform.rotate(n)}i(Ke,"pushRotate");function xe(){w.transformStack.push(w.transform.clone())}i(xe,"pushTransform");function Oe(){w.transformStack.length>0&&(w.transform=w.transformStack.pop())}i(Oe,"popTransform");function it(n){if(n.width===void 0||n.height===void 0)throw new Error('drawUVQuad() requires property "width" and "height".');if(n.width<=0||n.height<=0)return;let s=n.width,c=n.height,d=ht(n.anchor||Vt).scale(new T(s,c).scale(-.5)),v=n.quad||new me(0,0,1,1),b=n.color||oe(255,255,255),D=n.opacity??1,R=n.tex?.1/n.tex.width:0,g=n.tex?.1/n.tex.height:0,A=v.x+R,k=v.y+g,U=v.w-R*2,B=v.h-g*2;xe(),de(n.pos),Ke(n.angle),he(n.scale),de(d),st([{pos:new T(-s/2,c/2),uv:new T(n.flipX?A+U:A,n.flipY?k:k+B),color:b,opacity:D},{pos:new T(-s/2,-c/2),uv:new T(n.flipX?A+U:A,n.flipY?k+B:k),color:b,opacity:D},{pos:new T(s/2,-c/2),uv:new T(n.flipX?A:A+U,n.flipY?k+B:k),color:b,opacity:D},{pos:new T(s/2,c/2),uv:new T(n.flipX?A:A+U,n.flipY?k:k+B),color:b,opacity:D}],[0,1,3,1,2,3],n.fixed,n.tex,n.shader,n.uniform),Oe()}i(it,"drawUVQuad");function Gt(n){if(!n.tex)throw new Error('drawTexture() requires property "tex".');let s=n.quad??new me(0,0,1,1),c=n.tex.width*s.w,h=n.tex.height*s.h,d=new T(1);if(n.tiled){let v=Math.ceil((n.width||c)/c),b=Math.ceil((n.height||h)/h),R=ht(n.anchor||Vt).add(new T(1,1)).scale(.5).scale(v*c,b*h);for(let g=0;g<v;g++)for(let A=0;A<b;A++)it(Object.assign({},n,{pos:(n.pos||new T(0)).add(new T(c*g,h*A)).sub(R),scale:d.scale(n.scale||new T(1)),tex:n.tex,quad:s,width:c,height:h,anchor:"topleft"}))}else n.width&&n.height?(d.x=n.width/c,d.y=n.height/h):n.width?(d.x=n.width/c,d.y=d.x):n.height&&(d.y=n.height/h,d.x=d.y),it(Object.assign({},n,{scale:d.scale(n.scale||new T(1)),tex:n.tex,quad:s,width:c,height:h}))}i(Gt,"drawTexture");function en(n){if(!n.sprite)throw new Error('drawSprite() requires property "sprite"');let s=Xt(n.sprite);if(!s||!s.data)return;let c=s.data.frames[n.frame??0];if(!c)throw new Error(`Frame not found: ${n.frame??0}`);Gt(Object.assign({},n,{tex:s.data.tex,quad:c.scale(n.quad??new me(0,0,1,1))}))}i(en,"drawSprite");function at(n,s,c,h,d,v=1){h=ve(h%360),d=ve(d%360),d<=h&&(d+=Math.PI*2);let b=[],D=Math.ceil((d-h)/ve(8)*v),R=(d-h)/D;for(let g=h;g<d;g+=R)b.push(n.add(s*Math.cos(g),c*Math.sin(g)));return b.push(n.add(s*Math.cos(d),c*Math.sin(d))),b}i(at,"getArcPts");function p(n){if(n.width===void 0||n.height===void 0)throw new Error('drawRect() requires property "width" and "height".');if(n.width<=0||n.height<=0)return;let s=n.width,c=n.height,d=ht(n.anchor||Vt).add(1,1).scale(new T(s,c).scale(-.5)),v=[new T(0,0),new T(s,0),new T(s,c),new T(0,c)];if(n.radius){let b=Math.min(Math.min(s,c)/2,n.radius);v=[new T(b,0),new T(s-b,0),...at(new T(s-b,b),b,b,270,360),new T(s,b),new T(s,c-b),...at(new T(s-b,c-b),b,b,0,90),new T(s-b,c),new T(b,c),...at(new T(b,c-b),b,b,90,180),new T(0,c-b),new T(0,b),...at(new T(b,b),b,b,180,270)]}Et(Object.assign({},n,{offset:d,pts:v,...n.gradient?{colors:n.horizontal?[n.gradient[0],n.gradient[1],n.gradient[1],n.gradient[0]]:[n.gradient[0],n.gradient[0],n.gradient[1],n.gradient[1]]}:{}}))}i(p,"drawRect");function S(n){let{p1:s,p2:c}=n;if(!s||!c)throw new Error('drawLine() requires properties "p1" and "p2".');let h=n.width||1,d=c.sub(s).unit().normal().scale(h*.5),v=[s.sub(d),s.add(d),c.add(d),c.sub(d)].map(b=>({pos:new T(b.x,b.y),uv:new T(0),color:n.color??ee.WHITE,opacity:n.opacity??1}));st(v,[0,1,3,1,2,3],n.fixed,w.defTex,n.shader,n.uniform)}i(S,"drawLine");function L(n){let s=n.pts,c=[],h=(n.width||1)*.5,d=s[0]===s[s.length-1]||s[0].eq(s[s.length-1]),v=n.pos||C(0,0),b;d?b=s[0].sub(s[s.length-2]):b=s[1].sub(s[0]);let D=b.len(),R=b.normal().scale(-h/D),g,A=s[0];for(let M=1;M<s.length;M++){g=A,A=s[M];let G=A.sub(g),I=G.len(),te=G.normal().scale(-h/I),Z=b.cross(G);if(Math.abs(Z)/(D*I)<.05){c.push(g.add(R)),c.push(g.sub(R)),b.dot(G)<0&&(c.push(g.sub(R)),c.push(g.add(R))),b=G,D=I,R=te;continue}let ne=te.sub(R).cross(G)/Z,q=R.add(b.scale(ne));Z>0?(c.push(g.add(q)),c.push(g.sub(R)),c.push(g.add(q)),c.push(g.sub(te))):(c.push(g.add(R)),c.push(g.sub(q)),c.push(g.add(te)),c.push(g.sub(q))),b=G,D=I,R=te}let k=c.map(M=>({pos:v.add(M),uv:C(),color:n.color||ee.WHITE,opacity:n.opacity??1})),U=[],B=0;for(let M=0;M<c.length-2;M+=2)U[B++]=M+1,U[B++]=M,U[B++]=M+2,U[B++]=M+2,U[B++]=M+3,U[B++]=M+1;d&&(U[B++]=c.length-1,U[B++]=c.length-2,U[B++]=0,U[B++]=0,U[B++]=1,U[B++]=c.length-1),st(k,U,n.fixed,w.defTex,n.shader,n.uniform)}i(L,"_drawLinesBevel");function W(n){let s=n.pts,c=[],h=(n.width||1)*.5,d=s[0]===s[s.length-1]||s[0].eq(s[s.length-1]),v=n.pos||C(0,0),b;d?b=s[0].sub(s[s.length-2]):b=s[1].sub(s[0]);let D=b.len(),R=b.normal().scale(-h/D),g,A=s[0];for(let M=1;M<s.length;M++){g=A,A=s[M];let G=A.sub(g),I=G.len(),te=G.normal().scale(-h/I),Z=b.cross(G);if(Math.abs(Z)/(D*I)<.05){c.push(g.add(R)),c.push(g.sub(R)),b.dot(G)<0&&(c.push(g.sub(R)),c.push(g.add(R))),b=G,D=I,R=te;continue}let ne=te.sub(R).cross(G)/Z,q=R.add(b.scale(ne));if(Z>0){let Me=g.add(q),E=Math.max(h,10),j=ve(R.angleBetween(te)/E),F=R,H=Math.cos(j),X=Math.sin(j);for(let Q=0;Q<E;Q++)c.push(Me),c.push(g.sub(F)),F=C(F.x*H-F.y*X,F.x*X+F.y*H)}else{let Me=g.sub(q),E=Math.max(h,10),j=ve(R.angleBetween(te)/E),F=R,H=Math.cos(j),X=Math.sin(j);for(let Q=0;Q<E;Q++)c.push(g.add(F)),c.push(Me),F=C(F.x*H-F.y*X,F.x*X+F.y*H)}b=G,D=I,R=te}let k=c.map(M=>({pos:v.add(M),uv:C(),color:n.color||ee.WHITE,opacity:n.opacity??1})),U=[],B=0;for(let M=0;M<c.length-2;M+=2)U[B++]=M+1,U[B++]=M,U[B++]=M+2,U[B++]=M+2,U[B++]=M+3,U[B++]=M+1;d&&(U[B++]=c.length-1,U[B++]=c.length-2,U[B++]=0,U[B++]=0,U[B++]=1,U[B++]=c.length-1),st(k,U,n.fixed,w.defTex,n.shader,n.uniform)}i(W,"_drawLinesRound");function ye(n){let s=n.pts,c=[],h=(n.width||1)*.5,d=s[0]===s[s.length-1]||s[0].eq(s[s.length-1]),v=n.pos||C(0,0),b;d?b=s[0].sub(s[s.length-2]):b=s[1].sub(s[0]);let D=b.len(),R=b.normal().scale(-h/D),g,A=s[0];for(let M=1;M<s.length;M++){g=A,A=s[M];let G=A.sub(g),I=G.len(),te=G.normal().scale(-h/I),Z=b.cross(G);if(Math.abs(Z)/(D*I)<.05){c.push(g.add(R)),c.push(g.sub(R)),b.dot(G)<0&&(c.push(g.sub(R)),c.push(g.add(R))),b=G,D=I,R=te;continue}let ne=te.sub(R).cross(G)/Z,q=R.add(b.scale(ne));c.push(g.add(q)),c.push(g.sub(q)),b=G,D=I,R=te}let k=c.map(M=>({pos:v.add(M),uv:C(),color:n.color||ee.WHITE,opacity:n.opacity??1})),U=[],B=0;for(let M=0;M<c.length-2;M+=2)U[B++]=M+1,U[B++]=M,U[B++]=M+2,U[B++]=M+2,U[B++]=M+3,U[B++]=M+1;d&&(U[B++]=c.length-1,U[B++]=c.length-2,U[B++]=0,U[B++]=0,U[B++]=1,U[B++]=c.length-1),st(k,U,n.fixed,w.defTex,n.shader,n.uniform)}i(ye,"_drawLinesMiter");function ie(n){let s=n.pts;if(!s)throw new Error('drawLines() requires property "pts".');if(!(s.length<2)){if(s.length>2)switch(n.join){case"bevel":return L(n);case"round":return W(n);case"miter":return ye(n)}if(n.radius&&s.length>=3){let c=s[0].sdist(s[1]);for(let d=1;d<s.length-1;d++)c=Math.min(s[d].sdist(s[d+1]),c);let h=Math.min(n.radius,Math.sqrt(c)/2);S(Object.assign({},n,{p1:s[0],p2:s[1]}));for(let d=1;d<s.length-2;d++){let v=s[d],b=s[d+1];S(Object.assign({},n,{p1:v,p2:b}))}S(Object.assign({},n,{p1:s[s.length-2],p2:s[s.length-1]}))}else for(let c=0;c<s.length-1;c++)S(Object.assign({},n,{p1:s[c],p2:s[c+1]})),n.join!=="none"&&Ye(Object.assign({},n,{pos:s[c],radius:n.width/2}))}}i(ie,"drawLines");function We(n,s){let c=s.segments??16,h=[];for(let d=0;d<=c;d++)h.push(n(d/c));ie({pts:h,width:s.width||1,pos:s.pos,color:s.color,opacity:s.opacity})}i(We,"drawCurve");function ft(n){We(s=>rr(n.pt1,n.pt2,n.pt3,n.pt4,s),n)}i(ft,"drawBezier");function tn(n){if(!n.p1||!n.p2||!n.p3)throw new Error('drawTriangle() requires properties "p1", "p2" and "p3".');return Et(Object.assign({},n,{pts:[n.p1,n.p2,n.p3]}))}i(tn,"drawTriangle");function Ye(n){if(typeof n.radius!="number")throw new Error('drawCircle() requires property "radius".');n.radius!==0&&Tt(Object.assign({},n,{radiusX:n.radius,radiusY:n.radius,angle:0}))}i(Ye,"drawCircle");function Tt(n){if(n.radiusX===void 0||n.radiusY===void 0)throw new Error('drawEllipse() requires properties "radiusX" and "radiusY".');if(n.radiusX===0||n.radiusY===0)return;let s=n.start??0,c=n.end??360,h=ht(n.anchor??"center").scale(new T(-n.radiusX,-n.radiusY)),d=at(h,n.radiusX,n.radiusY,s,c,n.resolution);d.unshift(h);let v=Object.assign({},n,{pts:d,radius:0,...n.gradient?{colors:[n.gradient[0],...Array(d.length-1).fill(n.gradient[1])]}:{}});if(c-s>=360&&n.outline){n.fill!==!1&&Et(Object.assign({},v,{outline:null})),Et(Object.assign({},v,{pts:d.slice(1),fill:!1}));return}Et(v)}i(Tt,"drawEllipse");function Et(n){if(!n.pts)throw new Error('drawPolygon() requires property "pts".');let s=n.pts.length;if(!(s<3)){if(xe(),de(n.pos),he(n.scale),Ke(n.angle),de(n.offset),n.fill!==!1){let c=n.color??ee.WHITE,h=n.pts.map((v,b)=>({pos:new T(v.x,v.y),uv:n.uv?n.uv[b]:new T(0,0),color:n.colors&&n.colors[b]?n.colors[b].mult(c):c,opacity:n.opacity??1})),d;n.triangulate&&sr(n.pts)?d=or(n.pts).map(b=>b.map(D=>n.pts.indexOf(D))).flat():d=[...Array(s-2).keys()].map(v=>[0,v+1,v+2]).flat(),st(h,n.indices??d,n.fixed,n.uv?n.tex:w.defTex,n.shader,n.uniform)}n.outline&&ie({pts:[...n.pts,n.pts[0]],radius:n.radius,width:n.outline.width,color:n.outline.color,join:n.outline.join,uniform:n.uniform,fixed:n.fixed,opacity:n.opacity??n.outline.opacity}),Oe()}}i(Et,"drawPolygon");function xr(n,s,c){Pe(),x.clear(x.STENCIL_BUFFER_BIT),x.enable(x.STENCIL_TEST),x.stencilFunc(x.NEVER,1,255),x.stencilOp(x.REPLACE,x.REPLACE,x.REPLACE),s(),Pe(),x.stencilFunc(c,1,255),x.stencilOp(x.KEEP,x.KEEP,x.KEEP),n(),Pe(),x.disable(x.STENCIL_TEST)}i(xr,"drawStenciled");function yr(n,s){xr(n,s,x.EQUAL)}i(yr,"drawMasked");function wr(n,s){xr(n,s,x.NOTEQUAL)}i(wr,"drawSubtracted");function cs(){return(w.viewport.width+w.viewport.height)/(w.width+w.height)}i(cs,"getViewportScale");function ct(n){Pe();let s=w.width,c=w.height;w.width=w.viewport.width,w.height=w.viewport.height,n(),Pe(),w.width=s,w.height=c}i(ct,"drawUnscaled");function Cr(n,s){s.pos&&(n.pos=n.pos.add(s.pos)),s.scale&&(n.scale=n.scale.scale(C(s.scale))),s.angle&&(n.angle+=s.angle),s.color&&n.ch.length===1&&(n.color=n.color.mult(s.color)),s.opacity&&(n.opacity*=s.opacity)}i(Cr,"applyCharTransform");function us(n){let s={},c=n.replace(gr,"$2"),h=0;for(let d of n.matchAll(gr)){let v=d.index-h;for(let b=0;b<d.groups.text.length;b++)s[b+v]=[d.groups.style];h+=d[0].length-d.groups.text.length}return{charStyleMap:s,text:c}}i(us,"compileStyledText");let Fn={};function St(n){if(n.text===void 0)throw new Error('formatText() requires property "text".');let s=$t(n.font);if(n.text===""||s instanceof Re||!s)return{width:0,height:0,chars:[],opt:n};let{charStyleMap:c,text:h}=us(n.text+""),d=ao(h);if(s instanceof ce||typeof s=="string"){let Z=s instanceof ce?s.fontface.family:s,ne=s instanceof ce?{outline:s.outline,filter:s.filter}:{outline:null,filter:fn},q=Fn[Z]??{font:{tex:new qe(P,2048,2048,{filter:ne.filter}),map:{},size:64},cursor:new T(0),outline:ne.outline};Fn[Z]||(Fn[Z]=q),s=q.font;for(let Me of d)if(!q.font.map[Me]){let E=y;E.clearRect(0,0,f.width,f.height),E.font=`${s.size}px ${Z}`,E.textBaseline="top",E.textAlign="left",E.fillStyle="#ffffff";let j=E.measureText(Me),F=Math.ceil(j.width);if(!F)continue;let H=s.size;q.outline&&(E.lineJoin="round",E.lineWidth=q.outline.width*2,E.strokeStyle=q.outline.color.toHex(),E.strokeText(Me,q.outline.width,q.outline.width),F+=q.outline.width*2,H+=q.outline.width*3),E.fillText(Me,q.outline?.width??0,q.outline?.width??0);let X=E.getImageData(0,0,F,H);if(q.cursor.x+F>2048&&(q.cursor.x=0,q.cursor.y+=H,q.cursor.y>2048))throw new Error("Font atlas exceeds character limit");s.tex.update(X,q.cursor.x,q.cursor.y),s.map[Me]=new me(q.cursor.x,q.cursor.y,F,H),q.cursor.x+=F}}let v=n.size||s.size,b=C(n.scale??1).scale(v/s.size),D=n.lineSpacing??0,R=n.letterSpacing??0,g=0,A=0,k=0,U=[],B=[],M=0,G=null,I=null;for(;M<d.length;){let Z=d[M];if(Z===`
`)k+=v+D,U.push({width:g-R,chars:B}),G=null,I=null,g=0,B=[];else{let ne=s.map[Z];if(ne){let q=ne.w*b.x;n.width&&g+q>n.width&&(k+=v+D,G!=null&&(M-=B.length-G,Z=d[M],ne=s.map[Z],q=ne.w*b.x,B=B.slice(0,G-1),g=I),G=null,I=null,U.push({width:g-R,chars:B}),g=0,B=[]),B.push({tex:s.tex,width:ne.w,height:ne.h,quad:new me(ne.x/s.tex.width,ne.y/s.tex.height,ne.w/s.tex.width,ne.h/s.tex.height),ch:Z,pos:new T(g,k),opacity:n.opacity??1,color:n.color??ee.WHITE,scale:C(b),angle:0}),Z===" "&&(G=B.length,I=g),g+=q,A=Math.max(A,g),g+=R}}M++}U.push({width:g-R,chars:B}),k+=v,n.width&&(A=n.width);let te=[];for(let Z=0;Z<U.length;Z++){let ne=(A-U[Z].width)*oa(n.align??"left");for(let q of U[Z].chars){let Me=s.map[q.ch],E=te.length+Z;if(q.pos=q.pos.add(ne,0).add(Me.w*b.x*.5,Me.h*b.y*.5),n.transform){let j=typeof n.transform=="function"?n.transform(E,q.ch):n.transform;j&&Cr(q,j)}if(c[E]){let j=c[E];for(let F of j){let H=n.styles[F],X=typeof H=="function"?H(E,q.ch):H;X&&Cr(q,X)}}te.push(q)}}return{width:A,height:k,chars:te,opt:n}}i(St,"formatText");function Tr(n){Ot(St(n))}i(Tr,"drawText");function Ot(n){xe(),de(n.opt.pos),Ke(n.opt.angle),de(ht(n.opt.anchor??"topleft").add(1,1).scale(n.width,n.height).scale(-.5)),n.chars.forEach(s=>{it({tex:s.tex,width:s.width,height:s.height,pos:s.pos,scale:s.scale,angle:s.angle,color:s.color,opacity:s.opacity,quad:s.quad,anchor:"center",uniform:n.opt.uniform,shader:n.opt.shader,fixed:n.opt.fixed})}),Oe()}i(Ot,"drawFormattedText");function De(){return w.width}i(De,"width");function ke(){return w.height}i(ke,"height");function ls(n){return new T((n.x-w.viewport.x)*De()/w.viewport.width,(n.y-w.viewport.y)*ke()/w.viewport.height)}i(ls,"windowToContent");function ms(n){return new T(n.x*w.viewport.width/w.width,n.y*w.viewport.height/w.height)}i(ms,"contentToView");function Er(){return ls(m.mousePos())}i(Er,"mousePos");let Sr=!1,le={inspect:!1,timeScale:1,showLog:!0,fps:()=>m.fps(),numFrames:()=>m.numFrames(),stepFrame:Dr,drawCalls:()=>w.lastDrawCalls,clearLog:()=>O.logs=[],log:n=>{let s=t.logMax??8;O.logs.unshift({msg:n,time:m.time()}),O.logs.length>s&&(O.logs=O.logs.slice(0,s))},error:n=>le.log(new Error(n.toString?n.toString():n)),curRecording:null,numObjects:()=>Nn("*",{recursive:!0}).length,get paused(){return Sr},set paused(n){Sr=n,n?z.ctx.suspend():z.ctx.resume()}};function In(){return m.dt()*le.timeScale}i(In,"dt");function ds(...n){return n.length>0&&(O.cam.pos=C(...n)),O.cam.pos?O.cam.pos.clone():rn()}i(ds,"camPos");function hs(...n){return n.length>0&&(O.cam.scale=C(...n)),O.cam.scale.clone()}i(hs,"camScale");function ps(n){return n!==void 0&&(O.cam.angle=n),O.cam.angle}i(ps,"camRot");function fs(){return O.cam.transform.clone()}i(fs,"camTransform");function gs(n=12){O.cam.shake+=n}i(gs,"shake");function bs(n){return O.cam.transform.multVec2(n)}i(bs,"toScreen");function vs(n){return O.cam.transform.invert().multVec2(n)}i(vs,"toWorld");function Or(n){let s=new Ge;return n.pos&&s.translate(n.pos),n.scale&&s.scale(n.scale),n.angle&&s.rotate(n.angle),n.parent?s.mult(n.parent.transform):s}i(Or,"calcTransform");function Ln(n=[]){let s=new Map,c={},h=new tt,d=[],v=null,b=!1,D={id:so(),hidden:!1,transform:new Ge,children:[],parent:null,set paused(g){if(g!==b){b=g;for(let A of d)A.paused=g}},get paused(){return b},add(g=[]){let A=Array.isArray(g)?Ln(g):g;if(A.parent)throw new Error("Cannot add a game obj that already has a parent.");return A.parent=this,A.transform=Or(A),this.children.push(A),A.trigger("add",A),O.events.trigger("add",A),A},readd(g){let A=this.children.indexOf(g);return A!==-1&&(this.children.splice(A,1),this.children.push(g)),g},remove(g){let A=this.children.indexOf(g);if(A!==-1){g.parent=null,this.children.splice(A,1);let k=i(U=>{U.trigger("destroy"),O.events.trigger("destroy",U),U.children.forEach(B=>k(B))},"trigger");k(g)}},removeAll(g){if(g)this.get(g).forEach(A=>this.remove(A));else for(let A of[...this.children])this.remove(A)},update(){this.paused||(this.children.sort((g,A)=>(g.z??0)-(A.z??0)).forEach(g=>g.update()),this.trigger("update"))},draw(){if(this.hidden)return;this.canvas&&(Pe(),this.canvas.bind());let g=w.fixed;this.fixed&&(w.fixed=!0),xe(),de(this.pos),he(this.scale),Ke(this.angle);let A=this.children.sort((k,U)=>(k.z??0)-(U.z??0));if(this.mask){let k={intersect:yr,subtract:wr}[this.mask];if(!k)throw new Error(`Invalid mask func: "${this.mask}"`);k(()=>{A.forEach(U=>U.draw())},()=>{this.trigger("draw")})}else this.trigger("draw"),A.forEach(k=>k.draw());Oe(),w.fixed=g,this.canvas&&(Pe(),this.canvas.unbind())},drawInspect(){this.hidden||(xe(),de(this.pos),he(this.scale),Ke(this.angle),this.children.sort((g,A)=>(g.z??0)-(A.z??0)).forEach(g=>g.drawInspect()),this.trigger("drawInspect"),Oe())},use(g){if(!g)return;if(typeof g=="string")return this.use({id:g});let A=[];g.id&&(this.unuse(g.id),c[g.id]=[],A=c[g.id],s.set(g.id,g));for(let U in g){if(vo.has(U))continue;let B=Object.getOwnPropertyDescriptor(g,U);if(typeof B.value=="function"&&(g[U]=g[U].bind(this)),B.set&&Object.defineProperty(g,U,{set:B.set.bind(this)}),B.get&&Object.defineProperty(g,U,{get:B.get.bind(this)}),xo.has(U)){let M=U==="add"?()=>{v=i(G=>A.push(G),"onCurCompCleanup"),g[U](),v=null}:g[U];A.push(this.on(U,M).cancel)}else if(this[U]===void 0)Object.defineProperty(this,U,{get:()=>g[U],set:M=>g[U]=M,configurable:!0,enumerable:!0}),A.push(()=>delete this[U]);else throw new Error(`Duplicate component property: "${U}"`)}let k=i(()=>{if(g.require){for(let U of g.require)if(!this.c(U))throw new Error(`Component "${g.id}" requires component "${U}"`)}},"checkDeps");g.destroy&&A.push(g.destroy.bind(this)),this.exists()?(k(),g.add&&(v=i(U=>A.push(U),"onCurCompCleanup"),g.add.call(this),v=null)):g.require&&A.push(this.on("add",k).cancel)},unuse(g){c[g]&&(c[g].forEach(A=>A()),delete c[g]),s.has(g)&&s.delete(g)},c(g){return s.get(g)},get(g,A={}){let k=A.recursive?this.children.flatMap(i(function U(B){return[B,...B.children.flatMap(U)]},"recurse")):this.children;if(k=k.filter(U=>g?U.is(g):!0),A.liveUpdate){let U=i(M=>A.recursive?this.isAncestorOf(M):M.parent===this,"isChild"),B=[];B.push(jn(M=>{U(M)&&M.is(g)&&k.push(M)})),B.push(Ar(M=>{if(U(M)&&M.is(g)){let G=k.findIndex(I=>I.id===M.id);G!==-1&&k.splice(G,1)}})),this.onDestroy(()=>{for(let M of B)M.cancel()})}return k},isAncestorOf(g){return g.parent?g.parent===this||this.isAncestorOf(g.parent):!1},exists(){return O.root.isAncestorOf(this)},is(g){if(g==="*")return!0;if(Array.isArray(g)){for(let A of g)if(!this.c(A))return!1;return!0}else return this.c(g)!=null},on(g,A){let k=h.on(g,A.bind(this));return v&&v(()=>k.cancel()),k},trigger(g,...A){h.trigger(g,...A),O.objEvents.trigger(g,this,...A)},destroy(){this.parent&&this.parent.remove(this)},inspect(){let g={};for(let[A,k]of s)g[A]=k.inspect?k.inspect():null;return g},onAdd(g){return this.on("add",g)},onUpdate(g){return this.on("update",g)},onDraw(g){return this.on("draw",g)},onDestroy(g){return this.on("destroy",g)},clearEvents(){h.clear()}},R=["onKeyPress","onKeyPressRepeat","onKeyDown","onKeyRelease","onMousePress","onMouseDown","onMouseRelease","onMouseMove","onCharInput","onMouseMove","onTouchStart","onTouchMove","onTouchEnd","onScroll","onGamepadButtonPress","onGamepadButtonDown","onGamepadButtonRelease","onGamepadStick"];for(let g of R)D[g]=(...A)=>{let k=m[g](...A);return d.push(k),D.onDestroy(()=>k.cancel()),k};for(let g of n)D.use(g);return D}i(Ln,"make");function ut(n,s,c){return O.objEvents[n]||(O.objEvents[n]=new kt),O.objEvents.on(n,(h,...d)=>{h.is(s)&&c(h,...d)})}i(ut,"on");let xs=Ie(n=>{let s=Bt([{update:n}]);return{get paused(){return s.paused},set paused(c){s.paused=c},cancel:()=>s.destroy()}},(n,s)=>ut("update",n,s)),ys=Ie(n=>{let s=Bt([{draw:n}]);return{get paused(){return s.hidden},set paused(c){s.hidden=c},cancel:()=>s.destroy()}},(n,s)=>ut("draw",n,s)),jn=Ie(n=>O.events.on("add",n),(n,s)=>ut("add",n,s)),Ar=Ie(n=>O.events.on("destroy",n),(n,s)=>ut("destroy",n,s));function ws(n,s,c){return ut("collide",n,(h,d,v)=>d.is(s)&&c(h,d,v))}i(ws,"onCollide");function Cs(n,s,c){return ut("collideUpdate",n,(h,d,v)=>d.is(s)&&c(h,d,v))}i(Cs,"onCollideUpdate");function Ts(n,s,c){return ut("collideEnd",n,(h,d,v)=>d.is(s)&&c(h,d,v))}i(Ts,"onCollideEnd");function nn(n,s){Nn(n,{recursive:!0}).forEach(s),jn(n,s)}i(nn,"forAllCurrentAndFuture");let Es=Ie(n=>m.onMousePress(n),(n,s)=>{let c=[];return nn(n,h=>{if(!h.area)throw new Error("onClick() requires the object to have area() component");c.push(h.onClick(()=>s(h)))}),et.join(c)});function Ss(n,s){let c=[];return nn(n,h=>{if(!h.area)throw new Error("onHover() requires the object to have area() component");c.push(h.onHover(()=>s(h)))}),et.join(c)}i(Ss,"onHover");function Os(n,s){let c=[];return nn(n,h=>{if(!h.area)throw new Error("onHoverUpdate() requires the object to have area() component");c.push(h.onHoverUpdate(()=>s(h)))}),et.join(c)}i(Os,"onHoverUpdate");function As(n,s){let c=[];return nn(n,h=>{if(!h.area)throw new Error("onHoverEnd() requires the object to have area() component");c.push(h.onHoverEnd(()=>s(h)))}),et.join(c)}i(As,"onHoverEnd");function Rs(n){O.gravity=n?(O.gravity||C(0,1)).unit().scale(n):null}i(Rs,"setGravity");function Us(){return O.gravity?O.gravity.len():0}i(Us,"getGravity");function Vs(n){O.gravity=n.unit().scale(O.gravity?O.gravity.len():1)}i(Vs,"setGravityDirection");function Ps(){return O.gravity?O.gravity.unit():C(0,1)}i(Ps,"getGravityDirection");function Ds(...n){n.length===1||n.length===2?(w.bgColor=oe(n[0]),n[1]&&(w.bgAlpha=n[1])):(n.length===3||n.length===4)&&(w.bgColor=oe(n[0],n[1],n[2]),n[3]&&(w.bgAlpha=n[3])),x.clearColor(w.bgColor.r/255,w.bgColor.g/255,w.bgColor.b/255,w.bgAlpha)}i(Ds,"setBackground");function Ms(){return w.bgColor.clone()}i(Ms,"getBackground");function Gs(...n){return{id:"color",color:oe(...n),inspect(){return this.color.toString()}}}i(Gs,"color");function kn(n,s){return Number(n.toFixed(s))}i(kn,"toFixed");function Rr(n){return n.fixed?!0:n.parent?Rr(n.parent):!1}i(Rr,"isFixed");function Bs(n){return{color:n.color,opacity:n.opacity,anchor:n.anchor,outline:n.outline,shader:n.shader,uniform:n.uniform}}i(Bs,"getRenderProps");function Fs(n){N.loaded?n():O.events.on("load",n)}i(Fs,"onLoad");function Is(n,s){O.scenes[n]=s}i(Is,"scene");function Ls(n,...s){if(!O.scenes[n])throw new Error(`Scene not found: ${n}`);O.events.onOnce("frameEnd",()=>{O.events.trigger("sceneLeave",n),m.events.clear(),O.events.clear(),O.objEvents.clear(),[...O.root.children].forEach(c=>{(!c.stay||c.scenesToStay&&!c.scenesToStay.includes(n))&&O.root.remove(c)}),O.root.clearEvents(),Br(),O.cam={pos:null,scale:C(1),angle:0,shake:0,transform:new Ge},O.scenes[n](...s)}),O.currentScene=n}i(Ls,"go");function js(n){return O.events.on("sceneLeave",n)}i(js,"onSceneLeave");function ks(){return O.currentScene}i(ks,"getSceneName");function Ns(n,s){try{return JSON.parse(window.localStorage[n])}catch{return s?(Ur(n,s),s):null}}i(Ns,"getData");function Ur(n,s){window.localStorage[n]=JSON.stringify(s)}i(Ur,"setData");function Vr(n,...s){let c=n($e),h;typeof c=="function"?h=c(...s)($e):h=c;for(let d in h)$e[d]=h[d],t.global!==!1&&(window[d]=h[d]);return $e}i(Vr,"plug");function rn(){return C(De()/2,ke()/2)}i(rn,"center");let _s;(I=>(I[I.None=0]="None",I[I.Left=1]="Left",I[I.Top=2]="Top",I[I.LeftTop=3]="LeftTop",I[I.Right=4]="Right",I[I.Horizontal=5]="Horizontal",I[I.RightTop=6]="RightTop",I[I.HorizontalTop=7]="HorizontalTop",I[I.Bottom=8]="Bottom",I[I.LeftBottom=9]="LeftBottom",I[I.Vertical=10]="Vertical",I[I.LeftVertical=11]="LeftVertical",I[I.RightBottom=12]="RightBottom",I[I.HorizontalBottom=13]="HorizontalBottom",I[I.RightVertical=14]="RightVertical",I[I.All=15]="All"))(_s||={});function Hs(n,s){if(!s.tileWidth||!s.tileHeight)throw new Error("Must provide tileWidth and tileHeight.");let c=Bt([qt(s.pos??C(0))]),h=n.length,d=0,v=null,b=null,D=null,R=null,g=i(E=>E.x+E.y*d,"tile2Hash"),A=i(E=>C(Math.floor(E%d),Math.floor(E/d)),"hash2Tile"),k=i(()=>{v=[];for(let E of c.children)U(E)},"createSpatialMap"),U=i(E=>{let j=g(E.tilePos);v[j]?v[j].push(E):v[j]=[E]},"insertIntoSpatialMap"),B=i(E=>{let j=g(E.tilePos);if(v[j]){let F=v[j].indexOf(E);F>=0&&v[j].splice(F,1)}},"removeFromSpatialMap"),M=i(()=>{let E=!1;for(let j of c.children){let F=c.pos2Tile(j.pos);(j.tilePos.x!=F.x||j.tilePos.y!=F.y)&&(E=!0,B(j),j.tilePos.x=F.x,j.tilePos.y=F.y,U(j))}E&&c.trigger("spatial_map_changed")},"updateSpatialMap"),G=i(()=>{let E=c.getSpatialMap(),j=c.numRows()*c.numColumns();b?b.length=j:b=new Array(j),b.fill(1,0,j);for(let F=0;F<E.length;F++){let H=E[F];if(H){let X=0;for(let Q of H)if(Q.isObstacle){X=1/0;break}else X+=Q.cost;b[F]=X||1}}},"createCostMap"),I=i(()=>{let E=c.getSpatialMap(),j=c.numRows()*c.numColumns();D?D.length=j:D=new Array(j),D.fill(15,0,j);for(let F=0;F<E.length;F++){let H=E[F];if(H){let X=H.length,Q=15;for(let be=0;be<X;be++)Q|=H[be].edgeMask;D[F]=Q}}},"createEdgeMap"),te=i(()=>{let E=c.numRows()*c.numColumns(),j=i((H,X)=>{let Q=[];for(Q.push(H);Q.length>0;){let be=Q.pop();q(be).forEach(Te=>{R[Te]<0&&(R[Te]=X,Q.push(Te))})}},"traverse");R?R.length=E:R=new Array(E),R.fill(-1,0,E);let F=0;for(let H=0;H<b.length;H++){if(R[H]>=0){F++;continue}j(H,F),F++}},"createConnectivityMap"),Z=i((E,j)=>b[j],"getCost"),ne=i((E,j)=>{let F=A(E),H=A(j);return F.dist(H)},"getHeuristic"),q=i((E,j)=>{let F=[],H=Math.floor(E%d),X=H>0&&D[E]&1&&b[E-1]!==1/0,Q=E>=d&&D[E]&2&&b[E-d]!==1/0,be=H<d-1&&D[E]&4&&b[E+1]!==1/0,Te=E<d*h-d-1&&D[E]&8&&b[E+d]!==1/0;return j?(X&&(Q&&F.push(E-d-1),F.push(E-1),Te&&F.push(E+d-1)),Q&&F.push(E-d),be&&(Q&&F.push(E-d+1),F.push(E+1),Te&&F.push(E+d+1)),Te&&F.push(E+d)):(X&&F.push(E-1),Q&&F.push(E-d),be&&F.push(E+1),Te&&F.push(E+d)),F},"getNeighbours"),Me={id:"level",tileWidth(){return s.tileWidth},tileHeight(){return s.tileHeight},spawn(E,...j){let F=C(...j),H=(()=>{if(typeof E=="string"){if(s.tiles[E]){if(typeof s.tiles[E]!="function")throw new Error("Level symbol def must be a function returning a component list");return s.tiles[E](F)}else if(s.wildcardTile)return s.wildcardTile(E,F)}else{if(Array.isArray(E))return E;throw new Error("Expected a symbol or a component list")}})();if(!H)return null;let X=!1,Q=!1;for(let Te of H)Te.id==="tile"&&(Q=!0),Te.id==="pos"&&(X=!0);X||H.push(qt()),Q||H.push(br());let be=c.add(H);return X&&(be.tilePosOffset=be.pos.clone()),be.tilePos=F,v&&(U(be),this.trigger("spatial_map_changed"),this.trigger("navigation_map_invalid")),be},numColumns(){return d},numRows(){return h},levelWidth(){return d*this.tileWidth()},levelHeight(){return h*this.tileHeight()},tile2Pos(...E){return C(...E).scale(this.tileWidth(),this.tileHeight())},pos2Tile(...E){let j=C(...E);return C(Math.floor(j.x/this.tileWidth()),Math.floor(j.y/this.tileHeight()))},getSpatialMap(){return v||k(),v},onSpatialMapChanged(E){return this.on("spatial_map_changed",E)},onNavigationMapInvalid(E){return this.on("navigation_map_invalid",E)},getAt(E){v||k();let j=g(E);return v[j]||[]},raycast(E,j){E=E.scale(1/this.tileWidth(),1/this.tileHeight());let F=Jr(E,j,H=>{if(this.getAt(H).some(Q=>Q.isObstacle))return!0},64);return F&&(F.point=F.point.scale(this.tileWidth(),this.tileHeight())),F},update(){v&&M()},invalidateNavigationMap(){b=null,D=null,R=null},onNavigationMapChanged(E){return this.on("navigation_map_changed",E)},getTilePath(E,j,F={}){if(b||G(),D||I(),R||te(),E.x<0||E.x>=d||E.y<0||E.y>=h||j.x<0||j.x>=d||j.y<0||j.y>=h)return null;let H=g(E),X=g(j);if(b[X]===1/0)return null;if(H===X)return[];if(R[H]!=-1&&R[H]!==R[X])return null;let Q=new ln((Ze,Kn)=>Ze.cost<Kn.cost);Q.insert({cost:0,node:H});let be=new Map;be.set(H,H);let Te=new Map;for(Te.set(H,0);Q.length!==0;){let Ze=Q.remove()?.node;if(Ze===X)break;let Kn=q(Ze,F.allowDiagonals);for(let gt of Kn){let qn=(Te.get(Ze)||0)+Z(Ze,gt)+ne(gt,X);(!Te.has(gt)||qn<Te.get(gt))&&(Te.set(gt,qn),Q.insert({cost:qn,node:gt}),be.set(gt,Ze))}}let Hn=[],Ft=X,mi=A(Ft);for(Hn.push(mi);Ft!==H;){Ft=be.get(Ft);let Ze=A(Ft);Hn.push(Ze)}return Hn.reverse()},getPath(E,j,F={}){let H=this.tileWidth(),X=this.tileHeight(),Q=this.getTilePath(this.pos2Tile(E),this.pos2Tile(j),F);return Q?[E,...Q.slice(1,-1).map(be=>be.scale(H,X).add(H/2,X/2)),j]:null}};return c.use(Me),c.onNavigationMapInvalid(()=>{c.invalidateNavigationMap(),c.trigger("navigation_map_changed")}),n.forEach((E,j)=>{let F=E.split("");d=Math.max(F.length,d),F.forEach((H,X)=>{c.spawn(H,C(X,j))})}),c}i(Hs,"addLevel");function Ks(n){let s=m.canvas.captureStream(n),c=z.ctx.createMediaStreamDestination();z.masterNode.connect(c);let h=new MediaRecorder(s),d=[];return h.ondataavailable=v=>{v.data.size>0&&d.push(v.data)},h.onerror=()=>{z.masterNode.disconnect(c),s.getTracks().forEach(v=>v.stop())},h.start(),{resume(){h.resume()},pause(){h.pause()},stop(){return h.stop(),z.masterNode.disconnect(c),s.getTracks().forEach(v=>v.stop()),new Promise(v=>{h.onstop=()=>{v(new Blob(d,{type:"video/mp4"}))}})},download(v="kaboom.mp4"){this.stop().then(b=>ar(v,b))}}}i(Ks,"record");function qs(){return document.activeElement===m.canvas}i(qs,"isFocused");function zs(n){n.destroy()}i(zs,"destroy");let Bt=O.root.add.bind(O.root),Ws=O.root.readd.bind(O.root),Ys=O.root.removeAll.bind(O.root),Nn=O.root.get.bind(O.root),Xs=O.root.wait.bind(O.root),$s=O.root.loop.bind(O.root),Qs=O.root.tween.bind(O.root);function Pr(n=2,s=1){let c=0;return{require:["scale"],update(){let h=Math.sin(c*n)*s;h<0&&this.destroy(),this.scale=C(h),c+=In()}}}i(Pr,"boom");let Js=Ee(null,es),Zs=Ee(null,Jo);function ei(n,s={}){let c=Bt([qt(n),vr()]),h=(s.speed||1)*5,d=s.scale||1;c.add([wn(Zs),zt(0),Tn("center"),Pr(h,d),...s.comps??[]]);let v=c.add([wn(Js),zt(0),Tn("center"),Cn(),...s.comps??[]]);return v.wait(.4/h,()=>v.use(Pr(h,d))),v.onDestroy(()=>c.destroy()),c}i(ei,"addKaboom");function Dr(){O.root.update()}i(Dr,"updateFrame");class _n{static{i(this,"Collision")}source;target;displacement;resolved=!1;constructor(s,c,h,d=!1){this.source=s,this.target=c,this.displacement=h,this.resolved=d}reverse(){return new _n(this.target,this.source,this.displacement.scale(-1),this.resolved)}hasOverlap(){return!this.displacement.isZero()}isLeft(){return this.displacement.cross(O.gravity||C(0,1))>0}isRight(){return this.displacement.cross(O.gravity||C(0,1))<0}isTop(){return this.displacement.dot(O.gravity||C(0,1))>0}isBottom(){return this.displacement.dot(O.gravity||C(0,1))<0}preventResolution(){this.resolved=!0}}function ti(){let n={},s=t.hashGridSize||64,c=new Ge,h=[];function d(v){if(h.push(c.clone()),v.pos&&c.translate(v.pos),v.scale&&c.scale(v.scale),v.angle&&c.rotate(v.angle),v.transform=c.clone(),v.c("area")&&!v.paused){let b=v,R=b.worldArea().bbox(),g=Math.floor(R.pos.x/s),A=Math.floor(R.pos.y/s),k=Math.ceil((R.pos.x+R.width)/s),U=Math.ceil((R.pos.y+R.height)/s),B=new Set;for(let M=g;M<=k;M++)for(let G=A;G<=U;G++)if(!n[M])n[M]={},n[M][G]=[b];else if(!n[M][G])n[M][G]=[b];else{let I=n[M][G];e:for(let te of I){if(te.paused||!te.exists()||B.has(te.id))continue;for(let ne of b.collisionIgnore)if(te.is(ne))continue e;for(let ne of te.collisionIgnore)if(b.is(ne))continue e;let Z=Zr(b.worldArea(),te.worldArea());if(Z){let ne=new _n(b,te,Z);b.trigger("collideUpdate",te,ne);let q=ne.reverse();q.resolved=ne.resolved,te.trigger("collideUpdate",b,q)}B.add(te.id)}I.push(b)}}v.children.forEach(d),c=h.pop()}i(d,"checkObj"),d(O.root)}i(ti,"checkFrame");function ni(){let n=O.cam,s=T.fromAngle(Lt(0,360)).scale(n.shake);n.shake=Je(n.shake,0,5*In()),n.transform=new Ge().translate(rn()).scale(n.scale).rotate(n.angle).translate((n.pos??rn()).scale(-1).add(s)),O.root.draw(),Pe()}i(ni,"drawFrame");function ri(){let n=_();O.events.numListeners("loading")>0?O.events.trigger("loading",n):ct(()=>{let s=De()/2,c=24,h=C(De()/2,ke()/2).sub(C(s/2,c/2));p({pos:C(0),width:De(),height:ke(),color:oe(0,0,0)}),p({pos:h,width:s,height:c,fill:!1,outline:{width:4}}),p({pos:h,width:s*n,height:c})})}i(ri,"drawLoadScreen");function Mr(n,s){ct(()=>{let c=C(8);xe(),de(n);let h=St({text:s,font:Ht,size:16,pos:c,color:oe(255,255,255),fixed:!0}),d=h.width+c.x*2,v=h.height+c.x*2;n.x+d>=De()&&de(C(-d,0)),n.y+v>=ke()&&de(C(0,-v)),p({width:d,height:v,color:oe(0,0,0),radius:4,opacity:.8,fixed:!0}),Ot(h),Oe()})}i(Mr,"drawInspectText");function oi(){if(le.inspect){let n=null;for(let s of O.root.get("*",{recursive:!0}))if(s.c("area")&&s.isHovering()){n=s;break}if(O.root.drawInspect(),n){let s=[],c=n.inspect();for(let h in c)c[h]?s.push(`${h}: ${c[h]}`):s.push(`${h}`);Mr(ms(Er()),s.join(`
`))}Mr(C(8),`FPS: ${le.fps()}`)}le.paused&&ct(()=>{xe(),de(De(),0),de(-8,8);let n=32;p({width:n,height:n,anchor:"topright",color:oe(0,0,0),opacity:.8,radius:4,fixed:!0});for(let s=1;s<=2;s++)p({width:4,height:n*.6,anchor:"center",pos:C(-n/3*s,n*.5),color:oe(255,255,255),radius:2,fixed:!0});Oe()}),le.timeScale!==1&&ct(()=>{xe(),de(De(),ke()),de(-8,-8);let n=8,s=St({text:le.timeScale.toFixed(1),font:Ht,size:16,color:oe(255,255,255),pos:C(-n),anchor:"botright",fixed:!0});p({width:s.width+n*2+n*4,height:s.height+n*2,anchor:"botright",color:oe(0,0,0),opacity:.8,radius:4,fixed:!0});for(let c=0;c<2;c++){let h=le.timeScale<1;tn({p1:C(-s.width-n*(h?2:3.5),-n),p2:C(-s.width-n*(h?2:3.5),-n-s.height),p3:C(-s.width-n*(h?3.5:2),-n-s.height/2),pos:C(-c*n*1+(h?-n*.5:0),0),color:oe(255,255,255),fixed:!0})}Ot(s),Oe()}),le.curRecording&&ct(()=>{xe(),de(0,ke()),de(24,-24),Ye({radius:12,color:oe(255,0,0),opacity:Yn(0,1,m.time()*4),fixed:!0}),Oe()}),le.showLog&&O.logs.length>0&&ct(()=>{xe(),de(0,ke()),de(8,-8);let n=8,s=[];for(let h of O.logs){let d="",v=h.msg instanceof Error?"error":"info";d+=`[time]${h.time.toFixed(2)}[/time]`,d+=" ",d+=`[${v}]${h.msg?.toString?h.msg.toString():h.msg}[/${v}]`,s.push(d)}O.logs=O.logs.filter(h=>m.time()-h.time<(t.logTime||4));let c=St({text:s.join(`
`),font:Ht,pos:C(n,-n),anchor:"botleft",size:16,width:De()*.6,lineSpacing:n/2,fixed:!0,styles:{time:{color:oe(127,127,127)},info:{color:oe(255,255,255)},error:{color:oe(255,0,127)}}});p({width:c.width+n*2,height:c.height+n*2,anchor:"botleft",color:oe(0,0,0),radius:4,opacity:.8,fixed:!0}),Ot(c),Oe()})}i(oi,"drawDebug");function si(n){O.events.on("loading",n)}i(si,"onLoading");function ii(n){m.onResize(n)}i(ii,"onResize");function ai(n){O.events.on("error",n)}i(ai,"onError");function ci(n){console.error(n),z.ctx.suspend(),m.run(()=>{Ct(),ct(()=>{let h=De(),d=ke(),v={size:36,width:h-32*2,letterSpacing:4,lineSpacing:4,font:Ht,fixed:!0};p({width:h,height:d,color:oe(0,0,255),fixed:!0});let b=St({...v,text:"Error",pos:C(32),color:oe(255,128,0),fixed:!0});Ot(b),Tr({...v,text:n.message,pos:C(32,32+b.height+16),fixed:!0}),Oe(),O.events.trigger("error",n)}),Mt()})}i(ci,"handleErr");function ui(n){V.push(n)}i(ui,"onCleanup");function li(){O.events.onOnce("frameEnd",()=>{m.quit(),x.clear(x.COLOR_BUFFER_BIT|x.DEPTH_BUFFER_BIT|x.STENCIL_BUFFER_BIT);let n=x.getParameter(x.MAX_TEXTURE_IMAGE_UNITS);for(let s=0;s<n;s++)x.activeTexture(x.TEXTURE0+s),x.bindTexture(x.TEXTURE_2D,null),x.bindTexture(x.TEXTURE_CUBE_MAP,null);x.bindBuffer(x.ARRAY_BUFFER,null),x.bindBuffer(x.ELEMENT_ARRAY_BUFFER,null),x.bindRenderbuffer(x.RENDERBUFFER,null),x.bindFramebuffer(x.FRAMEBUFFER,null),P.destroy(),V.forEach(s=>s())})}i(li,"quit");let on=!0;m.run(()=>{try{N.loaded||_()===1&&!on&&(N.loaded=!0,O.events.trigger("load")),!N.loaded&&t.loadingScreen!==!1||on?(Ct(),ri(),Mt()):(le.paused||Dr(),ti(),Ct(),ni(),t.debug!==!1&&oi(),Mt()),on&&(on=!1),O.events.trigger("frameEnd")}catch(n){ci(n)}});function Gr(){let n=u,s=x.drawingBufferWidth/n,c=x.drawingBufferHeight/n;if(t.letterbox){if(!t.width||!t.height)throw new Error("Letterboxing requires width and height defined.");let h=s/c,d=t.width/t.height;if(h>d){let v=c*d,b=(s-v)/2;w.viewport={x:b,y:0,width:v,height:c}}else{let v=s/d,b=(c-v)/2;w.viewport={x:0,y:b,width:s,height:v}}return}if(t.stretch&&(!t.width||!t.height))throw new Error("Stretching requires width and height defined.");w.viewport={x:0,y:0,width:s,height:c}}i(Gr,"updateViewport");function Br(){m.onHide(()=>{t.backgroundAudio||z.ctx.suspend()}),m.onShow(()=>{!t.backgroundAudio&&!le.paused&&z.ctx.resume()}),m.onResize(()=>{if(m.isFullscreen())return;let n=t.width&&t.height;n&&!t.stretch&&!t.letterbox||(r.width=r.offsetWidth*u,r.height=r.offsetHeight*u,Gr(),n||(w.frameBuffer.free(),w.frameBuffer=new yt(P,x.drawingBufferWidth,x.drawingBufferHeight),w.width=x.drawingBufferWidth/u/o,w.height=x.drawingBufferHeight/u/o))}),t.debug!==!1&&(m.onKeyPress(t.debugKey??"f1",()=>le.inspect=!le.inspect),m.onKeyPress("f2",()=>le.clearLog()),m.onKeyPress("f8",()=>le.paused=!le.paused),m.onKeyPress("f7",()=>{le.timeScale=kn(Qe(le.timeScale-.2,0,2),1)}),m.onKeyPress("f9",()=>{le.timeScale=kn(Qe(le.timeScale+.2,0,2),1)}),m.onKeyPress("f10",()=>le.stepFrame())),t.burp&&m.onKeyPress("b",()=>Jt())}if(i(Br,"initEvents"),Gr(),Br(),$e={_k:{kaboomCtx:$e,app:m,game:O,isFixed:Rr,toFixed:kn,getViewportScale:cs,getRenderProps:Bs,resolveSprite:Xt,drawTexture:Gt,calcTransform:Or},VERSION:ra,loadRoot:ae,loadProgress:_,loadSprite:Ee,loadSpriteAtlas:Le,loadSound:Se,loadMusic:Ve,loadBitmapFont:Ue,loadFont:ge,loadShader:He,loadShaderURL:pt,loadAseprite:_e,loadPedit:Ne,loadBean:ze,loadJSON:re,load:se,getSprite:rt,getSound:ot,getFont:wt,getBitmapFont:Wt,getShader:Yt,getAsset:An,Asset:Re,SpriteData:K,SoundData:Y,width:De,height:ke,center:rn,dt:In,time:m.time,screenshot:m.screenshot,record:Ks,isFocused:qs,setCursor:m.setCursor,getCursor:m.getCursor,setCursorLocked:m.setCursorLocked,isCursorLocked:m.isCursorLocked,setFullscreen:m.setFullscreen,isFullscreen:m.isFullscreen,isTouchscreen:m.isTouchscreen,onLoad:Fs,onLoading:si,onResize:ii,onGamepadConnect:m.onGamepadConnect,onGamepadDisconnect:m.onGamepadDisconnect,onError:ai,onCleanup:ui,camPos:ds,camScale:hs,camRot:ps,camTransform:fs,shake:gs,toScreen:bs,toWorld:vs,setGravity:Rs,getGravity:Us,setGravityDirection:Vs,getGravityDirection:Ps,setBackground:Ds,getBackground:Ms,getGamepads:m.getGamepads,add:Bt,make:Ln,destroy:zs,destroyAll:Ys,get:Nn,readd:Ws,pos:qt,scale:zt,rotate:Xo,color:Gs,opacity:Vo,anchor:Tn,area:_o,sprite:wn,text:Fo,polygon:Do,rect:Go,circle:Oo,uvquad:Io,outline:Po,body:Ho,doubleJump:Ko,shader:Bo,timer:Cn,fixed:qo,stay:vr,health:jo,lifespan:ko,state:No,z:$o,move:Wo,offscreen:Yo,follow:zo,fadeIn:Ro,mask:Uo,drawon:Ao,raycast:Mo,tile:br,agent:Lo,on:ut,onUpdate:xs,onDraw:ys,onAdd:jn,onDestroy:Ar,onClick:Es,onCollide:ws,onCollideUpdate:Cs,onCollideEnd:Ts,onHover:Ss,onHoverUpdate:Os,onHoverEnd:As,onKeyDown:m.onKeyDown,onKeyPress:m.onKeyPress,onKeyPressRepeat:m.onKeyPressRepeat,onKeyRelease:m.onKeyRelease,onMouseDown:m.onMouseDown,onMousePress:m.onMousePress,onMouseRelease:m.onMouseRelease,onMouseMove:m.onMouseMove,onCharInput:m.onCharInput,onTouchStart:m.onTouchStart,onTouchMove:m.onTouchMove,onTouchEnd:m.onTouchEnd,onScroll:m.onScroll,onHide:m.onHide,onShow:m.onShow,onGamepadButtonDown:m.onGamepadButtonDown,onGamepadButtonPress:m.onGamepadButtonPress,onGamepadButtonRelease:m.onGamepadButtonRelease,onGamepadStick:m.onGamepadStick,mousePos:Er,mouseDeltaPos:m.mouseDeltaPos,isKeyDown:m.isKeyDown,isKeyPressed:m.isKeyPressed,isKeyPressedRepeat:m.isKeyPressedRepeat,isKeyReleased:m.isKeyReleased,isMouseDown:m.isMouseDown,isMousePressed:m.isMousePressed,isMouseReleased:m.isMouseReleased,isMouseMoved:m.isMouseMoved,isGamepadButtonPressed:m.isGamepadButtonPressed,isGamepadButtonDown:m.isGamepadButtonDown,isGamepadButtonReleased:m.isGamepadButtonReleased,getGamepadStick:m.getGamepadStick,charInputted:m.charInputted,loop:$s,wait:Xs,play:Qt,volume:Vn,burp:Jt,audioCtx:z.ctx,Line:Be,Rect:ue,Circle:Fe,Ellipse:Xe,Polygon:Ae,Vec2:T,Color:ee,Mat4:Ge,Quad:me,RNG:It,rand:Lt,randi:Xn,randSeed:kr,vec2:C,rgb:oe,hsl2rgb:jr,quad:pe,choose:Hr,chooseMultiple:_r,shuffle:$n,chance:Nr,lerp:Je,tween:Qs,easings:Pt,map:dt,mapc:Lr,wave:Yn,deg2rad:ve,rad2deg:lt,clamp:Qe,evaluateBezier:rr,testLineLine:cn,testRectRect:Qn,testRectLine:un,testRectPoint:Jn,testCirclePolygon:jt,testLinePoint:Zn,testLineCircle:Rt,isConvex:sr,triangulate:or,drawSprite:en,drawText:Tr,formatText:St,drawRect:p,drawLine:S,drawLines:ie,drawTriangle:tn,drawCircle:Ye,drawEllipse:Tt,drawUVQuad:it,drawPolygon:Et,drawCurve:We,drawBezier:ft,drawFormattedText:Ot,drawMasked:yr,drawSubtracted:wr,pushTransform:xe,popTransform:Oe,pushTranslate:de,pushScale:he,pushRotate:Ke,pushMatrix:Bn,usePostEffect:Gn,makeCanvas:Dn,debug:le,scene:Is,getSceneName:ks,go:Ls,onSceneLeave:js,addLevel:Hs,getData:Ns,setData:Ur,download:dn,downloadJSON:ro,downloadText:ir,downloadBlob:ar,plug:Vr,ASCII_CHARS:fr,canvas:m.canvas,addKaboom:ei,LEFT:T.LEFT,RIGHT:T.RIGHT,UP:T.UP,DOWN:T.DOWN,RED:ee.RED,GREEN:ee.GREEN,BLUE:ee.BLUE,YELLOW:ee.YELLOW,MAGENTA:ee.MAGENTA,CYAN:ee.CYAN,WHITE:ee.WHITE,BLACK:ee.BLACK,quit:li,Event:we,EventHandler:tt,EventController:et},t.plugins&&t.plugins.forEach(Vr),t.global!==!1)for(let n in $e)window[n]=$e[n];return t.focus!==!1&&m.canvas.focus(),$e},"kaplay"),aa=ia;return bi(ca);})();
window.kaboom = kaplay.default; window.kaplay = kaplay.default
//# sourceMappingURL=kaboom.js.map
